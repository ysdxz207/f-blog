/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(b){var c={JSPATH:"BJUI/",PLUGINPATH:"BJUI/plugins/",IS_DEBUG:false,KeyPressed:{ctrl:false,shift:false},keyCode:{ENTER:13,ESC:27,END:35,HOME:36,SHIFT:16,CTRL:17,TAB:9,LEFT:37,RIGHT:39,UP:38,DOWN:40,DELETE:46,BACKSPACE:8},eventType:{initUI:"bjui.initUI",beforeInitUI:"bjui.beforeInitUI",afterInitUI:"bjui.afterInitUI",ajaxStatus:"bjui.ajaxStatus",resizeGrid:"bjui.resizeGrid",beforeAjaxLoad:"bjui.beforeAjaxLoad",beforeLoadNavtab:"bjui.beforeLoadNavtab",beforeLoadDialog:"bjui.beforeLoadDialog",afterLoadNavtab:"bjui.afterLoadNavtab",afterLoadDialog:"bjui.afterLoadDialog",beforeCloseNavtab:"bjui.beforeCloseNavtab",beforeCloseDialog:"bjui.beforeCloseDialog",afterCloseNavtab:"bjui.afterCloseNavtab",afterCloseDialog:"bjui.afterCloseDialog"},formColWidth:{L:900,M:680,S:360,SS:240},pageInfo:{pageCurrent:"pageCurrent",pageSize:"pageSize",orderField:"orderField",orderDirection:"orderDirection"},alertMsg:{displayPosition:"topcenter",alertTimeout:6000},ajaxTimeout:30000,statusCode:{ok:200,error:300,timeout:301},keys:{statusCode:"statusCode",message:"message"},ui:{windowWidth:0,showSideWidth:990,sidenavWidth:260,offsetWidth:15,displayFirst:true,showSlidebar:true,clientPaging:true,overwriteHomeTab:false},debug:function(d){if(this.IS_DEBUG){if(typeof(console)!="undefined"){console.log(d)}else{alert(d)}}},loginInfo:{url:"login.html",title:"Login",width:420,height:260,mask:true},loadLogin:function(){var d=this.loginInfo;c.dialog({id:"bjui-login",url:d.url,title:d.title,width:d.width,height:d.height,mask:d.mask})},init:function(d){var e=b.extend({},d);b.extend(c.keys,e.keys);b.extend(c.statusCode,e.statusCode);b.extend(c.pageInfo,e.pageInfo);b.extend(c.formColWidth,e.formColWidth);b.extend(c.alertMsg,e.alertMsg);b.extend(c.loginInfo,e.loginInfo);b.extend(c.ui,e.ui);if(e.JSPATH){this.JSPATH=e.JSPATH}if(e.PLUGINPATH){this.PLUGINPATH=e.PLUGINPATH}if(e.ajaxTimeout){this.ajaxTimeout=e.ajaxTimeout}this.IS_DEBUG=e.debug||false;this.initEnv();if((!b.cookie||!b.cookie("bjui_theme"))&&e.theme){b(this).theme("setTheme",e.theme)}},initEnv:function(){b(window).resize(function(){c.initLayout();setTimeout(function(){b(this).trigger(c.eventType.resizeGrid)},30)});setTimeout(function(){b(document).initui();var d=b("#bjui-navbar-collapse"),e=d.prev().width();d.css("left",e).data("position.left",e);c.initLayout();b("#bjui-top-collapse").on("click.theme",".dropdown-toggle",function(){var g=b(this).next(),f=b("#bjui-top-collapse");if(!f.hasClass("navbar-show")){f.attr("style",g.is(":visible")?"":"overflow:visible !important;")}});b('[data-toggle="collapsenavbar"]').click(function(){var h=b(this),f=b(h.data("target")),g=h.closest(".navbar-header");if(f.length){f.toggleClass("navbar-show");g.toggleClass("navbar-show");b(document).on("click",function(i){if(!(f.has(i.target).length)&&!(g.has(i.target).length)){f.removeClass("navbar-show");g.removeClass("navbar-show")}})}})},10)},initLayout:function(){var m=b(window).width(),j=b(window).height(),k=b("#bjui-top"),p=b("#bjui-navbar"),n=b("#bjui-top-collapse, #bjui-navbar-collapse"),f=k.height(),h=parseInt(p.css("min-height"),10),o="click.bjui.sidenav.hide",d={},i=b("#bjui-navtab"),g=b("#bjui-sidenav"),s=b("#bjui-sidenav-col"),r=b("#bjui-sidenav-arrow"),q=b("#bjui-sidenav-btn"),e=b("#bjui-sidenav-box"),l=q.outerHeight()-2;b("#bjui-navtab .tabsPageContent").height(j-f-h-l);g.height(j-f-h-1);s.width(c.ui.sidenavWidth);n.scrollTop(5).eq(0).removeAttr("style");n.each(function(){var v=b(this),u=v.prev().find(".navbar-toggle"),t=(v.scrollTop()==5||v.hasClass("navbar-show"));t&&v.scrollTop(0);v.toggleClass("position",t);u.toggleClass("position",t);if(v.data("position.left")&&(m/2)<v.data("position.left")){v.prev().find("> .navbar-brand").hide();v.css("left",0)}else{v.prev().find("> .navbar-brand").show();v.css("left",v.data("position.left"))}});if(m<c.ui.showSideWidth){s.css("left",-(c.ui.sidenavWidth+c.ui.offsetWidth)).addClass("autohide");i.css("margin-left",0);q.show()}else{s.css("left",0).removeClass("autohide");i.css("margin-left",(c.ui.sidenavWidth+c.ui.offsetWidth));q.hide()}r.off(o).on(o,function(){s.stop().animate({left:-(c.ui.sidenavWidth+c.ui.offsetWidth)},"fast",function(){q.show();b(window).trigger(c.eventType.resizeGrid)});i.stop().animate({"margin-left":0},"fast")});q.off(o).on(o,function(){q.hide();s.stop().animate({left:0},"fast",function(){b(window).trigger(c.eventType.resizeGrid)});d["margin-left"]=(c.ui.sidenavWidth+c.ui.offsetWidth);if(m<c.ui.showSideWidth){d["margin-left"]=0}i.stop().animate(d,"fast")})},regional:{},setRegional:function(d,e){c.regional[d]=e},getRegional:function(f){if(String(f).indexOf(".")>=0){var g,d=String(f).split(".");for(var e=0;e<d.length;e++){if(!g){g=c.regional[d[e]]}else{g=g[d[e]]}}return g}else{return c.regional[f]}},doRegional:function(e,d){b.each(d,function(g,f){e=e.replaceAll("#"+g+"#",f)
});return e},isIE:function(e){var d=document.createElement("b");d.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->";return d.getElementsByTagName("i").length===1},StrBuilder:function(){return new a()}};function a(){this.datas=new Array()}a.prototype.add=function(d){if(typeof d!=="undefined"){this.datas.push(d)}return this};a.prototype.toString=function(e){var d=this.datas.join(e||"");this.clear();return d};a.prototype.isEmpty=function(){return this.datas.length==0};a.prototype.clear=function(){this.datas=[];this.datas.length=0};window.BJUI=c}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(a){a(function(){BJUI.setRegional("alertmsg",{title:{error:"错误提示",info:"信息提示",warn:"警告信息",correct:"成功信息",confirm:"确认信息",prompt:"确认信息"},btnMsg:{ok:"确定",yes:"是",no:"否",cancel:"取消"}});BJUI.setRegional("dialog",{close:"关闭",maximize:"最大化",restore:"还原",minimize:"最小化",title:"弹出窗口"});BJUI.setRegional("orderby",{asc:"升序",desc:"降序"});BJUI.setRegional("pagination",{total:"总记录数/总页数",first:"首页",last:"末页",prev:"上一页",next:"下一页",jumpto:"输入跳转页码，回车确认",jump:"跳转",page:"页",refresh:"刷新"});BJUI.setRegional("datagrid",{asc:"升序",desc:"降序",showhide:"显示/隐藏 列",filter:"过滤",clear:"清除",lock:"锁定列",unlock:"解除锁定",add:"添加",edit:"编辑",save:"保存",update:"更新",cancel:"取消",del:"删除",prev:"上一条",next:"下一条",refresh:"刷新",query:"查询","import":"导入","export":"导出",exportf:"导出筛选",all:"全部","true":"是","false":"否",noData:"没有数据！",fAndS:"过滤和排序！",expandMsg:"点我展开行！",shrinkMsg:"点我收缩行！",selectMsg:"未选中任何行！",editMsg:"请先保存编辑行！",saveMsg:"没有需要保存的行！",delMsg:"确定要删除该行吗？",delMsgM:"确定要删除选中行？",errorData:"未获取到正确的数据！",failData:"请求datagrid数据失败！"});BJUI.setRegional("findgrid",{choose:"选择选中项",append:"追加选择",empty:"清空现有值"});BJUI.setRegional("progressmsg","正在努力加载数据，请稍等...");BJUI.setRegional("datepicker",{close:"关闭",prev:"上月",next:"下月",clear:"清空",ok:"确定",dayNames:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]});BJUI.setRegional("navtabCM",{refresh:"刷新本标签",close:"关闭本标签",closeother:"关闭其他标签",closeall:"关闭所有标签"});BJUI.setRegional("dialogCM",{refresh:"刷新本窗口",close:"关闭本窗口",closeother:"关闭其他窗口",closeall:"关闭所有窗口"});BJUI.setRegional("statusCode_503","服务器当前负载过大或者正在维护！");BJUI.setRegional("ajaxnosend","与服务器的通信中断，请检查URL链接或服务器状态！");BJUI.setRegional("sessiontimeout","会话超时，请重新登陆！");BJUI.setRegional("plhmsg","占位符对应的选择器无有效值！");BJUI.setRegional("nocheckgroup",'未定义选中项的组名[复选框的"data-group"]！');BJUI.setRegional("notchecked","未选中任何一项！");BJUI.setRegional("selectmsg","请选择一个选项！");BJUI.setRegional("validatemsg","提交的表单中 [{0}] 个字段有错误，请更正后再提交！");BJUI.setRegional("idChecked","不规范，ID需以字母开头，组成部分包括（0-9，字母，中横线，下划线）");BJUI.setRegional("uititle","B-JUI");BJUI.setRegional("maintab","我的主页");a.validator&&a.validator.config({rules:{digits:[/^\d+$/,"请输入整数"],number:[/^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/,"请输入有效的数字"],letters:[/^[a-z]+$/i,"{0}只能输入字母"],upletterandnumber:[/^[A-Z0-9]+$/,"只能输入大写字母和数字"],tel:[/^(?:(?:0\d{2,3}[\- ]?[1-9]\d{6,7})|(?:[48]00[\- ]?[1-9]\d{6}))$/,"请填写有效的电话号码"],mobile:[/^1[3-9]\d{9}$/,"手机号格式不正确"],email:[/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i,"请填写有效的邮箱"],qq:[/^[1-9]\d{4,}$/,"QQ号格式不正确"],date:[/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/,"请输入正确的日期，例：yyyy-MM-dd"],time:[/^(2[0123]|(1|0?)[0-9]){1}:([0-5][0-9]){1}:([0-5][0-9]){1}$/,"请输入正确的时间，例：HH:mm:ss"],datetime:[/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(2[0123]|(1|0?)[0-9]){1}:([0-5][0-9]){1}:([0-5][0-9]){1}$/,"请输入正确的日期时间，例：yyyy-MM-dd HH:mm:ss"],IDcard:[/^\d{6}(19|2\d)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)?$/,"请填写正确的身份证号码"],url:[/^(https?|s?ftp):\/\/\S+$/i,"请填写有效的网址"],zipcode:[/^\d{6}$/,"请检查邮政编码格式"],chinese:[/^[\u0391-\uFFE5]+$/,"请输入中文"],username:[/^\w{3,12}$/,"请输入3-12位数字、字母、下划线"],password:[/^[\S]{6,16}$/,"请填写6-16位字符，不能包含空格"],pattern:function(c,d){if(!d){return true}var b=c.value.parseDate(d);return(!b?this.renderMsg("错误的日期时间格式！",d):true)},accept:function(b,e){if(!e){return true}var c=e[0],d=a(b).val();return(c==="*")||(new RegExp(".(?:"+c+")$","i")).test(d)||this.renderMsg("只接受{1}后缀的文件",c.replace(/\|/g,","))}},messages:{0:"此处",fallback:"{0}格式不正确",loading:"正在验证...",error:"网络异常",timeout:"请求超时",required:"{0}不能为空",remote:"{0}已被使用",integer:{"*":"请填写整数","+":"请填写正整数","+0":"请填写正整数或0","-":"请填写负整数","-0":"请填写负整数或0"},match:{eq:"{0}与{1}不一致",neq:"{0}与{1}不能相同",lt:"{0}必须小于{1}",gt:"{0}必须大于{1}",lte:"{0}不能大于{1}",gte:"{0}不能小于{1}"},range:{rg:"请填写{1}到{2}的数",gte:"请填写不小于{1}的数",lte:"请填写最大{1}的数",gtlt:"请填写{1}到{2}之间的数",gt:"请填写大于{1}的数",lt:"请填写小于{1}的数"},checked:{eq:"请选择{1}项",rg:"请选择{1}到{2}项",gte:"请至少选择{1}项",lte:"请最多选择{1}项"},length:{eq:"请填写{1}个字符",rg:"请填写{1}到{2}个字符",gte:"请至少填写{1}个字符",lte:"请最多填写{1}个字符",eq_2:"",rg_2:"",gte_2:"",lte_2:""}}})})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(a){BJUI.setRegional("alertmsg",{title:{error:"Error",info:"Info",warn:"Warning",correct:"Correct",confirm:"Confirm",prompt:"Prompt"},btnMsg:{ok:"OK",yes:"YES",no:"NO",cancel:"Cancel"}});
    BJUI.setRegional("dialog",{close:"Close",maximize:"Maximize",restore:"Restore",minimize:"Minimize",title:"Popup window"});BJUI.setRegional("orderby",{asc:"Asc",desc:"Desc"});BJUI.setRegional("pagination",{first:"First page",last:"Last page",prev:"Prev page",next:"Next page",jumpto:"Jump page number",jump:"Jump"});BJUI.setRegional("datagrid",{asc:"ASC",desc:"DESC",showhide:"Show/Hide columns",filter:"Filter",clear:"Clear",lock:"Lock",unlock:"Unlock",add:"Add",edit:"Edit",save:"Save",update:"Update",cancel:"Cancel",del:"Delete",prev:"Prev",next:"Next",refresh:"Refresh",query:"Query","import":"Import","export":"Export",exportf:"Export filter",all:"All","true":"True","false":"False",noData:"No data!",fAndS:"Filter && Sort!",expandMsg:"Click here to expand the tr!",shrinkMsg:"Click here to shrink the tr!",selectMsg:"Not selected any rows!",saveMsg:"No rows need to save!",editMsg:"Please save the edited row!",delMsg:"Sure you want to delete this row?",delMsgM:"Sure you want to delete selected rows?",errorData:"Did not get the correct data!",failData:"Request data failed!"});BJUI.setRegional("findgrid",{choose:"Choose the selected item",append:"Append choose the selected item",empty:"Empty existing values"});BJUI.setRegional("progressmsg","Data loading, please waiting...");BJUI.setRegional("datepicker",{close:"Close",prev:"Prev month",next:"Next month",clear:"Clear",ok:"OK",dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});BJUI.setRegional("navtabCM",{refresh:"Refresh navtab",close:"Close navtab",closeother:"Close other navtab",closeall:"Close all navtab"});BJUI.setRegional("dialogCM",{refresh:"Refresh dialog",close:"Close dialog",closeother:"Close other dialog",closeall:"Close all dialog"});BJUI.setRegional("statusCode_503","HTTP status 503, the current server load is too large or is down for maintenance!");BJUI.setRegional("ajaxnosend","Communication with the server is interrupted, please check the URL link or server status!");BJUI.setRegional("sessiontimout","Session timeout, please login!");BJUI.setRegional("plhmsg","Placeholder corresponding selector None Valid!");BJUI.setRegional("nocheckgroup",'Undefined group name selected item [check box "data-group"]!');BJUI.setRegional("notchecked","Unchecked any one!");BJUI.setRegional("selectmsg","Please select one option!");BJUI.setRegional("validatemsg","Submitted form data has [{0}] field an error, please after modified submitting!");BJUI.setRegional("idChecked","is not standardized, ID need to start with a letter, components include (0-9, letters, hyphens, underscore)");BJUI.setRegional("uititle","B-JUI");BJUI.setRegional("maintab","My home");window.FRAG={dialog:'<div class="bjui-dialog bjui-dialog-container" style="top:150px; left:300px;">'+'    <div class="dialogHeader" onselectstart="return false;" oncopy="return false;" onpaste="return false;" oncut="return false;">'+'        <a class="close" href="javascript:;" title="#close#"><i class="fa fa-times"></i></a>'+'        <a class="maximize" href="javascript:;" title="#maximize#"><i class="fa fa-square-o"></i></a>'+'        <a class="restore" href="javascript:;" title="#restore#"><i class="fa fa-clone fa-rotate-90"></i></a>'+'        <a class="minimize" href="javascript:;" title="#minimize#"><i class="fa fa-minus"></i></a>'+'        <h1><span><i class="fa fa-th-large"></i></span> <span class="title">#title#</span></h1>'+"    </div>"+'    <div class="dialogContent unitBox"></div>'+'    <div class="resizable_h_l" tar="nw"></div>'+'    <div class="resizable_h_r" tar="ne"></div>'+'    <div class="resizable_h_c" tar="n"></div>'+'    <div class="resizable_c_l" tar="w" style="height:100%;"></div>'+'    <div class="resizable_c_r" tar="e" style="height:100%;"></div>'+'    <div class="resizable_f_l" tar="sw"></div>'+'    <div class="resizable_f_r" tar="se"></div>'+'    <div class="resizable_f_c" tar="s"></div>'+"</div>",taskbar:'<div id="bjui-taskbar" style="left:0px; display:none;">'+'    <div class="taskbarContent">'+"        <ul></ul>"+"    </div>"+'    <div class="taskbarLeft taskbarLeftDisabled"><i class="fa fa-angle-double-left"></i></div>'+'    <div class="taskbarRight"><i class="fa fa-angle-double-right"></i></div>'+"</div>",splitBar:'<div id="bjui-splitBar"></div>',splitBarProxy:'<div id="bjui-splitBarProxy"></div>',resizable:'<div id="bjui-resizable" class="bjui-resizable"></div>',alertBackground:'<div class="bjui-alertBackground"></div>',maskBackground:'<div class="bjui-maskBackground bjui-ajax-mask"></div>',maskProgress:'<div class="bjui-maskProgress bjui-ajax-mask"><i class="fa fa-cog fa-spin"></i>&nbsp;&nbsp;#progressmsg#<div class="progressBg"><div class="progress"></div></div></div>',progressBar_custom:'<div id="bjui-progressBar-custom" class="progressBar"><i class="fa fa-cog fa-spin"></i> <span></span></div>',dialogMask:'<div class="bjui-dialogBackground"></div>',orderby:'<a href="javascript:;" class="order asc" data-order-direction="asc" title="#asc#"><i class="fa fa-angle-up"></i></a>'+'<a href="javascript:;" class="order desc" data-order-direction="desc" title="#desc#"><i class="fa fa-angle-down"></i></a>',slidePanel:'<div class="panel panel-default">'+'    <div class="panel-heading">'+'        <h4 class="panel-title"><a data-toggle="collapse" data-parent="#bjui-accordionmenu" href="##id#" class="#class#">#icon#&nbsp;#title#<b>#righticon#</b></a></h4>'+"    </div>"+'    <div id="#id#" class="panel-collapse collapse#bodyclass#">'+'        <div class="panel-body">'+"        </div>"+"    </div>"+"</div>",gridPaging:'<ul class="pagination">'+'    <li class="page-total">'+'        <span title="#total#">#count#</span>'+"    </li>"+'    <li class="page-jumpto"><span class="page-input"><input class="form-control input-sm-pages" type="text" size="3.2" value="#pageCurrent#" title="#jumpto#"></span></li>'+'    <li class="page-first btn-nav">'+'        <a href="javascript:;" title="#first#"><i class="fa fa-step-backward"></i></a>'+"    </li>"+'    <li class="page-prev btn-nav">'+'        <a href="javascript:;" title="#prev#"><i class="fa fa-backward"></i></a>'+"    </li>"+"    #pageNumFrag#"+'    <li class="page-next btn-nav">'+'        <a href="javascript:;" title="#next#"><i class="fa fa-forward"></i></a>'+"    </li>"+'    <li class="page-last btn-nav">'+'        <a href="javascript:;" title="#last#"><i class="fa fa-step-forward"></i></a>'+"    </li>"+"</ul>",gridPageNum:'<li class="page-num#active#"><a href="javascript:;">#num#</a></li>',gridMenu:'<div class="datagrid-menu-box">'+"    <ul>"+'        <li class="datagrid-li-asc"><a href="javascript:;"><span class="icon"><i class="fa fa-sort-amount-asc"></i></span><span class="title">#asc#</span></a></li>'+'        <li class="datagrid-li-desc"><a href="javascript:;"><span class="icon"><i class="fa fa-sort-amount-desc"></i></span><span class="title">#desc#</span></a></li>'+'        <li class="datagrid-li-filter"><a href="javascript:;"><span class="icon"><i class="fa fa-filter"></i></span><span class="title">#filter#</span><span class="arrow"></span></a></li>'+'        <li class="datagrid-li-showhide"><a href="javascript:;"><span class="icon"><i class="fa fa-check-square-o"></i></span><span class="title">#showhide#</span><span class="arrow"></span></a></li>'+'        <li class="datagrid-li-lock"><a href="javascript:;"><span class="icon"><i class="fa fa-lock"></i></span><span class="title">#lock#</span></a></li>'+'        <li class="datagrid-li-unlock disable"><a href="javascript:;"><span class="icon"><i class="fa fa-unlock"></i></span><span class="title">#unlock#</span></a></li>'+"    </ul>"+"</div>",gridFilter:'<div class="datagrid-filter-box">'+"<fieldset>"+"<legend>#label#</legend>"+'<span class="filter-a"></span>'+'<span class="filter-and"><select data-toggle="selectpicker" data-container="true" data-width="100%"><option value="and">AND</option><option value="or">OR</option></select></span>'+'<span class="filter-b"></span>'+'<span class="filter-ok"><button type="button" class="btn-green ok" data-icon="check">#filter#</button><button type="button" class="btn-orange clear" data-icon="remove">#clear#</button></span>'+"</fieldset>"+"</div>",gridShowhide:'<li data-index="#index#" class="datagrid-col-check"><a href="javascript:;"><i class="fa fa-check-square-o"></i>#label#</a></li>',gridEditBtn:'<button type="button" class="btn btn-green bjui-datagrid-btn edit"><i class="fa fa-edit"></i> #edit#</button>'+'<button type="button" class="btn btn-green bjui-datagrid-btn update"><i class="fa fa-edit"></i> #update#</button>'+'<button type="button" class="btn btn-green bjui-datagrid-btn save"><i class="fa fa-check"></i> #save#</button>'+'<button type="button" class="btn btn-orange bjui-datagrid-btn cancel"><i class="fa fa-undo"></i> #cancel#</button>'+'<button type="button" class="btn btn-red bjui-datagrid-btn delete"><i class="fa fa-remove"></i> #del#</button>',gridDialogEditBtns:"<ul>"+'    <li class="pull-left"><button type="button" class="btn btn-orange prev" data-icon="arrow-up">#prev#</button></li>'+'    <li class="pull-left"><button type="button" class="btn btn-orange next" data-icon="arrow-down">#next#</button></li>'+'    <li><button type="button" class="btn btn-red cancel" data-icon="remove">#cancel#</button></li>'+'    <li><button type="button" class="btn btn-default save" data-icon="save">#save#</button></li>'+"</ul>",gridExpandBtn:'<span title="#expandMsg#"><i class="fa fa-plus"></i></span>',gridShrinkBtn:'<span title="#shrinkMsg#"><i class="fa fa-minus"></i></span>',alertBoxFrag:'<div id="bjui-alertMsgBox" class="bjui-alert"><div class="alertContent"><div class="#type#"><div class="alertInner"><h1><i class="fa #fa#"></i>#title#</h1><div class="msg">#message##prompt#</div></div><div class="toolBar clearfix"><ul>#btnFragment#</ul></div></div></div></div>',alertBtnFrag:'<li><button class="btn btn-#class#" rel="#callback#" type="button">#btnMsg#</button></li>',calendarFrag:'<div id="bjui-calendar">'+'    <div class="main">'+'        <a class="close" href="javascript:;" title="#close#"><i class="fa fa-times-circle"></i></a>'+'        <div class="head">'+'            <table width="100%" border="0" cellpadding="0" cellspacing="2">'+"                <tr>"+'                    <td width="20"><a class="prev" href="javascript:;" title="#prev#"><i class="fa fa-arrow-left"></i></a></td>'+'                    <td><select name="year"></select></td>'+'                    <td><select name="month"></select></td>'+'                    <td width="20"><a class="next" href="javascript:;" title="#next#"><i class="fa fa-arrow-right"></i></a></td>'+"                </tr>"+"            </table>"+"        </div>"+'        <div class="body">'+'            <dl class="dayNames"><dt>7</dt><dt>1</dt><dt>2</dt><dt>3</dt><dt>4</dt><dt>5</dt><dt>6</dt></dl>'+'            <dl class="days"><!-- date list --></dl>'+'            <div style="clear:both;height:0;line-height:0"></div>'+"        </div>"+'        <div class="foot">'+'            <table class="time">'+"                <tr>"+"                    <td>"+'                        <input type="text" class="hh" maxlength="2" data-type="hh" data-start="0" data-end="23">:<input'+'                         type="text" class="mm" maxlength="2" data-type="mm" data-start="0" data-end="59">:<input'+'                         type="text" class="ss" maxlength="2" data-type="ss" data-start="0" data-end="59">'+"                    </td>"+'                    <td><ul><li class="up" data-add="1">&and;</li><li class="down">&or;</li></ul></td>'+"                </tr>"+"            </table>"+'            <button type="button" class="clearBtn btn btn-orange">#clear#</button>'+'            <button type="button" class="okBtn btn btn-default">#ok#</button>'+"        </div>"+'        <div class="tm">'+'            <ul class="hh">'+"                <li>0</li>"+"                <li>1</li>"+"                <li>2</li>"+"                <li>3</li>"+"                <li>4</li>"+"                <li>5</li>"+"                <li>6</li>"+"                <li>7</li>"+"                <li>8</li>"+"                <li>9</li>"+"                <li>10</li>"+"                <li>11</li>"+"                <li>12</li>"+"                <li>13</li>"+"                <li>14</li>"+"                <li>15</li>"+"                <li>16</li>"+"                <li>17</li>"+"                <li>18</li>"+"                <li>19</li>"+"                <li>20</li>"+"                <li>21</li>"+"                <li>22</li>"+"                <li>23</li>"+"            </ul>"+'            <ul class="mm">'+"                <li>0</li>"+"                <li>5</li>"+"                <li>10</li>"+"                <li>15</li>"+"                <li>20</li>"+"                <li>25</li>"+"                <li>30</li>"+"                <li>35</li>"+"                <li>40</li>"+"                <li>45</li>"+"                <li>50</li>"+"                <li>55</li>"+"            </ul>"+'            <ul class="ss">'+"                <li>0</li>"+"                <li>10</li>"+"                <li>20</li>"+"                <li>30</li>"+"                <li>40</li>"+"                <li>50</li>"+"            </ul>"+"        </div>"+"    </div>"+"</div>",spinnerBtn:'<ul class="bjui-spinner"><li class="up" data-add="1">&and;</li><li class="down">&or;</li></ul>',findgridBtn:'<a class="bjui-lookup" href="javascript:;" data-toggle="findgridbtn"><i class="fa fa-search"></i></a>',dateBtn:'<a class="bjui-lookup" href="javascript:;" data-toggle="datepickerbtn"><i class="fa fa-calendar"></i></a>',navtabCM:'<ul id="bjui-navtabCM">'+'    <li rel="reload"><span class="icon"><i class="fa fa-refresh"></i></span><span class="title">#refresh#</span></li>'+'    <li rel="closeCurrent"><span class="icon"><i class="fa fa-remove"></i></span><span class="title">#close#</li>'+'    <li rel="closeOther"><span class="icon"><i class="fa fa-remove"></i></span><span class="title">#closeother#</li>'+'    <li rel="closeAll"><span class="icon"><i class="fa fa-remove"></i></span><span class="title">#closeall#</li>'+"</ul>",dialogCM:'<ul id="bjui-dialogCM">'+'    <li rel="reload"><span class="icon"><i class="fa fa-refresh"></i></span><span class="title">#refresh#</span></li>'+'    <li rel="closeCurrent"><span class="icon"><i class="fa fa-remove"></i></span><span class="title">#close#</span></li>'+'    <li rel="closeOther"><span class="icon"><i class="fa fa-remove"></i></span><span class="title">#closeother#</span></li>'+'    <li rel="closeAll"><span class="icon"><i class="fa fa-remove"></i></span><span class="title">#closeall#</span></li>'+"</ul>",externalFrag:'<iframe src="{url}" style="width:100%;height:{height};" frameborder="no" border="0" marginwidth="0" marginheight="0"></iframe>'}
}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(a){a.fn.extend({ajaxUrl:function(d){var c=a(this),b=c;if(!b.length){b=c}c.trigger(BJUI.eventType.beforeAjaxLoad);if(d.loadingmask){b.trigger(BJUI.eventType.ajaxStatus)}a.ajax({type:d.type||"GET",url:d.url,data:d.data||{},cache:false,dataType:"html",timeout:BJUI.ajaxTimeout,success:function(e){var g=e.toJson(),f=b.find("> .bjui-ajax-mask");if(!g[BJUI.keys.statusCode]){c.empty().html(e).initui()}else{if(g[BJUI.keys.statusCode]==BJUI.statusCode.error){if(g[BJUI.keys.message]){c.alertmsg("error",g[BJUI.keys.message])}if(!c.closest(".bjui-layout").length){if(c.closest(".navtab-panel").length){c.navtab("closeCurrentTab")}else{c.dialog("closeCurrent")}}}else{if(g[BJUI.keys.statusCode]==BJUI.statusCode.timeout){if(c.closest(".bjui-dialog").length){c.dialog("closeCurrent")}if(c.closest(".navtab-panel").length){c.navtab("closeCurrentTab")}BJUI.alertmsg("info",(g[BJUI.keys.message]||BJUI.regional.sessiontimeout));BJUI.loadLogin()}}f.fadeOut("normal",function(){a(this).remove()})}if(a.isFunction(d.callback)){d.callback(e)}},error:function(g,e,f){c.bjuiajax("ajaxError",g,e,f);if(!c.closest(".bjui-layout").length){if(c.closest(".navtab-panel").length){c.navtab("closeCurrentTab")}else{c.dialog("closeCurrent")}}c.trigger("bjui.ajaxError")},statusCode:{0:function(g,e,f){BJUI.alertmsg("error",BJUI.regional.ajaxnosend)},503:function(g,e,f){BJUI.alertmsg("error",BJUI.regional.statusCode_503)}}})},loadUrl:function(b,c,d){a(this).ajaxUrl({url:b,data:c,callback:d})},doAjax:function(e){var d=a(this),b,c;d.data("holdSubmit",true);if(!e.url){BJUI.debug("The ajax url is undefined!");return}if(!e.callback){BJUI.debug("The ajax callback is undefined!");return}else{e.callback=e.callback.toFunc()}if(e.loadingmask){b=d.isTag("form")?d.closest(".bjui-pageContent"):d;if(!b.length){b=d}b.trigger(BJUI.eventType.ajaxStatus);c=b.find("> .bjui-ajax-mask")}if(!e.type){e.type="POST"}if(!e.dataType){e.dataType="json"}if(!e.cache){e.cache=false}e.timeout=e.ajaxTimeout||BJUI.ajaxTimeout;e.success=function(f){if(c){if(e.callback){a.when(e.callback(f)).done(function(){b.trigger("bjui.ajaxStop")})}else{b.trigger("bjui.ajaxStop")}}else{e.callback(f)}d.data("holdSubmit",false)};e.error=function(h,f,g){if(c){b.trigger("bjui.ajaxError")}d.bjuiajax("ajaxError",h,f,g);d.data("holdSubmit",false)};e.statusCode={0:function(h,f,g){BJUI.alertmsg("error",BJUI.regional.ajaxnosend);d.data("holdSubmit",false)},503:function(h,f,g){BJUI.alertmsg("error",BJUI.regional.statusCode_503);d.data("holdSubmit",false)}};a.ajax(e)},getPageTarget:function(){var b;if(this.closest(".bjui-layout").length){b=this.closest(".bjui-layout")}else{if(this.closest(".navtab-panel").length){b=a.CurrentNavtab}else{b=a.CurrentDialog}}return b},resizePageH:function(){return this.each(function(){if(a(this).closest(".tab-content").length){return}var g=a(this),d=g.find("> .bjui-pageHeader"),b=g.find("> .bjui-pageContent"),c=g.find("> .bjui-pageFooter"),f=d.outerHeight()||0,e=c.outerHeight()||0;if(c.css("bottom")){e+=parseInt(c.css("bottom"))||0}b.css({top:f,bottom:e});if(g.hasClass("dialogContent")&&!b.length){g.css({padding:10,overflow:"auto"})}})},getMaxIndexObj:function(c){var d=0,b=0;c.each(function(f){var e=parseInt(a(this).css("zIndex"))||1;if(d<e){d=e;b=f}});return c.eq(b)},serializeJson:function(){var c={};var b=this.serializeArray();a.each(b,function(){if(c[this.name]!==undefined){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}});return c},isTag:function(b){if(!b){return false}if(!a(this).prop("tagName")){return false}return a(this)[0].tagName.toLowerCase()==b?true:false},isBind:function(b){var c=a(this).data("events");return c&&b&&c[b]},log:function(b){return this.each(function(){if(console){console.log("%s: %o",b,this)}})}});a.extend(String.prototype,{isPositiveInteger:function(){return(new RegExp(/^[1-9]\d*$/).test(this))},isInteger:function(){return(new RegExp(/^\d+$/).test(this))},isNumber:function(){return(new RegExp(/^([-]{0,1}(\d+)[\.]+(\d+))|([-]{0,1}(\d+))$/).test(this))},isNormalID:function(){return(new RegExp(/^[a-zA-Z][0-9a-zA-Z_-]*$/).test(this))},includeChinese:function(){return(new RegExp(/[\u4E00-\u9FA5]/).test(this))},trim:function(){return a.trim(this)},startsWith:function(b){return this.indexOf(b)===0},endsWith:function(b){var c=this.length-b.length;return c>=0&&this.lastIndexOf(b)===c},replaceSuffix:function(b){return this.replace(/\[[0-9]+\]/,"["+b+"]").replace("#index#",b)},replaceSuffix2:function(b){return this.replace(/\-(i)([0-9]+)$/,"-i"+b).replace("#index#",b)},trans:function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},encodeTXT:function(){return(this).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;")},replaceAll:function(c,b){return this.replace(new RegExp(c,"gm"),b)
},replacePlh:function(b){b=b||a(document);return this.replace(/{\/?[^}]*}/g,function(c){var d=b.find(c.replace(/[{}]+/g,""));return d&&d.val()?d.val():c})},replaceMsg:function(b){return this.replace(new RegExp("({.*})","g"),b)},replaceTm:function(b){if(!b){return this}return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_-]*})","g"),function(c){return b[c.replace(/[{}]+/g,"")]})},replaceTmById:function(b){var c=b||a(document);return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_-]*})","g"),function(d){var e=c.find("#"+d.replace(/[{}]+/g,""));return e.val()?e.val():d})},isFinishedTm:function(){return !(new RegExp("{/?[^}]*}").test(this))},skipChar:function(b){if(!this||this.length===0){return""}if(this.charAt(0)===b){return this.substring(1).skipChar(b)}return this},isValidPwd:function(){return(new RegExp(/^([_]|[a-zA-Z0-9]){6,32}$/).test(this))},isValidMail:function(){return(new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(this.trim()))},isSpaces:function(){for(var b=0;b<this.length;b+=1){var c=this.charAt(b);if(c!=" "&&c!="\n"&&c!="\t"&&c!="\r"){return false}}return true},isPhone:function(){return(new RegExp(/(^([0-9]{3,4}[-])?\d{3,8}(-\d{1,6})?$)|(^\([0-9]{3,4}\)\d{3,8}(\(\d{1,6}\))?$)|(^\d{3,8}$)/).test(this))},isUrl:function(){return(new RegExp(/^[a-zA-z]+:\/\/([a-zA-Z0-9\-\.]+)([-\w .\/?%&=:]*)$/).test(this))},isExternalUrl:function(){return this.isUrl()&&this.indexOf("://"+document.domain)==-1},toBool:function(){return(this.toLowerCase()==="true")?true:false},toJson:function(){var b=this;try{if(typeof b==="object"){b=b.toString()}if(!b.trim().match("^{(.+:.+,*){1,}}$")){return this}else{return JSON.parse(this)}}catch(c){return this}},toObj:function(){var c=null;try{c=(new Function("return "+this))()}catch(b){c=this;BJUI.debug('String toObj：Parse "String" to "Object" error! Your str is: '+this)}return c},toFunc:function(){if(!this||!this.length){return undefined}if(this.startsWith("function")){return(new Function("return "+this))()}try{var d=this.split("."),c=window;for(var b=0;b<d.length;b++){c=c[d[b]]}if(typeof c==="function"){return c}}catch(f){return undefined}}});a.extend(Function.prototype,{toFunc:function(){return this}});a.extend(Array.prototype,{remove:function(b){if(b<0){return this}else{return this.slice(0,b).concat(this.slice(b+1,this.length))}},swap:function(e,d){var b=this,c=b[e];b[e]=b[d];b[d]=c;return this},move:function(d,b){if(d<0||b<0){return this}if(b>=this.length){var c=b-this.length;while((c--)+1){this.push(undefined)}}this.splice(b,0,this.splice(d,1)[0]);return this},moveItems:function(e,c,b){if(!b||c==e){return this}var d=this.slice(e,e+b);if(e>c){this.splice(e,b)}this.splice.apply(this,[c,0].concat(d));if(e<c){this.splice(e,b)}return this},unique:function(){var b=new Array();this.sort();for(var c=0;c<this.length;c++){if(this[c]==this[c+1]){continue}b[b.length]=this[c]}return b},myIndexOf:function(d){if(!this||!this.length){return -1}for(var c=0,b;b=this[c];c++){if(b==d){return c}}return -1},toJson:function(){var c={};var b=this;a.each(b,function(){if(c[this.name]!==undefined){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}});return c}});a.isJson=function(d){var b=true;try{b=a.parseJSON(d)}catch(c){return false}return b?true:false}}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(d){var a=function(f,e){this.$element=d(f);this.options=e;this.tools=this.TOOLS()};a.prototype.TOOLS=function(){var e={isOver:function(l,g,m){var k=l.offset(),j=k.left,i=k.top,h=l.outerWidth(),f=l.outerHeight();return(g>j&&g<(j+h))&&(m>i&&m<(i+f))},mouseDirection:function(h,j){var f=d(h),k=["top","right","bottom","left"];var g=function(o){var m=f.outerWidth(),n=f.outerHeight(),p=f.offset(),l=(o.pageX-p.left-(m/2))*(m>n?(n/m):1),q=(o.pageY-p.top-(n/2))*(n>m?(m/n):1);return Math.round((((Math.atan2(q,l)*(180/Math.PI))+180)/90)+3)%4};j=d.extend({},{move:d.noop},j||{});var i=g(j.e);j.move(f,k[i])}};return e};a.prototype.init=function(){var e=this;e.$drag=this.$element;e.options.$obj=this.$element;if(e.options.obj){this.options.$obj=this.options.obj}if(e.options.event){e.hasEvent=true;e.start(this.options.event)}else{if(e.options.selector){e.$drag=e.$element.find(e.options.selector)}if(e.$drag.length){e.$drag.on("mousedown",function(f){e.start.apply(e,[f]);e.options.event=f})}}};a.prototype.start=function(h){d(document).on("selectstart",false);var g=this,f=g.options;if(f.exclude){var i=g.$element.find(f.exclude);if(i.length&&d.inArray(h.target,i.add(i.find("*")))!=-1){return false}}if(this.$element.css("position")==="static"){this.$element.css("position","absolute");!f.oleft&&(f.oleft=this.$element.position().left);!f.otop&&(f.otop=this.$element.position().top);this.$element.css("position","")}if(!f.oleft){f.oleft=parseInt(this.$element.css("left"))||0
}if(!f.otop){f.otop=parseInt(this.$element.css("top"))||0}d(document).on("mouseup.bjui.basedrag",function(j){g.stop.apply(g,[j])}).on("mousemove.bjui.basedrag",function(j){g.drag.apply(g,[j])})};a.prototype.drop=function(h){var g=this,f=g.options,i=f.drop;if(!i instanceof jQuery){i=d(i)}if(i.length){g.$drops=i;i.each(function(){if(g.tools.isOver(d(this),h.pageX,h.pageY)){d(this).trigger("dropover.bjui.basedrag",[h.pageX,h.pageY,g.$element]);g.isDrop=true;g.$drop=d(this);return false}else{d(this).trigger("dropout.bjui.basedrag",[h.pageX,h.pageY,g.$element]);g.isDrop=false}}).css("-moz-user-select","none")}};a.prototype.drag=function(j){if(!j){j=window.event}BJUI["bjui.basedrag"]=this.$element;var i=this,p=this.options,o=p.beforeDrag,h=p.treeData,m=this.$element.index(),g=p.oleft+(j.pageX-p.event.pageX),l=p.otop+(j.pageY-p.event.pageY);if(o&&typeof o==="string"){o=o.toFunc()}if(o&&typeof o==="function"){if(this.$element.next().hasClass("datagrid-child-tr")){m=m/2}if(!o.apply(this,[this.$element,(h?h[m]:"")])){return false}}if(p.drop){p.move=""}if(p.move==="horizontal"){if((p.minW&&g>=parseInt(this.options.$obj.css("left"))+p.minW)&&(p.maxW&&g<=parseInt(this.options.$obj.css("left"))+p.maxW)){this.$element.css("left",g)}else{if(p.scop){if(p.relObj){if((g-parseInt(p.relObj.css("left")))>p.cellMinW){this.$element.css("left",g)}else{this.$element.css("left",g)}}}}}else{if(p.move==="vertical"){this.$element.css("top",l)}else{var n=p.selector?this.options.$obj.find(p.selector):this.options.$obj;if(p.drop){var k=d("#bjui-drag-placeholder");if(!k.length){k=d('<div style="position:absolute; z-index:999;" id="bjui-drag-placeholder"></div>').appendTo(d("body"))}k.css({left:j.pageX,top:j.pageY,opacity:1}).show().empty().append(this.$element.clone());this.$placeholder=k}else{this.$element.css({left:g,top:l})}}}if(p.drag){p.drag.apply(this.$element,[this.$element,j,g,l])}if(p.drop){i.drop(j)}if(p.container){if(!p.container instanceof jQuery){p.container=d(p.container)}var f=p.container.scrollTop();if(!f){p.container.scrollTop(1)}if(p.container.scrollTop()){i.tools.mouseDirection(p.container,{e:j,move:function(e,q){if(q==="top"||q==="bottom"){p.container.scrollTop(p.container.scrollTop()+(j.clientY-p.event.clientY)/13)}}})}}return this.preventEvent(j)};a.prototype.stop=function(g){var f=this;d(document).off("mousemove.bjui.basedrag").off("mouseup.bjui.basedrag").off("mouseover.bjui.basedrag");f.options.drop&&f.options.drop.off("mouseenter.bjui.basedrag");if(this.options.stop){this.options.stop.apply(this.$element,[this.$element,g])}if(this.hasEvent){this.destroy()}else{f.$drag.off("mousedown").on("mousedown",d.proxy(function(i){f.options.event=i;f.options.oleft=0;f.options.otop=0;f.start(i)},f))}if(f.options.drop&&!f.isDrop){var h=f.$element.offset();f.$placeholder&&f.$placeholder.animate({top:h.top,left:h.left,opacity:0.2},"normal",function(){f.$placeholder.hide()})}if(f.isDrop){f.$placeholder&&f.$placeholder.hide();f.$drop&&f.$drop.trigger("drop.bjui.basedrag",[f.$element])}f.$drops&&f.$drops.css("-moz-user-select","");d(document).off("selectstart");return this.preventEvent(g)};a.prototype.preventEvent=function(f){if(f.stopPropagation){f.stopPropagation()}if(f.preventDefault){f.preventDefault()}return false};a.prototype.destroy=function(){this.$element.removeData("bjui.basedrag");if(!this.options.nounbind){this.$element.off("mousedown")}};function c(f){var e=arguments;var g=f;return this.each(function(){var j=d(this);var h=d.extend({},j.data(),typeof f==="object"&&f);var i=j.data("bjui.basedrag");if(!i){j.data("bjui.basedrag",(i=new a(this,h)))}if(typeof g==="string"&&d.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}else{i.init()}})}var b=d.fn.basedrag;d.fn.basedrag=c;d.fn.basedrag.Constructor=a;d.fn.basedrag.noConflict=function(){d.fn.basedrag=b;return this}}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(c){var d=function(f,e){this.$element=c(f);this.options=e};d.prototype.ajaxHnav=function(){var h=this,o=h.options,f=o.childKey||"children",j=h.$element.parent(),e=c("#bjui-sidenav-box"),g=BJUI.StrBuilder(),k=c("#bjui-sidenav-btn");var m=function(p){var r=BJUI.StrBuilder(),q=p.target||"navtab";r.add('<a href="'+(p.url||"javascript:;")+'" ');if(p.url&&(q==="dialog"||q==="navtab")){r.add('data-toggle="'+q+'" data-options="{id:\''+p.id+"', title:'"+(p.title||p.name)+"'");if(p.width){r.add(", width:"+p.width)}if(p.height){r.add(", height:"+p.height)}if(p.fresh){r.add(", fresh:"+p.fresh)}if(p.mask){r.add(", mask:"+p.mask)}r.add('}"')}else{if(p.url){r.add('target="'+q+'"')}}if(p[f]){r.add(' class="right-arrow"')}r.add('><i class="fa fa-'+(p.icon||"caret-right")+'"></i>&nbsp;'+p.name);if(p[f]){r.add('<b><i class="fa fa-angle-right"></i></b>')}r.add("</a>").add(n(p));return r.toString()};var n=function(q){var p=BJUI.StrBuilder();if(q[f]){p.add('<ul class="nav">');
    c.each(q[f],function(s,r){var t=r.target||"navtab",u=r.id&&String(r.id).isNormalID&&r.id;p.add("<li");if(t==="navtab"&&u&&r.url){p.add(' class="'+t+"-"+u+'"')}p.add(">").add(m(r)).add("</li>")});p.add("</ul>")}return p.toString()};var i=function(p){if(!c.isArray(p)){p=[p]}g.add('<ul class="nav">');c.each(p,function(q,t){var r=t.target||"navtab",s=t.id&&String(t.id).isNormalID&&t.id;g.add("<li");if(r==="navtab"&&s&&t.url){g.add(' class="'+r+"-"+s+'"')}g.add(">").add(m(t)).add("</li>")});g.add("</ul>");e.html(g.toString()).off("click").on("click",".nav > li > a",function(t){var s=c(this),q=s.next(".nav"),u=s.closest("li"),r=u.siblings();if(q.length){q.stop().slideToggle(function(){u.toggleClass("open",q.is(":visible"))});if(!u.hasClass("open")){r.find("> .nav").stop().slideUp(function(){c(this).closest("li").removeClass("open")})}}});j.data("bjui.sidenav.hnav.panels",e.find("> ul"));c(document).on("switch.bjui.navtab",function(s){var q=c("body").data("bjui.navtab"),r;if(q&&q.current){e.find("li").removeClass("active").filter(".navtab-"+q.current).addClass("active")}});if(BJUI.ui.displayFirst){e.find("> .nav > li:first > a").trigger("click")}!c("body").data("bjui.sidenav.init")&&k.is(":visible")&&(k.trigger("click"))};var l=function(r){var s=(typeof o.single==="undefined"||s),p,q=BJUI.StrBuilder();e.empty();if(s){p=c('<ul class="ztree" data-toggle="ztree" id="bjui-sidenav-ztree-0"></ul>').data("options",o.treeOptions).data("nodes",r);e.append(p).initui()}else{if(!c.isArray(r)){r=[r]}c.each(r,function(t,u){p=c('<ul class="ztree" data-toggle="ztree" id="bjui-sidenav-ztree-'+t+'"></ul>').data("options",o.treeOptions).data("nodes",r);e.append(p)});e.initui()}!c("body").data("bjui.sidenav.init")&&k.is(":visible")&&(k.trigger("click"))};BJUI.ajax("doajax",{url:o.url,loadingmask:false,target:e,okCallback:o.tree?l:i})};d.prototype.initHnav=function(){var i=this,r=i.options,g=r.childKey||"children",e=r.targetKey||"target",l=r.idKey||"id",k=i.$element.parent(),f=c("#bjui-sidenav-box"),m=c("#bjui-sidenav-btn"),h=BJUI.StrBuilder(),p;var o=function(s){if(!s){s={}}var u=BJUI.StrBuilder(),t=s[e]||"navtab";u.add('<a href="'+(s.url||"javascript:;")+'" ');if(s.url&&(t==="dialog"||t==="navtab")){u.add('data-toggle="'+t+'" data-options="{id:\''+s[l]+"', title:'"+(s.title||s.name)+"'");if(s.width){u.add(", width:"+s.width)}if(s.height){u.add(", height:"+s.height)}if(s.fresh){u.add(", fresh:"+s.fresh)}if(s.mask){u.add(", mask:"+s.mask)}u.add('}"')}else{if(s.url){u.add('target="'+t+'"')}}if(s[g]){u.add(' class="right-arrow"')}u.add('><i class="fa fa-'+(s.icon||"caret-right")+'"></i>&nbsp;'+s.name);if(s[g]){u.add('<b><i class="fa fa-angle-right"></i></b>')}u.add("</a>").add(q(s));return u.toString()};var q=function(t){var s=BJUI.StrBuilder();if(t[g]){s.add('<ul class="nav">');c.each(t[g],function(v,u){var w=u.target||"navtab",x=u[l]&&String(u[l]).isNormalID&&u[l];s.add("<li");if(w==="navtab"&&x&&u.url){s.add(' class="'+w+"-"+x+'"')}s.add(">").add(o(u)).add("</li>")});s.add("</ul>")}return s.toString()};var j=function(s){if(!c.isArray(s)){s=[s]}h.add('<ul class="nav">');c.each(s,function(t,w){var u=w.target||"navtab",v=w[l]&&String(w[l]).isNormalID&&w[l];h.add("<li");if(u==="navtab"&&v&&w.url){h.add(' class="'+u+"-"+v+'"')}h.add(">").add(o(w)).add("</li>")});h.add("</ul>");f.html(h.toString()).off("click").on("click",".nav > li > a",function(w){var v=c(this),t=v.next(".nav"),x=v.closest("li"),u=x.siblings();if(t.length){t.stop().slideToggle(function(){x.toggleClass("open",t.is(":visible"))});if(!x.hasClass("open")){u.find("> .nav").stop().slideUp(function(){c(this).closest("li").removeClass("open")})}}});k.data("bjui.sidenav.hnav.panels",f.find("> ul"));c(document).on("switch.bjui.navtab",function(v){var t=c("body").data("bjui.navtab"),u;if(t&&t.current){f.find("li").removeClass("active").filter(".navtab-"+t.current).addClass("active")}});if(BJUI.ui.displayFirst){f.find("> .nav > li:first > a").trigger("click")}!c("body").data("bjui.sidenav.init")&&m.is(":visible")&&(m.trigger("click"))};var n=function(u){var v=(typeof r.single==="undefined"||v),s,t=BJUI.StrBuilder();f.empty();if(v){s=c('<ul class="ztree" data-toggle="ztree" id="bjui-sidenav-ztree-0"></ul>').data("options",r.treeOptions).data("nodes",u);f.append(s).initui()}else{if(!c.isArray(u)){u=[u]}c.each(u,function(w,x){s=c('<ul class="ztree" data-toggle="ztree" id="bjui-sidenav-ztree-'+w+'"></ul>').data("options",r.treeOptions).data("nodes",u);f.append(s)});f.initui()}!c("body").data("bjui.sidenav.init")&&m.is(":visible")&&(m.trigger("click"))};p=i.$element.next(".items").html();if(p){p=c.parseJSON(p);r.tree?n(p):j(p)}};function b(f){var e=arguments;var g=f;return this.each(function(){var j=c(this);var h=c.extend({},j.data(),typeof f==="object"&&f);var i=j.data("bjui.sidenav");if(!i){j.data("bjui.sidenav",(i=new d(this,h)))}if(typeof g==="string"&&c.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}})}var a=c.fn.sidenav;c.fn.sidenav=b;c.fn.sidenav.Constructor=d;
    c.fn.basedrag.noConflict=function(){c.fn.sidenav=a;return this};c(function(){c("#bjui-sidenav-col").on("click.bjui.sidenav",".nav > li > a",function(){var e=c("#bjui-sidenav-col");if(c(this).hasClass("right-arrow")){return false}if(e.hasClass("autohide")){c("#bjui-sidenav-arrow").trigger("click")}})});c(document).on("click.bjui.sidenav.data-api",'[data-toggle="sidenav"]',function(l){l.preventDefault();var i=c("body"),k=c(this),g=k.data("url")||k.attr("href"),f=k.data("cache"),m=c(this).parent(),j=c("#bjui-sidenav-box"),h=m.data("bjui.sidenav.hnav.panels");if(typeof i.data("bjui.sidenav.init")==="undefined"){i.data("bjui.sidenav.init",true)}else{i.data("bjui.sidenav.init",false)}m.addClass("active").siblings().removeClass("active");if(g&&!(g.startsWith("#")||g.startsWith("javascript"))){if(f&&h&&h.length){j.append(h)}else{k.data("url",g);b.call(k,"ajaxHnav")}}else{j.find("> .nav").detach();if(h&&h.length){j.append(h)}else{b.call(k,"initHnav")}}})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(f){var e,c,g;f(function(){var h=function(){e=f('<div id="bjui-contextmenu"></div>').hide();c=f('<div id="bjui-contextmenuShadow"></div>').hide();g=[];f("body").append("<!-- contextmenu -->").append(e).append(c)};h()});var a=function(i,h){this.$element=f(i);this.options=h};a.DEFAULTS={id:undefined,shadow:true,bindings:{},ctrSub:null};a.prototype.init=function(){var i=this;var j=this.options;if(!j.id){return}g.push({id:j.id,shadow:j.shadow,bindings:j.bindings||{},ctrSub:j.ctrSub});var h=g.length-1;this.$element.on("contextmenu",function(k){i.display(h,this,k,j);return false})};a.prototype.display=function(l,j,m,q){var k=this;var p=g[l];var o=BJUI.regional[p.id];var n=FRAG[p.id];f.each(o,function(r,s){n=n.replace("#"+r+"#",o[r])});e.html(n);f.each(p.bindings,function(s,r){f('[rel="'+s+'"]',e).on("click",function(t){k.hide();r(f(j),f("#bjui-"+p.id))})});var i=m.pageX;var h=m.pageY;if(f(window).width()<i+e.width()){i-=e.width()}if(f(window).height()<h+e.height()){h-=e.height()}e.css({"left":i,"top":h}).show();if(p.shadow){c.css({width:e.width(),height:e.height(),left:i+3,top:h+3}).show()}f(document).one("click",k.hide);if(f.isFunction(p.ctrSub)){p.ctrSub(f(j),f("#bjui-"+p.id))}};a.prototype.hide=function(){e.hide();c.hide()};a.prototype.show=function(h){var i=this;if(h.items&&h.items.length){i.$element.on("contextmenu",function(k){var j=true;if(h.exclude){i.$element.find(h.exclude).each(function(){if(this==k.target||f(this).find(k.target).length){j=false;return}})}if(!j){k.stopPropagation();return !j}else{i.custom(h.items,k)}return false})}};a.prototype.custom=function(h,l){e.empty().html("<ul></ul>");var k=this;var j=k.options;var i=e.find("> ul"),o;f.each(h,function(p,r){var q="";if(r.icon){q='<i class="fa fa-'+r.icon+'"></i>'}if(r.title=="diver"){o=f('<li class="diver"></li>')}else{o=f('<li><span class="icon">'+q+'</span><span class="title">'+r.title+"</span></li>");if(r.func&&typeof r.func==="string"){r.func=r.func.toFunc()}if(r.func){o.on("click",function(s){k.hide();r.func(k.$element,o)})}}o.appendTo(i)});var n=l.pageX;var m=l.pageY;if(f(window).width()<n+e.width()){n-=e.width()}if(f(window).height()<m+e.height()){m-=e.height()}e.css({"left":n,"top":m}).show();if(j.shadow){c.css({width:e.width(),height:e.height(),left:n+3,top:m+3}).show()}f(document).one("click",k.hide)};function d(i){var h=arguments;var j=i;return this.each(function(){var m=f(this);var k=f.extend({},a.DEFAULTS,m.data(),typeof i==="object"&&i);var l=m.data("bjui.contextmenu");if(!l){m.data("bjui.contextmenu",(l=new a(this,k)))}if(typeof j==="string"&&f.isFunction(l[j])){[].shift.apply(h);if(!h){l[j]()}else{l[j].apply(l,h)}}else{l.init()}})}var b=f.fn.contextmenu;f.fn.contextmenu=d;f.fn.contextmenu.Constructor=a;f.fn.contextmenu.noConflict=function(){f.fn.contextmenu=b;return this}}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(g){var i,k,q,c,j,d,a,m,h,n,f,b,o;g(function(){var r=function(){i=0;c=g("#bjui-navtab");j=c.find("> .tabsPageHeader > .tabsPageHeaderContent > .navtab-tab");d=c.find("> .navtab-panel");a=c.find("> .tabsPageHeader > .tabsLeft");m=c.find("> .tabsPageHeader > .tabsRight");h=c.find("> .tabsPageHeader > .tabsMore");n=c.find("> .tabsMoreList");f=j.find("li:first");b=n.find("li:first");a.click(function(){g(this).navtab("scrollPrev")});m.click(function(){g(this).navtab("scrollNext")});h.click(function(){n.show();var x=g(window).height(),v=n.height(),y=g("#bjui-top").height()+g("#bjui-navbar").height(),w=x-y-26;if(w<v){n.height(w-10)}else{n.height("")}});g(document).on("click.bjui.navtab.switchtab",function(w){var v=w.target.tagName=="I"?g(w.target).parent():g(w.target);if(h[0]!=v[0]){n.hide()}});var t,s=g.extend({},p.DEFAULTS,f.data(),{id:"main",title:t}),u=new p(s);
    g("body").data("bjui.navtab",{main:u,current:"main"});if(f.attr("data-url")){g(document).one(BJUI.eventType.initUI,function(v){f.removeAttr("data-url").navtab("reload",s)})}f.data("options",g.extend({},s)).navtab("contextmenu",f).click(function(){if(!g(this).hasClass("active")){BJUI.navtab("switchTab","main")}}).find("> a > span").html(function(w,v){return(t=v.replace("#maintab#",BJUI.regional.maintab))});if(f.attr("data-url")){g(document).one(BJUI.eventType.initUI,function(v){f.removeAttr("data-url").navtab("reload",s)})}setTimeout(function(){f.trigger("click")},100);b.click(function(){if(g(this).hasClass("active")){n.hide()}else{BJUI.navtab("switchTab","main")}}).find("> a").html(function(w,v){return v.replace("#maintab#",BJUI.regional.maintab)});g.CurrentNavtab=d.find("> .navtabPage").eq(0)};r()});var p=function(r){this.options=r;this.tools=this.TOOLS()};p.DEFAULTS={id:null,title:"New tab",url:null,type:"GET",data:{},loadingmask:true,fresh:false,autorefresh:false,onLoad:null,beforeClose:null,onClose:null};p.prototype.TOOLS=function(){var r=this;var s={getDefaults:function(){return p.DEFAULTS},getTabs:function(){return j.find("> li")},getPanels:function(){return d.find("> div")},getMoreLi:function(){return n.find("> li")},getTab:function(t){var u=this.indexTabId(t);if(u>=0){return this.getTabs().eq(u)}},getPanel:function(t){var u=this.indexTabId(t);if(u>=0){return this.getPanels().eq(u)}},getTabsW:function(u,t){return this.tabsW(this.getTabs().slice(u,t))},tabsW:function(t){var u=0;t.each(function(){u+=g(this).outerWidth(true)});return u},indexTabId:function(u){var t=-1;if(!u){return t}this.getTabs().each(function(v){if(g(this).data("options").id===u){t=v;return false}});return t},getLeft:function(){return j.position().left},getScrollBarW:function(){return c.width()-55},visibleStart:function(){var t=this.getTabs(),w=this.getLeft(),u=0,v=0;t.each(function(x){if(u+w>=0){v=x;return false}u+=g(this).outerWidth(true)});return v},visibleEnd:function(){var x=this,t=this.getTabs(),w=this.getLeft(),u=0,v=t.length;t.each(function(y){u+=g(this).outerWidth(true);if(u+w>x.getScrollBarW()){v=y;return false}});return v},scrollPrev:function(){var t=this.visibleStart();if(t>0){this.scrollTab(-this.getTabsW(0,t-1))}},scrollNext:function(){var t=this.visibleEnd();if(t<this.getTabs().size()){this.scrollTab(-this.getTabsW(0,t+1)+this.getScrollBarW())}},scrollTab:function(u,t){j.animate({left:u},150,function(){r.tools.ctrlScrollBtn()})},scrollCurrent:function(){var t=this.tabsW(this.getTabs()),u=this.getScrollBarW();if(t<=u){this.scrollTab(0)}else{if(this.getLeft()<u-t){this.scrollTab(u-t)}else{if(i<this.visibleStart()){this.scrollTab(-this.getTabsW(0,i))}else{if(i>=this.visibleEnd()){this.scrollTab(u-this.getTabs().eq(i).outerWidth(true)-this.getTabsW(0,i))}}}}},ctrlScrollBtn:function(){var t=this.tabsW(this.getTabs());if(this.getScrollBarW()>t){a.hide();m.hide();j.parent().removeClass("tabsPageHeaderMargin")}else{a.show().removeClass("tabsLeftDisabled");m.show().removeClass("tabsRightDisabled");j.parent().addClass("tabsPageHeaderMargin");if(this.getLeft()>=0){a.addClass("tabsLeftDisabled")}else{if(this.getLeft()<=this.getScrollBarW()-t){m.addClass("tabsRightDisabled")}}}},switchTab:function(y){var x=this.getTabs().removeClass("active").eq(y).addClass("active"),w=this.getPanels(),z=w.eq(y),v=r.options.onSwitch?r.options.onSwitch.toFunc():null;var u=g(FRAG.maskBackground);w.css({top:"-10000000px"});if(x.data("reloadFlag")){z.animate({top:0});r.refresh(x.data("options").id)}else{if(z.find(".bjui-ajax-mask").length){z.css({top:0})}else{z.css({top:0}).append(u);u.fadeOut("normal",function(){g(this).remove()})}}this.getMoreLi().removeClass("active").eq(y).addClass("active");i=y;this.scrollCurrent();k=x;g.CurrentNavtab=q=z;if(v){v.apply(r)}var t=g("body").data("bjui.navtab"),A=x.data("options").id;if(A!==r.options.id){t.current=A}else{t.current=r.options.id}z.trigger("switch.bjui.navtab")},closeTab:function(x,u){var B=this.getTabs().eq(x),w=this.getMoreLi().eq(x),C=this.getPanels().eq(x),D=B.data("options"),y=D.beforeClose?D.beforeClose.toFunc():null,A=D.onClose?D.onClose.toFunc():null,t=true;if(y){t=y.apply(r,[C])}if(!t){r.tools.switchTab(x);return}B.remove();w.remove();C.trigger(BJUI.eventType.beforeCloseNavtab).remove();if(o){clearInterval(o)}if(A){A.apply(r)}if(i>=x){i--}if(u){var z=this.indexTabId(u);if(z>0){i=z}}var v=g("body").data("bjui.navtab");if(v[D.id]){delete v[D.id]}this.scrollCurrent();this.switchTab(i)},closeOtherTab:function(t){t=t||i;this.getTabs().each(function(u){if(u>0&&t!=u){g(this).find("> .close").trigger("click")}})},loadUrlCallback:function(t){t.find(":button.btn-close").click(function(){r.closeCurrentTab()})},updateTit:function(t,u){this.getTabs().eq(t).find("> a").attr("title",u).find("> span").html(u);this.getMoreLi().eq(t).find("> a").attr("title",u).html(u)},reload:function(v,t){t=t||v.data("reloadFlag");var u=v.data("options");if(t){v.data("reloadFlag",false);var w=r.tools.getPanel(u.id);if(v.hasClass("external")){r.openExternal(u.url,w,u.data)
}else{r.tools.reloadTab(w,u)}}},reloadTab:function(w,t){var v=t.onLoad?t.onLoad.toFunc():null,u=t.autorefresh&&(isNaN(String(t.autorefresh))?15:t.autorefresh);w.trigger(BJUI.eventType.beforeLoadNavtab).ajaxUrl({type:(t.type||"GET"),url:t.url,data:t.data||{},loadingmask:t.loadingmask,callback:function(x){r.tools.loadUrlCallback(w);if(v){v.apply(r,[w])}if(o){clearInterval(o)}if(u){o=setInterval(function(){w.navtab("refresh")},u*1000)}if(BJUI.ui.clientPaging&&w.data("bjui.clientPaging")){w.pagination("setPagingAndOrderby",w)}}})}};return s};p.prototype.contextmenu=function(s){var r=this;s.contextmenu({id:"navtabCM",bindings:{reload:function(v,u){if(v.data("options").url){r.refresh(v.data("options").id)}},closeCurrent:function(w,u){var v=w.data("options").id;if(v){r.closeTab(v)}else{r.closeCurrentTab()}},closeOther:function(w,u){if(!w.index()){r.closeAllTab()}else{var v=r.tools.indexTabId(w.data("options").id);r.tools.closeOtherTab(v>0?v:i)}},closeAll:function(v,u){r.closeAllTab()}},ctrSub:function(x,u){var y=u.find('[rel="reload"]'),z=u.find('[rel="closeCurrent"]'),A=u.find('[rel="closeOther"]'),w=u.find('[rel="closeAll"]'),v=r.tools.getTabs();if(!x.index()){z.addClass("disabled");if(!x.data("options").url){y.addClass("disabled")}}}})};p.prototype.openTab=function(){var w=this,z=this.options,u=this.tools,r;if(!z.url&&z.href){z.url=z.href}if(!z.url){BJUI.debug("BJUI.Navtab: Error trying to open a navtab, url is undefined!");return}else{z.url=decodeURI(z.url).replacePlh();if(!z.url.isFinishedTm()){g("body").alertmsg("error",(z.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.Navtab: The new navtab's url is incorrect, url: "+z.url);return}z.url=encodeURI(z.url)}r=z.id?u.indexTabId(z.id):i;if(r>=0){var x=u.getTabs().eq(r),y=u.getPanels().eq(r),t=x.data("options");if(z.fresh||z.url!=t.url){w.reload(z)}else{if(z.title!=t.title){t.title=z.title;u.updateTit(r,z.title)}}i=r;if(z.id=="main"){this.contextmenu(x)}}else{var v='<li><a href="javascript:" title="#title#"><span>#title#</span></a><span class="close">&times;</span></li>',x=g(v.replaceAll("#title#",z.title)),y=g('<div class="navtabPage unitBox"></div>'),s=g('<li><a href="javascript:" title="#title#">#title#</a></li>'.replaceAll("#title#",z.title));x.appendTo(j);y.appendTo(d);s.appendTo(n);x.data("options",g.extend({},z));if(z.external||(z.url&&z.url.isExternalUrl())){x.addClass("external");this.openExternal(z.url,y,z.data)}else{x.removeClass("external");u.reloadTab(y,z)}i=u.getTabs().length-1;this.contextmenu(x);x.on("click",function(A){if(!g(this).hasClass("active")){w.switchTab(z.id)}}).on("click.bjui.navtab.close",".close",function(A){w.closeTab(z.id)}).on("mousedown.bjui.navtab.drag","a",function(A){x.data("bjui.navtab.drag",true);setTimeout(g.proxy(function(){if(x.data("bjui.navtab.drag")){w.drag(A,x,y,s)}},w),150);A.preventDefault()}).on("mouseup.bjui.navtab.drag","a",function(A){x.data("bjui.navtab.drag",false)});s.on("click",function(){w.switchTab(z.id)})}u.switchTab(i);u.scrollCurrent()};p.prototype.closeTab=function(r){var s=this.tools.indexTabId(r);if(s>0){this.tools.closeTab(s)}};p.prototype.closeCurrentTab=function(r){if(i>0){this.tools.closeTab(i,r)}};p.prototype.closeAllTab=function(){this.tools.getTabs().find("> .close").trigger("click")};p.prototype.reloadFlag=function(s){var r=s.split(",");for(var t=0;t<r.length;t++){var u=this.tools.getTab(r[t].trim());if(u){if(this.tools.indexTabId(r[t])==i){this.tools.reload(u,true)}else{u.data("reloadFlag",true)}}}};p.prototype.switchTab=function(r){var s=this.tools.indexTabId(r);this.tools.switchTab(s)};p.prototype.scrollPrev=function(){this.tools.scrollPrev()};p.prototype.scrollNext=function(){this.tools.scrollNext()};p.prototype.refresh=function(r){var s,t;if(!r){s=k}else{if(typeof r==="string"){s=this.tools.getTab(r)}else{s=r}}if(s&&s.length){t=this.tools.getPanel(s.data("options").id);t.removeData("bjui.clientPaging");this.reload(s.data("options"))}};p.prototype.reload=function(s){var t=this,r=g.extend({},typeof s==="object"&&s),u=r.id?this.tools.getTab(r.id):this.tools.getTabs().eq(i);if(u){var w=u.data("options");var v=function(){if(r.title&&r.title!=w.title){t.tools.updateTit(u.index(),r.title)}u.data("options",g.extend({},w,r));t.tools.reload(u,true)};if(w.reloadWarn){g("body").alertmsg("confirm",w.reloadWarn,{okCall:function(){v()}})}else{v()}}};p.prototype.reloadForm=function(s,v){var B=g.extend({},typeof v==="object"&&v),x=B.id?this.tools.getTab(B.id):k,A=B.id?this.tools.getPanel(B.id):q;if(x&&A){var w=x.data("options"),u={},r={},t=B.form;if(t&&t.length){B.type=B.type||t.attr("method")||"POST";B.url=B.url||t.attr("action");r=t.serializeJson();if(s){var z=BJUI.pageInfo;for(var y in z){u[z[y]]=r[z[y]]}}else{u=r}}B.data=g.extend({},B.data||{},u);if(!x.hasClass("external")){this.tools.reloadTab(A,B)}else{this.openExternal(B.url,A,B.data)}}};p.prototype.getCurrentPanel=function(){return this.tools.getPanels().eq(i)};p.prototype.checkTimeout=function(){var r=JSON.parse(q.html());if(r&&r[BJUI.keys.statusCode]==BJUI.statusCode.timeout){this.closeCurrentTab()
}};p.prototype.openExternal=function(r,u,t){var s=u.closest(".navtab-panel").height();if(t&&!g.isEmptyObject(t)){r.indexOf("?")?r+="&":"?";r+=g.param(t)}u.html(FRAG.externalFrag.replaceAll("{url}",r).replaceAll("{height}",s+"px"))};p.prototype.drag=function(E,F,H,z){var B=this,C=B.tools.getTabs(),u=B.tools.getPanels(),v=B.tools.getMoreLi(),x=j.next(".bjui-navtab-drag"),t=F.prev(),w=F.next(),A=F.index(),s=F.width(),D=F.position().left,r=[],y=[],G;if(C.length<=2){return}if(!x.length){x=g('<div class="bjui-navtab-drag" style="position:absolute; top:0; left:1px; width:2px; height:25px; background:#ff6600; display:none;"></div>');x.insertAfter(j)}x.css("left",D-2);j.find("> li").each(function(){r.push(g(this).position().left)});F.find("> a").basedrag({move:"horizontal",oleft:D,drag:function(I,L,K,J){F.addClass("navtab-drag");y=[K];g.merge(y,r);y.sort(function(N,M){return N-M});G=g.inArray(K,y);if(!G){G=1}if(G==C.length){x.css("left",r[G-1]-2+C.last().width())}else{x.css("left",r[G]-2)}x.show()},stop:function(){F.removeClass("navtab-drag");x.hide();if(A!=G){if(G==C.length){if(A!=C.length-1){F.insertAfter(C.eq(G-1));H.insertAfter(u.eq(G-1));z.insertAfter(v.eq(G-1))}}else{F.insertBefore(C.eq(G));H.insertBefore(u.eq(G));z.insertBefore(v.eq(G))}}},event:E,nounbind:true})};function l(u){var s=arguments,w=u,t="bjui.navtab",v=g("body"),r=v.data(t)||{};return this.each(function(){var z=g(this),x=g.extend({},p.DEFAULTS,typeof u==="object"&&u),A=x&&x.id,y=r&&r[r.current];if(typeof w==="string"&&g.isFunction(y[w])){if(!y){return}[].shift.apply(s);if(!s){y[w]()}else{y[w].apply(y,s)}}else{if(!A){A=r?r.current:"main";if(!BJUI.ui.overwriteHomeTab&&A==="main"){A="navtab"}}else{if(!A.isNormalID()){BJUI.debug("BJUI.Navtab: ID ["+A+"] "+BJUI.regional.idChecked);return}}x.id=A;if(!r[A]){r[A]=(y=new p(x))}else{y=r[A];if(typeof u==="object"&&u){g.extend(y.options,u)}}v.data(t,r);y.openTab()}})}var e=g.fn.navtab;g.fn.navtab=l;g.fn.navtab.Constructor=p;g.fn.navtab.noConflict=function(){g.fn.navtab=e;return this};BJUI.navtab=function(){l.apply(g("body"),arguments)};g(document).on("click.bjui.navtab.data-api",'[data-toggle="navtab"]',function(v){v.preventDefault();var u=g(this),r=u.attr("href"),t=u.data(),s=t.options;if(s){if(typeof s==="string"){s=s.toObj()}if(typeof s==="object"){g.extend(t,s)}}if(!t.title){t.title=u.text()}if(r&&!t.url){t.url=r}l.call(u,t)})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(g){var c;var f,h,d;g(function(){var i=function(){c=g("#bjui-resizable");h="dialogShadow";d=b.ZINDEX;g("body").append("<!-- dialog resizable -->").append(FRAG.resizable)};i()});var b=function(i){this.$element=g("body");this.options=i;this.tools=this.TOOLS()};b.DEFAULTS={id:null,title:"New Dialog",url:null,type:"GET",data:{},loadingmask:true,width:500,height:300,minW:65,minH:40,max:false,mask:false,resizable:true,drawable:true,maxable:true,minable:true,fresh:false,onLoad:null,beforeClose:null,onClose:null};b.ZINDEX=30;b.prototype.TOOLS=function(){var i=this;var j={getDefaults:function(){return b.DEFAULTS},init:function(o){var m=i.options.width>i.options.minW?i.options.width:i.options.minW;var l=i.options.height>i.options.minH?i.options.height:i.options.minH;var n=g(window).width(),k=g(window).height(),p=i.options.max?0:((k-l)/3);if(m>n){m=n}if(l>k){l=k}o.height(l).width(m).show().css({left:(n-m)/2,top:0,opacity:0.1}).animate({top:p>0?p:0,opacity:1}).addClass(h).find("> .dialogContent").height(l-g("> .dialogHeader",o).outerHeight());g("body").find("> .bjui-dialog-container").not(o).removeClass(h)},reload:function(p,l){var q=this,k=p.find("> .dialogContent"),n,o=l&&l.data,m;l=l||p.data("options");n=l.onLoad?l.onLoad.toFunc():null;p.trigger(BJUI.eventType.beforeLoadDialog);if(l.url){if(o){if(typeof o==="string"){if(o.trim().startsWith("{")){o=o.toObj()}else{o=o.toFunc()}}if(typeof o==="function"){o=o.apply()}}k.ajaxUrl({type:l.type||"GET",url:l.url,data:o||{},loadingmask:l.loadingmask,callback:function(r){if(n){n.apply(i,[p])}if(BJUI.ui.clientPaging&&p.data("bjui.clientPaging")){p.pagination("setPagingAndOrderby",p)}q.resizeBjuiRow(p)}})}else{if(l.image){m='<img src="'+decodeURIComponent(l.image)+'" style="max-width:100%;">'}else{if(l.html){m=l.html;if(typeof m==="string"&&g.isFunction(m.toFunc())){m=m.toFunc()}}else{if(l.target){m=g(l.target).html()||p.data("bjui.dialog.target");g(l.target).empty();p.data("bjui.dialog.target",m)}}}k.trigger(BJUI.eventType.beforeAjaxLoad).html(m).initui();if(n){n.apply(i,[p])}this.resizeBjuiRow(p)}},resizeContent:function(l){var k=l.find("> .dialogContent");k.css({height:(l.height()-l.find("> .dialogHeader").outerHeight())});g(window).trigger(BJUI.eventType.resizeGrid)},resizeBjuiRow:function(m){var l=m.width(),k=BJUI.formColWidth;m.find(".bjui-row").each(function(){var n=g(this);if((n.attr("class")).indexOf("col-")===-1){n.addClass("col-none")}n.filter(".col-4").toggleClass("col-3",(l<k.L&&l>k.M)).end().filter(".col-3, .col-4").toggleClass("col-2",(l<k.M&&l>k.S)).end().filter(".col-2, .col-3, .col-4").toggleClass("col-1",(l<k.S&&l>k.SS)).end().filter(".col-none, .col-1, .col-2, .col-3, .col-4").toggleClass("col-0",(l<k.SS))
})}};return j};b.prototype.open=function(){var o=this,q=o.options,k=g("body"),m=k.data("bjui.dialog"),l=m[q.id],i=l&&l.dialog;if(!(q.target||g(q.target).length)&&!(q.html||q.image)){if(!q.url&&q.href){q.url=q.href}if(!q.url){BJUI.debug("BJUI.Dialog: Error trying to open a dialog, url is undefined!");return}else{q.url=decodeURI(q.url).replacePlh();if(!q.url.isFinishedTm()){BJUI.alertmsg("error",(q.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.Dialog: The new dialog's url is incorrect, url: "+q.url);return}q.url=encodeURI(q.url)}}else{q.url=undefined}if(i){var n=i.data("options");this.switchDialog(i);if(i.is(":hidden")){i.show()}if(q.fresh||q.url!=n.url){o.reload(q)}}else{var j=BJUI.regional.dialog,p=FRAG.dialog.replace("#close#",j.close).replace("#maximize#",j.maximize).replace("#restore#",j.restore).replace("#minimize#",j.minimize).replace("#title#",j.title);i=g(p).data("options",g.extend({},q)).css("z-index",(++d)).hide().appendTo(k);i.find("> .dialogHeader > h1 > span.title").html(q.title);this.tools.init(i);if(q.maxable){i.find("a.maximize").show()}else{i.find("a.maximize").hide()}if(q.minable){i.find("a.minimize").show()}else{i.find("a.minimize").hide()}if(q.max){o.maxsize(i)}if(q.mask){this.addMask(i)}else{if(q.minable&&g.fn.taskbar){this.$element.taskbar({id:q.id,title:q.title})}}i.on("click",function(r){if(!g(r.target).data("bjui.dialog")){if(f&&f[0]!=i[0]){o.switchDialog(i)}}}).on("click",".btn-close",function(r){o.close(i);r.preventDefault()}).on("click",".dialogHeader > a",function(s){var r=g(this);if(r.hasClass("close")){o.close(i)}if(r.hasClass("minimize")){o.minimize(i)}if(r.hasClass("maximize")){o.switchDialog(i);o.maxsize(i)}if(r.hasClass("restore")){o.restore(i)}s.preventDefault();s.stopPropagation()}).on("dblclick",".dialogHeader > h1",function(r){if(q.maxable){if(i.find("> .dialogHeader > a.restore").is(":hidden")){i.find("a.maximize").trigger("click")}else{i.find("> .dialogHeader > a.restore").trigger("click")}}}).on("mousedown.bjui.dialog.drag",".dialogHeader > h1",function(r){o.switchDialog(i);if(!q.drawable||i.data("max")){return}i.data("bjui.dialog.task",true);setTimeout(g.proxy(function(){if(i.data("bjui.dialog.task")){o.drag(r,i)}},o),150);r.preventDefault()}).on("mouseup.bjui.dialog.drag",".dialogHeader > h1",function(r){i.data("bjui.dialog.task",false)}).on("mousedown.bjui.dialog.resize",'div[class^="resizable"]',function(s){if(!q.drawable||i.data("max")){return false}if(!q.resizable){return false}var r=g(this);o.switchDialog(i);o.resizeInit(s,g("#bjui-resizable"),i,r);r.show();s.preventDefault()}).on("mouseup.bjui.dialog.resize",'div[class^="resizable"]',function(r){r.preventDefault()});l.dialog=i;this.tools.reload(i,q)}g.CurrentDialog=f=i;m.current=q.id};b.prototype.addMask=function(i){var j=i.data("bjui.dialog.mask");i.wrap('<div style="z-index:'+d+'" class="bjui-dialog-wrap"></div>');i.find("> .dialogHeader > a.minimize").hide();if(!j||!j.length){j=g(FRAG.dialogMask);j.css("z-index",1).show().insertBefore(i);i.data("bjui.dialog.mask",j)}};b.prototype.refresh=function(n){if(n&&typeof n==="string"){var k=n.split(","),j=g("body").data("bjui.dialog");for(var l=0;l<k.length;l++){var m=j&&j[k[l].trim()]&&j[k[l].trim()].dialog;if(m){m.removeData("bjui.clientPaging");this.tools.reload(m)}}}else{if(f){f.removeData("bjui.clientPaging");this.tools.reload(f)}}};b.prototype.resize=function(j,i,p){var n=this,q,o,m=g(window).width(),k=g(window).height();if(!j){j=f}q=j.data("options");o=j.find("> .dialogContent");if(i!=q.width){if(i>m){i=m}if(q.max){j.animate({width:i,left:(m-i)/2},"normal")}else{j.width(i).css("left",(m-i)/2)}q.width=i}if(p!=q.height){var l=0;if(p<k){l=(k-p)/2-20}if(l<0){l=0}if(q.max){j.animate({height:p,top:l},"normal",function(){o.height(p-j.find("> .dialogHeader").outerHeight())})}else{j.height(p).css("top",l);o.height(p-j.find("> .dialogHeader").outerHeight())}q.height=p}};b.prototype.reload=function(k){var l=this,j=g.extend({},typeof k==="object"&&k),i=g("body").data("bjui.dialog"),m=(j.id&&i[j.id]&&i[j.id].dialog)||l.getCurrent();if(m&&m.length){var o=m.data("options");j=g.extend({},o,j);var n=function(){var r=m.find("> .dialogContent"),u=g(window).width(),s=g(window).height(),q=j.width,t=j.height;if(q!=o.width){if(q>u){q=u}if(j.max){m.animate({width:q,left:(u-q)/2},"normal")}else{m.width(q).css("left",(u-q)/2)}}if(t!=o.height){var p=0;if(t<s){p=(s-t)/2-20}if(p<0){p=0}if(j.max){m.animate({height:t,top:p},"normal",function(){r.height(t-m.find("> .dialogHeader").outerHeight())})}else{m.height(t).css("top",p);r.height(t-m.find("> .dialogHeader").outerHeight())}}if(j.maxable!=o.maxable){if(j.maxable){m.find("a.maximize").show()}else{m.find("a.maximize").hide()}}if(j.minable!=o.minable){if(j.minable){m.find("a.minimize").show()}else{m.find("a.minimize").hide()}}if(j.max!=o.max){if(j.max){setTimeout(l.maxsize(m),10)}}if(j.mask!=o.mask){if(j.mask){l.addMask(m);if(g.fn.taskbar){l.$element.taskbar("closeDialog",j.id)}}else{if(j.minable&&g.fn.taskbar){l.$element.taskbar({id:j.id,title:j.title})
}}}if(j.title!=o.title){m.find("> .dialogHeader > h1 > span.title").html(j.title);m.taskbar("changeTitle",j.id,j.title)}m.data("options",g.extend({},j));l.tools.reload(m,j)};if(j.reloadWarn){m.alertmsg("confirm",j.reloadWarn,{okCall:function(){n()}})}else{n()}}};b.prototype.reloadForm=function(k,n){var s=g.extend({},typeof n==="object"&&n),o=g("body").data("bjui.dialog"),j;if(s.id){if(o&&o[s.id]){j=o[s.id].dialog}}else{j=f}if(j){var p=j.data("options"),m={},i={},l=s.form;if(l&&l.length){s.type=s.type||l.attr("method")||"POST";s.url=s.url||l.attr("action");i=l.serializeJson();if(k){var r=BJUI.pageInfo;for(var q in r){m[r[q]]=i[r[q]]}}else{m=i}}s.data=g.extend({},s.data||{},m);this.tools.reload(j,s)}};b.prototype.getCurrent=function(){return f};b.prototype.switchDialog=function(m){var k=m.css("z-index");if(f&&f!=m){var l=f.css("z-index"),i=g("body").data("bjui.dialog"),j;if(f.data("options").mask){j=f.parent().css("z-index");if(Number(j)>Number(k)){return}}f.css("z-index",k);m.css("z-index",l);g.CurrentDialog=f=m;i.current=m.data("options").id;if(g.fn.taskbar){this.$element.taskbar("switchTask",i.current)}}m.addClass(h);g("body").find("> .bjui-dialog-container, > .bjui-dialog-wrap > .bjui-dialog-container").not(m).removeClass(h)};b.prototype.close=function(o){var k=g("body").data("bjui.dialog"),j=(typeof o==="string")?k[o].dialog:o;if(!j||!j.length){return}var l=this,r=j.data("bjui.dialog.mask"),s=j.data("options"),m=j.data("bjui.dialog.target"),n=s.beforeClose?s.beforeClose.toFunc():null,q=s.onClose?s.onClose.toFunc():null,i=true,p=function(){delete k[s.id];if(q){q.apply(l)}g.CurrentDialog=f=null;var u=g("body").find(".bjui-dialog-container"),t=null;if(u.length){t=l.$element.getMaxIndexObj(u)}else{d=b.ZINDEX}if(t&&t.is(":visible")){g.CurrentDialog=f=t;l.switchDialog(t)}};if(!j||!s){return}if(n){i=n.apply(l,[j])}if(!i){l.switchDialog(j);return}if(s.target&&m){g(s.target).html(m)}if(r&&r.length){r.remove();j.unwrap()}else{if(g.fn.taskbar){this.$element.taskbar("closeDialog",s.id)}}if(s.noanimate){j.trigger(BJUI.eventType.beforeCloseDialog).remove();p()}else{j.animate({top:-j.outerHeight(),opacity:0.1},"normal",function(){j.trigger(BJUI.eventType.beforeCloseDialog).remove();p()})}};b.prototype.closeCurrent=function(){this.close(f)};b.prototype.checkTimeout=function(){var j=f.find("> .dialogContent"),i=JSON.parse(j.html());if(i&&i[BJUI.keys.statusCode]==BJUI.statusCode.timeout){this.closeCurrent()}};b.prototype.maxsize=function(k){var i=g("#bjui-taskbar"),m=(i.is(":visible")?i.height():0)+1;k.data("original",{top:k.css("top"),left:k.css("left"),width:k.css("width"),height:k.css("height")}).data("max",true);k.find("> .dialogHeader > a.maximize").hide();k.find("> .dialogHeader > a.restore").show();var l=g(window).width()-1,j=g(window).height()-m;k.css({top:0,right:0,left:0,bottom:m,width:"100%",height:"auto"});this.tools.resizeContent(k);this.tools.resizeBjuiRow(k)};b.prototype.restore=function(l){var i=l.data("original"),j=i.width,k=i.height;l.css({top:i.top,right:"",bottom:"",left:i.left,width:j,height:k});this.tools.resizeContent(l);this.tools.resizeBjuiRow(l);l.find("> .dialogHeader > a.maximize").show();l.find("> .dialogHeader > a.restore").hide();l.data("max",false)};b.prototype.minimize=function(k){k.hide();if(g.fn.taskbar){this.$element.taskbar("minimize",k)}var j=g("body").find(".bjui-dialog-container:visible"),i=null;if(j.length){i=this.$element.getMaxIndexObj(j)}if(i){this.switchDialog(i)}};b.prototype.drag=function(k,j){var i=g("#bjui-dialogProxy");j.find("> .dialogContent").css("opacity",".3");j.basedrag({selector:"> .dialogHeader",stop:function(){j.css({left:j.css("left"),top:j.css("top")}).find("> .dialogContent").css("opacity",1)},event:k,nounbind:true})};b.prototype.resizeDialog=function(j,n,o){var k=parseInt(j.css("left"),10),m=parseInt(j.css("top"),10),i=parseInt(j.css("height"),10),l=parseInt(j.css("width"),10);if(m<0){m=0}n.css({top:m,left:k,width:l,height:i});if(o!="w"&&o!="e"){this.tools.resizeContent(n)}if(o!="n"&&o!="s"){this.tools.resizeBjuiRow(n);g(window).trigger(BJUI.eventType.resizeGrid)}};b.prototype.resizeInit=function(n,i,k,m){var j=this,l=m.attr("tar");g("body").css("cursor",l+"-resize");i.css({top:k.css("top"),left:k.css("left"),height:k.outerHeight(),width:k.css("width")}).show();if(!this.options.dragCurrent){this.options.dragCurrent={$resizable:i,$dialog:k,target:l,oleft:parseInt(i.css("left"),10)||0,owidth:parseInt(i.css("width"),10)||0,otop:parseInt(i.css("top"),10)||0,oheight:parseInt(i.css("height"),10)||0,ox:n.pageX||n.screenX,oy:n.pageY||n.clientY};g(document).on("mouseup.bjui.dialog.resize",g.proxy(j.resizeStop,j));g(document).on("mousemove.bjui.dialog.resize",g.proxy(j.resizeStart,j))}};b.prototype.resizeStart=function(p){var o=this.options.dragCurrent;if(!o){return}if(!p){var p=window.event}var j=(p.pageX||p.screenX)-o.ox,k=(p.pageY||p.clientY)-o.oy,n=o.$dialog.data("bjui.dialog.mask");if(!n||!n.length){if((p.pageY||p.clientY)<=0||(p.pageY||p.clientY)>=(g(window).height()-o.$dialog.find("> .dialogHeader").outerHeight())){return
}}var m=o.target,l=o.owidth,i=o.oheight;if(m!="n"&&m!="s"){l+=(m.indexOf("w")>=0)?-j:j}if(l>=this.options.minW){if(m.indexOf("w")>=0){o.$resizable.css("left",(o.oleft+j))}if(m!="n"&&m!="s"){o.$resizable.css("width",l)}}if(m!="w"&&m!="e"){i+=(m.indexOf("n")>=0)?-k:k}if(i>=this.options.minH){if(m.indexOf("n")>=0){o.$resizable.css("top",(o.otop+k))}if(m!="w"&&m!="e"){o.$resizable.css("height",i)}}};b.prototype.resizeStop=function(j){var i=this.options.dragCurrent;if(!i){return false}g(document).off("mouseup.bjui.dialog.resize").off("mousemove.bjui.dialog.resize");this.options.dragCurrent=null;this.resizeDialog(i.$resizable,i.$dialog,i.target);g("body").css("cursor","");i.$resizable.hide()};function e(l){var j=arguments,n=l,k="bjui.dialog",m=g("body"),i=m.data(k)||{};return this.each(function(){var q=g(this),o=g.extend({},b.DEFAULTS,typeof l==="object"&&l),r=o&&o.id,p;if(!r){if(i.current){r=i.current}else{r="dialog"}}else{if(!r.isNormalID()){BJUI.debug("BJUI.Dialog: ID ["+r+"] "+BJUI.regional.idChecked);return}}o.id=r;p=i&&i[r];if(!p){i[r]=(p=new b(o))}else{if(typeof l==="object"&&l){g.extend(p.options,l)}}m.data(k,i);if(typeof n==="string"&&g.isFunction(p[n])){[].shift.apply(j);if(!j){p[n]()}else{p[n].apply(p,j)}}else{p.open()}})}var a=g.fn.dialog;g.fn.dialog=e;g.fn.dialog.Constructor=b;g.fn.dialog.noConflict=function(){g.fn.dialog=a;return this};BJUI.dialog=function(){e.apply(g("body"),arguments)};g(document).on("click.bjui.dialog.data-api",'[data-toggle="dialog"]',function(m){var l=g(this),i=l.attr("href"),k=l.data(),j=k.options;if(j){if(typeof j==="string"){j=j.toObj()}if(typeof j==="object"){g.extend(k,j)}}if(!k.title){k.title=l.text()}if(i&&!k.url){k.url=i}e.call(l,k);m.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(e){var m;var l,i,d,a,h,k,j,f;e(function(){var n=function(){m=e("#bjui-resizable");l=e(FRAG.taskbar);i=l.find(".taskbarContent");d=i.find("> ul");a=l.find(".taskbarLeft");h=l.find(".taskbarRight");k="disabled";j="selected";f="taskbarMargin";e("body").append("<!-- dialog task bar -->").append(l);a.click(function(o){e(this).taskbar("scrollLeft")});h.click(function(o){e(this).taskbar("scrollRight")})};n()});var b=function(o,n){this.$element=e(o);this.$task=null;this.options=n;this.tools=this.TOOLS()};b.DEFAULTS={id:undefined,title:undefined};b.prototype.init=function(){var n=this;var p=d.find("#task-"+this.options.id);this.show();if(!p.length){var o='<li id="#taskid#"><div class="taskbutton"><span><i class="fa fa-th-large"></i></span> <span class="title">#title#</span></div><div class="close"><i class="fa fa-times-circle"></i></div></li>';p=e(o.replace("#taskid#","task-"+this.options.id).replace("#title#",this.options.title));p.appendTo(d)}else{p.find("> div > span.title").html(this.options.title)}this.contextmenu(p);this.switchTask(p);this.tools.scrollTask(p);p.click(function(s){if(e(s.target).closest("div").hasClass("close")||e(s.target).hasClass("close")){p.dialog("close",n.options.id)}else{var q=e("body").data("bjui.dialog"),r=q[n.options.id].dialog;if(p.hasClass("selected")){r.find(".dialogHeader a.minimize").trigger("click")}else{if(r.is(":hidden")){n.restoreDialog(r)}else{r.trigger("click");p.addClass(j)}}n.scrollCurrent(p)}return false})};b.prototype.TOOLS=function(){var n=this;var o={scrollCurrent:function(){var p=this.tasksW(this.getTasks());if(p>this.getTaskBarW()){var q=this;var s=d.find("> li:last-child");var r=this.getTaskBarW()-s.position().left-s.outerWidth(true);d.animate({left:r},200,function(){q.ctrlScrollBtn()})}else{this.ctrlScrollBtn()}},getTaskBarW:function(){return i.width()-(a.is(":hidden")?a.width()+2:0)-(h.is(":hidden")?h.width()+2:0)},scrollTask:function(r){var p=this;if(r.position().left+this.getLeft()+r.outerWidth()>this.getBarWidth()){var q=this.getTaskBarW()-r.position().left-r.outerWidth(true)-2;d.animate({left:q},200,function(){p.ctrlScrollBtn()})}else{if(r.position().left+this.getLeft()<0){var q=this.getLeft()-(r.position().left+this.getLeft());d.animate({left:q},200,function(){p.ctrlScrollBtn()})}}},ctrlScrollBtn:function(){var p=this.tasksW(this.getTasks());if(this.getTaskBarW()>p){i.removeClass(f);h.hide();a.hide();if(this.getTasks().eq(0).length){this.scrollTask(this.getTasks().eq(0))}}else{i.addClass(f);h.show().removeClass(k);a.show().removeClass(k);if(this.getLeft()>=0){a.addClass(k)}if(this.getLeft()<=this.getTaskBarW()-p){h.addClass(k)}}},getLeft:function(){return d.position().left},visibleStart:function(){var r=this.getLeft();var p=this.getTasks();for(var q=0;q<p.size();q++){if(p.eq(q).position().left+p.eq(q).outerWidth(true)+r>=0){return p.eq(q)}}return p.eq(0)},visibleEnd:function(){var r=this.getLeft();var p=this.getTasks();for(var q=0;q<p.size();q++){if(p.eq(q).position().left+p.eq(q).outerWidth(true)+r>this.getBarWidth()){return p.eq(q)}}return p.eq(p.size()-1)},getTasks:function(){return d.find("> li")
},tasksW:function(p){var q=0;p.each(function(){q+=e(this).outerWidth(true)});return q},getBarWidth:function(){return l.innerWidth()},getCurrent:function(){return d.find("li."+j)}};return o};b.prototype.contextmenu=function(o){var n=this;o.contextmenu({id:"dialogCM",bindings:{reload:function(p){p.dialog("refresh",n.options.id)},closeCurrent:function(q,p){var r=q.isTag("li")?q:n.tools.getCurrent();r.find(".close").trigger("click")},closeOther:function(q,p){var r=d.find("> li").not(q);r.each(function(s){e(this).find(".close").trigger("click")})},closeAll:function(q,p){var r=n.tools.getTasks();r.each(function(s){e(this).find(".close").trigger("click")})}},ctrSub:function(q,p){var r=p.find('[rel="closeCurrent"]');var s=p.find('[rel="closeOther"]');if(!n.tools.getCurrent().length){r.addClass(k);s.addClass(k)}else{if(n.tools.getTasks().size()==1){s.addClass(k)}}}})};b.prototype.closeDialog=function(n){var o=(typeof n==="string")?this.getTask(n):n;if(!o||!o.length){return}o.remove();if(!this.tools.getTasks().size()){this.hide()}this.tools.scrollCurrent();this.$element.removeData("bjui.taskbar")};b.prototype.minimize=function(o){var p=this,n=e("body").data("bjui.dialog"),q=(typeof o==="string")?n[o].dialog:o,r=this.getTask(q.data("options").id);m.css({top:q.css("top"),left:q.css("left"),height:q.css("height"),width:q.css("width")}).show().animate({top:e(window).height()-60,left:r.position().left,width:r.outerWidth(),height:r.outerHeight()},250,function(){e(this).hide();p.inactive(r)})};b.prototype.restoreDialog=function(n){var o=this.getTask(n.data("options").id);m.css({top:e(window).height()-60,left:o.position().left,height:o.outerHeight(),width:o.outerWidth()}).show().animate({top:n.css("top"),left:n.css("left"),width:n.css("width"),height:n.css("height")},250,function(){e(this).hide();n.show().trigger("click.bjui.taskbar.restore")});this.switchTask(o)};b.prototype.inactive=function(n){var o=(typeof n==="string")?this.getTask(n):n;o.removeClass(j)};b.prototype.scrollLeft=function(){var n=this.tools.visibleStart();this.tools.scrollTask(n)};b.prototype.scrollRight=function(){var n=this.tools.visibleEnd();this.tools.scrollTask(n)};b.prototype.scrollCurrent=function(n){this.tools.scrollTask(n)};b.prototype.switchTask=function(n){this.tools.getCurrent().removeClass(j);var o=(typeof n==="string")?this.getTask(n):n;o.addClass(j)};b.prototype.getTask=function(n){return d.find("#task-"+n)};b.prototype.changeTitle=function(p,o){var n=this.getTask(p);if(n&&o){n.find(".title").html(o)}};b.prototype.show=function(){if(l.is(":hidden")){l.show().animate({bottom:0},500)}};b.prototype.hide=function(){if(l.is(":visible")){l.animate({bottom:-50},500,function(){l.hide()})}};function g(o){var n=arguments;var p=o;return this.each(function(){var s=e(this);var q=e.extend({},b.DEFAULTS,s.data(),typeof o==="object"&&o);var r=s.data("bjui.taskbar");if(!r){s.data("bjui.taskbar",(r=new b(this,q)))}else{if(r.options.id!=q.id){s.data("bjui.taskbar",(r=new b(this,q)))}}if(typeof p==="string"&&e.isFunction(r[p])){[].shift.apply(n);if(!n){r[p]()}else{r[p].apply(r,n)}}else{r.init()}})}var c=e.fn.taskbar;e.fn.taskbar=g;e.fn.taskbar.Constructor=b;e.fn.taskbar.noConflict=function(){e.fn.taskbar=c;return this}}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(e){var d;var b=function(g,f){var h=this;this.$element=e(g);this.options=f;this.tools=this.TOOLS()};b.DEFAULTS={okalert:true,reload:true,loadingmask:true,gridrefreshflag:true};b.NAVTAB="navtab";b.prototype.TOOLS=function(){var f=this;var g={getTarget:function(){if(f.$element.closest(".navtab-panel").length){return b.NAVTAB}else{return"dialog"}}};return g};b.prototype.ajaxdone=function(f){if(f[BJUI.keys.statusCode]==BJUI.statusCode.error){if(f[BJUI.keys.message]){BJUI.alertmsg("error",f[BJUI.keys.message])}}else{if(f[BJUI.keys.statusCode]==BJUI.statusCode.timeout){BJUI.alertmsg("info",(f[BJUI.keys.message]||BJUI.regional.sessiontimeout));BJUI.loadLogin()}else{if(f[BJUI.keys.message]){BJUI.alertmsg("correct",f[BJUI.keys.message])}}}};b.prototype.ajaxerror=function(l,f,i){var k=l.responseText,h=this,g=h.$element.data("bjui.ajax.options")||h.options,j=g.failCallback;if(typeof k==="string"&&k.startsWith("{")){this.ajaxdone(k.toObj())}else{BJUI.alertmsg("error","<div>Http status: "+l.status+" "+l.statusText+"</div>"+"<div>ajaxOptions: "+f+" </div>"+"<div>thrownError: "+i+" </div>"+"<div>"+k+"</div>")}if(j){if(typeof j==="string"){j=j.toFunc()}if(typeof j==="function"){j.apply(h,[k,g])}else{BJUI.debug("The callback function 'failCallback' is incorrect: "+j)}}};b.prototype.ajaxcallback=function(q){var j=this,r=j.options,k=r.okCallback,m=r.errCallback,f=r.okAfterCallback,l=[],n=[],p=[],o=[];var h=function(){if(typeof k==="string"){k=k.toFunc()}if(typeof k==="function"){k.apply(j,[q,r])}else{BJUI.debug("The callback function 'okCallback' is incorrect: "+k)
}},g=function(){if(typeof f==="string"){f=f.toFunc()}if(typeof f==="function"){f.apply(j,[q,r])}else{BJUI.debug("The callback function 'okAfterCallback' is incorrect: "+f)}},i=function(){if(typeof m==="string"){m=m.toFunc()}if(typeof m==="function"){m.apply(j,[q,r])}else{BJUI.debug("The callback function 'errCallback' is incorrect: "+m)}};if(typeof q==="string"){q=q.toObj()}if(r.okalert){j.ajaxdone(q)}if(!q[BJUI.keys.statusCode]){if(k){h();return}}if(q[BJUI.keys.statusCode]==BJUI.statusCode.ok){if(k){h();return}if(q.tabid){e.merge(l,q.tabid.split(","))}if(r.tabid){e.merge(l,r.tabid.split(","))}if(q.dialogid){e.merge(n,q.dialogid.split(","))}if(r.dialogid){e.merge(n,r.dialogid.split(","))}if(q.divid){e.merge(p,q.divid.split(","))}if(r.divid){e.merge(p,r.divid.split(","))}if(q.datagrid){e.merge(o,q.datagrid.split(","))}if(r.datagrid){e.merge(o,r.datagrid.split(","))}if(l.length){e.unique(l);setTimeout(function(){BJUI.navtab("reloadFlag",l.join(","))},100)}if(n.length){e.unique(n);setTimeout(function(){BJUI.dialog("refresh",n.join(","))},100)}if(p.length){e.unique(p);setTimeout(function(){j.refreshdiv(p.join(","))},100)}if(o.length){setTimeout(function(){e.each(o,function(s,t){e("#"+t.trim()).datagrid("refresh",r.gridrefreshflag)})},100)}if(j.$target==e.CurrentNavtab){j.navtabcallback(q)}else{if(j.$target==e.CurrentDialog){j.dialogcallback(q)}else{j.divcallback(q)}}if(f){g()}}else{if(m){i()}}};b.prototype.divcallback=function(j,g,i){var k=this,i=k.options,h=j.forward||i.forward||null,l=j.forwardConfirm||i.forwardConfirm||null;if(i.reload&&!h){k.refreshlayout()}if(i.reloadNavtab){setTimeout(function(){BJUI.navtab("refresh")},100)}if(h){var f=function(){e.extend(i,{url:h});k.refreshlayout()};if(l){BJUI.alertmsg("confirm",l,{okCall:function(){f()}})}else{f()}}};b.prototype.navtabcallback=function(i){var j=this,h=j.options,k=i.closeCurrent||h.closeCurrent||false,g=i.forward||h.forward||null,l=i.forwardConfirm||h.forwardConfirm||null;if(k&&!g){BJUI.navtab("closeCurrentTab")}else{if(h.reload&&!g){setTimeout(function(){BJUI.navtab("refresh")},100)}}if(g){var f=function(){BJUI.navtab("reload",{url:g})};if(l){BJUI.alertmsg("confirm",l,{okCall:function(){f()},cancelCall:function(){if(k){BJUI.navtab("closeCurrentTab")}}})}else{f()}}};b.prototype.dialogcallback=function(i){var j=this,h=j.options,k=i.closeCurrent||h.closeCurrent||false,g=i.forward||h.forward||null,l=i.forwardConfirm||h.forwardConfirm||null;if(k&&!g){BJUI.dialog("closeCurrent")}else{if(h.reload&&!g){setTimeout(function(){BJUI.dialog("refresh")},100)}}if(h.reloadNavtab){setTimeout(function(){BJUI.navtab("refresh")},100)}if(g){var f=function(){BJUI.dialog("reload",{url:g})};if(l){BJUI.alertmsg("confirm",i.forwardConfirm,{okCall:function(){f()},cancelCall:function(){if(k){BJUI.dialog("closeCurrent")}}})}else{f()}}};b.prototype.doajax=function(i){var j=this,g,h=j.$element;if(!i){i={}}if(!i.loadingmask){i.loadingmask=false}i=e.extend({},b.DEFAULTS,typeof i==="object"&&i);j.options=i;if(i.target){if(i.target instanceof jQuery){g=i.target}else{g=e(i.target)}}else{if(h[0]!==e("body")[0]){g=h.closest(".bjui-layout")}}if(!g||!g.length){g=e.CurrentDialog||e.CurrentNavtab}j.$target=g;if(!i.url){BJUI.debug("BJUI.ajax: 'doajax' method: the url is undefined!");return}else{i.url=decodeURI(i.url).replacePlh(g);if(!i.url.isFinishedTm()){BJUI.alertmsg("error",(i.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.ajax: 'doajax' method: The url is incorrect: "+i.url);return}i.url=encodeURI(i.url)}var k=i.callback&&i.callback.toFunc();var f=function(){if(!i.callback){i.callback=e.proxy(function(l){j.ajaxcallback(l)},j)}g.data("bjui.ajax.options",i).doAjax(i)};if(i.confirmMsg){BJUI.alertmsg("confirm",i.confirmMsg,{okCall:function(){f()}})}else{f()}};b.prototype._ajaxform=function(r,q){var j=this,f=null,i=q.beforeSubmit,o=q.callback,g=false,k;if(r.data("holdSubmit")){return}if(i){if(typeof i==="string"){i=i.toFunc()}if(typeof i==="function"){if(!i.apply(j,[r])){return}}else{BJUI.debug("BJUI.ajax: 'ajaxform' options 'beforeSubmit': Not a function!");return}}var l=r.find('input[data-toggle="webuploader"]'),p,n=false;if(l.length&&WebUploader){l.each(function(t,x){var v=e(this).data("webuploader"),u=e(this).data("webuploader.wrap").find(".filelist > li"),w=u.length,s=w-u.filter(".uploaded").length;if(s&&v){if(s!==v.getStats().successNum){v.upload();v.on("uploadFinished",function(){r.submit()});n=true;return false}}if(v&&v.options.required){if(!w){p=v.options.requiredMsg||"请上传图片！";return false}}})}if(p){BJUI.alertmsg("info",p);return}if(n){BJUI.alertmsg("info","表单将在图片上传完成后自动提交！");return}k=r.attr("enctype");if(!q.target){q.target=r.closest(".bjui-layout")}if(q.target){f=q.target;if(!(f instanceof jQuery)){f=e(f)}}if(!f||!f.length){f=e.CurrentDialog||e.CurrentNavtab}j.$target=f;q.url=q.url||r.attr("action");if(BJUI.isIE(8)&&!q.type){if(!r[0].getAttributeNode("method").specified){q.type="POST"}}q.type=q.type||r.attr("method")||"POST";e.extend(j.options,q);if(o){o=o.toFunc()}var m=function(t,u,s){o?o.apply(j,[t,r]):e.proxy(j.ajaxcallback(t),j)
};var h=function(){var s={loadingmask:j.options.loadingmask,type:j.options.type,url:j.options.url,callback:m};if(k&&k=="multipart/form-data"){if(window.FormData){e.extend(s,{data:new FormData(r[0]),contentType:false,processData:false})}else{e.extend(s,{data:r.serializeArray(),files:r.find(":file"),iframe:true,processData:false})}}else{e.extend(s,{data:r.serializeArray()})}if(j.options.ajaxTimeout){s.ajaxTimeout=j.options.ajaxTimeout}r.doAjax(s)};if(j.options.confirmMsg){BJUI.alertmsg("confirm",j.options.confirmMsg,{okCall:h})}else{h()}};b.prototype.ajaxform=function(i){var j=this,h=e.extend({},typeof i==="object"&&i),f=j.$element,g=null,k={validClass:"ok",msgClass:"n-bottom",theme:"red_bottom_effect_grid"};if(f[0]===e("body")[0]){g=h.form;if(!(g instanceof jQuery)){g=e(h.form)}}else{g=f}if(!g||!g.length||!(g.isTag("form"))){BJUI.debug("BJUI.ajax: 'ajaxform' method: Not set the form!");return}if(typeof h.validate==="undefined"){h.validate=true}if(e.fn.validator&&h.validate){if(!g.data("validator")){g.validator(k)}g.on("valid.form",function(l){j._ajaxform(g,h)}).on("invalid.form",function(m,l,n){if(h.alertmsg){BJUI.alertmsg("error",BJUI.regional.validatemsg.replaceMsg(n.length))}});g.trigger("validate")}else{j._ajaxform(g,h)}};b.prototype._ajaxsearch=function(o,n){var k=this,f=null,j=n.beforeSubmit,m=n.callback,g=false,l;if(o.data("holdSubmit")){return}if(j){if(typeof j==="string"){j=j.toFunc()}if(typeof j==="function"){if(!j.apply(k,[o])){return}}else{BJUI.debug("BJUI.ajax: 'ajaxform' options 'beforeSubmit': Not a function!");return}}if(o.data("bjui.paging")){if(!n.data){n.data={}}e.extend(n.data,o.data("bjui.paging"))}if(n.searchDatagrid){var i=n.searchDatagrid;if(!(i instanceof jQuery)){i=e(i)}if(!i||!i.length||!i.data("bjui.datagrid")){BJUI.debug("BJUI.ajax: 'ajaxsearch' method: The options 'searchDatagrid' is not incorrect!");return}o.data("holdSubmit",true);i.datagrid("filter",o.serializeJson());i.on("afterLoad.bjui.datagrid",function(){o.data("holdSubmit",false)});return}if(!n.target){n.target=o.closest(".bjui-layout")}if(n.target){f=n.target;if(!(f instanceof jQuery)){f=e(f)}}if(!f||!f.length){f=e.CurrentDialog||e.CurrentNavtab}k.$target=f;n.url=n.url||o.attr("action");if(BJUI.isIE(8)&&!n.type){if(!o[0].getAttributeNode("method").specified){n.type="POST"}}n.type=n.type||o.attr("method")||"POST";if(!n.url){BJUI.debug("BJUI.ajax: 'ajaxsearch' method: The form's action or url is undefined!");return}else{n.url=decodeURI(n.url).replacePlh(o.closest(".unitBox"));if(!n.url.isFinishedTm()){BJUI.alertmsg("error",(n.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.ajax: 'ajaxsearch' method: The form's action or url is incorrect: "+n.url);return}n.url=encodeURI(n.url)}e.extend(k.options,n);if(f.hasClass("bjui-layout")){var h=e.extend(o.serializeJson(),n.data);k.reloadlayout({target:f[0],type:k.options.type,url:k.options.url,data:h,loadingmask:k.options.loadingmask})}else{n.form=o;if(f[0]===(e.CurrentNavtab)[0]){BJUI.navtab("reloadForm",k.options.clearQuery,n)}else{BJUI.dialog("reloadForm",k.options.clearQuery,n)}}};b.prototype.ajaxsearch=function(i){var j=this,h=e.extend({},typeof i==="object"&&i),f=j.$element,g=null,k={validClass:"ok",msgClass:"n-bottom",theme:"red_bottom_effect_grid"};if(f[0]===e("body")[0]){g=h.form;if(!(g instanceof jQuery)){g=e(h.form)}}else{g=f}if(!g||!g.length||!(g.isTag("form"))){BJUI.debug("BJUI.ajax: 'ajaxsearch' method: Not set the form!");return}if(typeof h.validate==="undefined"){h.validate=true}if(e.fn.validator&&h.validate){if(!g.data("validator")){g.validator(k)}g.on("valid.form",function(l){j._ajaxsearch(g,h)}).on("invalid.form",function(m,l,n){if(h.alertmsg){BJUI.alertmsg("error",BJUI.regional.validatemsg.replaceMsg(n.length))}});g.trigger("validate")}else{j._ajaxsearch(g,h)}};b.prototype.doload=function(h){var i=this,f=null,g=i.options;e.extend(g,typeof h==="object"&&h);if(g.target){f=g.target;if(!(f instanceof jQuery)){f=e(f)}}if(!f||!f.length){BJUI.debug("BJUI.ajax: 'doload' method: Not set loaded container, like [data-target].");return}if(!g.url){BJUI.debug("BJUI.ajax: 'doload' method: The url is undefined!");return}else{g.url=decodeURI(g.url).replacePlh();if(!g.url.isFinishedTm()){BJUI.alertmsg("error",(g.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.ajax: 'doload' method: The url is incorrect: "+g.url);return}g.url=encodeURI(g.url)}f.removeData("bjui.clientPaging").data("options",g);i.reloadlayout(g)};b.prototype.refreshlayout=function(h){var g=this,f;if(h){f=h;if(!(f instanceof jQuery)){f=e(f)}}else{f=g.$target}if(!f||!f.length){if(d){clearInterval(d)}BJUI.debug("BJUI.ajax: 'refreshlayout' method: No argument, can not refresh DIV.(parameters:[selector/jQuery object/element])");return}if(f&&f.length){if(!f.data("options")){BJUI.debug("BJUI.ajax: 'refreshlayout' method: The target(DIV) is not a reload layout!");return}f.removeData("bjui.clientPaging");g.reloadlayout(f.data("options"))}};b.prototype.reloadlayout=function(i){var f=null,g=e.extend({},typeof i==="object"&&i),h=g&&g.autorefresh&&(isNaN(String(g.autorefresh))?15:g.autorefresh);
    if(g.target){f=g.target;if(!(f instanceof jQuery)){f=e(f)}}if(!f||!f.length){if(d){clearInterval(d)}BJUI.debug("BJUI.ajax: 'refreshlayout' method: Not set loaded container, like [data-target].");return}else{if(!f.data("options")){BJUI.debug("BJUI.ajax: 'refreshlayout' method: This target(DIV) is not initialized!");return}g=e.extend({},f.data("options"),g)}f.addClass("bjui-layout").data("options",g).ajaxUrl({type:g.type,url:g.url,data:g.data,loadingmask:g.loadingmask,callback:function(j){if(BJUI.ui.clientPaging&&f.data("bjui.clientPaging")){f.pagination("setPagingAndOrderby",f)}if(g.callback){g.callback.apply(this,[f,j])}if(d){clearInterval(d)}if(h){d=setInterval(function(){f.bjuiajax("refreshlayout",f)},h*1000)}if(!f.height()){f.css("position","static")}}})};b.prototype.refreshdiv=function(h){if(h&&typeof h==="string"){var f=h.split(",");for(var g=0;g<f.length;g++){this.refreshlayout("#"+f[g])}}};b.prototype.ajaxdownload=function(i){var j=this,g,h=e.extend({},{loadingmask:false},typeof i==="object"&&i);e.extend(j.options,h);if(h.target){g=h.target;if(!(g instanceof jQuery)){g=e(g)}}if(!g||!g.length){g=e.CurrentDialog||e.CurrentNavtab}j.$target=g;if(!h.url){BJUI.debug("BJUI.ajax: 'ajaxdownload' method: The url is undefined!");return}else{h.url=decodeURI(h.url).replacePlh(g);if(!h.url.isFinishedTm()){BJUI.alertmsg("error",(h.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.ajax: 'ajaxdownload' method: The url is incorrect: "+h.url);return}}var f=function(){var k={};k.failCallback=function(l,m){if(l.trim().startsWith("{")){l=l.toObj()}j.ajaxdone(l);g.trigger("bjui.ajaxError")};k.prepareCallback=function(l){if(h.loadingmask){g.trigger("bjui.ajaxStart")}};k.successCallback=function(l){g.trigger("bjui.ajaxStop")};if(h.type&&!h.httpMethod){h.httpMethod=h.type}e.extend(k,h);if(!k.data){k.data={}}if(typeof k.data.ajaxrequest==="undefined"){k.data.ajaxrequest=true}e.fileDownload(h.url,k)};if(h.confirmMsg){BJUI.alertmsg("confirm",h.confirmMsg,{okCall:function(){f()}})}else{f()}};function c(g){var f=arguments,j=g,i="bjui.ajax",h=e("body");return this.each(function(){var n=e(this),k=e.extend({},b.DEFAULTS,typeof g==="object"&&g),m=n.data(i),l;if(!m){m=new b(this,k)}else{if(this===h[0]){m=new b(this,k)}else{e.extend(m.options,typeof g==="object"&&g)}}n.data(i,m);if(typeof j==="string"){l=m[j.toLowerCase()];if(e.isFunction(l)){[].shift.apply(f);if(!f){l()}else{l.apply(m,f)}}}})}var a=e.fn.bjuiajax;e.fn.bjuiajax=c;e.fn.bjuiajax.Constructor=b;e.fn.bjuiajax.noConflict=function(){e.fn.bjuiajax=a;return this};BJUI.ajax=function(){c.apply(e("body"),arguments)};e(document).on(BJUI.eventType.initUI,function(f){if(e.fn.validator){e(f.target).find('form[data-toggle="ajaxform"], form[data-toggle="ajaxsearch"]').each(function(){var i=e(this),h=i.data(),g=h.options,j={validClass:"ok",msgClass:"n-bottom",theme:"red_bottom_effect_grid"};if(g){if(typeof g==="string"){g=g.toObj()}if(typeof g==="object"){delete h.options;e.extend(h,g)}}if(typeof h.validate==="undefined"){h.validate=true}if(!h.validate){j.ignore="*"}i.validator(j).on("valid.form",function(k){BJUI.ajax("_"+h.toggle,i,h)}).on("invalid.form",function(l,k,m){if(h.alertmsg){BJUI.alertmsg("error",BJUI.regional.validatemsg.replaceMsg(m.length))}})})}});e(document).on("submit.bjui.bjuiajax.data-api",'form[data-toggle="ajaxform"], form[data-toggle="ajaxsearch"]',function(i){if(!e.fn.validator){var h=e(this),g=h.data(),f=g.options;if(f){if(typeof f==="string"){f=f.toObj()}if(typeof f==="object"){delete g.options;e.extend(g,f)}}c.call(h,"_"+g.toggle,h,g);i.preventDefault()}});e(document).on("click.bjui.bjuiajax.data-api",'[data-toggle="ajaxload"]',function(i){var h=e(this),g=h.data(),f=g.options;if(f){if(typeof f==="string"){f=f.toObj()}if(typeof f==="object"){delete g.options;e.extend(g,f)}}if(!g.url){g.url=h.attr("href")}c.call(h,"doload",g);i.preventDefault()});e(document).on(BJUI.eventType.initUI,function(f){e(f.target).find('[data-toggle="autoajaxload"]').each(function(){var g=e(this),i=$this.data(),h=i.options;if(h){if(typeof h==="string"){h=h.toObj()}if(typeof h==="object"){delete i.options;e.extend(i,h)}}i.target=this;c.call(g,"doload",i)})});e(document).on("click.bjui.bjuiajax.data-api",'[data-toggle="refreshlayout"]',function(h){var g=e(this),f=g.data("target");c.call(g,"refreshlayout",f);h.preventDefault()});e(document).on("click.bjui.bjuiajax.data-api",'[data-toggle="reloadlayout"]',function(h){var g=e(this),f=g.data();c.call(g,"reloadlayout",f);h.preventDefault()});e(document).on("click.bjui.bjuiajax.data-api",'[data-toggle="doajax"]',function(i){var h=e(this),g=h.data(),f=g.options;if(f){if(typeof f==="string"){f=f.toObj()}if(typeof f==="object"){delete g.options;e.extend(g,f)}}if(!g.url){g.url=h.attr("href")}c.call(h,"doajax",g);i.preventDefault()});e(document).on("click.bjui.bjuiajax.data-api",'[data-toggle="ajaxdownload"]',function(i){var h=e(this),g=h.data(),f=g.options;if(f){if(typeof f==="string"){f=f.toObj()}if(typeof f==="object"){delete g.options;e.extend(g,f)}}if(!g.url){g.url=h.attr("href")
}c.call(h,"ajaxdownload",g);i.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(d){var e,b,g;d(function(){var h=function(){e=d(FRAG.alertBoxFrag).hide().html("");b=d(FRAG.alertBackground).hide().html("");d("body").append("<!-- alert msg box -->").append(e).append("<!-- alert msg box mask bg -->").append(b)};h()});var f=function(h){this.options=h;this.tools=this.TOOLS();this.clearTime=null};f.DEFAULTS={displayPosition:"topcenter",displayMode:"slide",autoClose:null,alertTimeout:3000,mask:null,promptRequired:"required",types:{error:"error",info:"info",warn:"warn",correct:"correct",confirm:"confirm",prompt:"prompt"},fas:{error:"fa-times-circle",info:"fa-info-circle",warn:"fa-exclamation-circle",correct:"fa-check-circle",confirm:"fa-question-circle",prompt:"fa-paper-plane-o"}};f.prototype.TOOLS=function(){var h=this;var i={getTitle:function(j){return h.options.title||BJUI.regional.alertmsg.title[j]},keydownOk:function(j){if(j.which==BJUI.keyCode.ENTER){j.data.target.trigger("click");return false}return true},keydownEsc:function(j){if(j.which==BJUI.keyCode.ESC){j.data.target.trigger("click")}},openPosition:function(){var k=BJUI.alertMsg.displayPosition,o=BJUI.alertMsg.displayMode,l=460,j=e.outerHeight(),n={},m={};if(k){if(h.options.displayPosition&&h.options.displayPosition!="topcenter"){k=h.options.displayPosition}}else{k=h.options.displayPosition}if(o){if(h.options.displayMode&&h.options.displayMode!="slide"){o=h.options.displayMode}}else{o=h.options.displayMode}switch(k){case"topleft":n={top:0-j,left:0,"margin-left":0};m={top:0};break;case"topcenter":n={top:0-j};m={top:0};break;case"topright":n={top:0-j,left:"auto",right:0,"margin-left":0};m={top:0};break;case"middleleft":n={top:"50%",left:0-l,"margin-left":0,"margin-top":0-j/2};m={left:0};break;case"middlecenter":n={top:"0","margin-top":0-j/2};m={top:"50%"};break;case"middleright":n={top:"50%",left:"auto",right:0-l,"margin-top":0-j/2};m={right:0};break;case"bottomleft":n={top:"auto",left:0,bottom:0-j,"margin-left":0};m={bottom:0};break;case"bottomcenter":n={top:"auto",bottom:0-j};m={bottom:0};break;case"bottomright":n={top:"auto",left:"auto",right:0,bottom:0-j,"margin-left":0};m={bottom:0};break}if(o=="slide"){e.css(n).show().animate(m,500)}else{if(o=="fade"){n.opacity=0.1;e.css(n).css(m).show().animate({opacity:1},500)}else{e.css(n).css(m).show()}}},closePosition:function(){var k=BJUI.alertMsg.displayPosition,n=BJUI.alertMsg.displayMode,l=460,j=e.outerHeight(),m={};if(k){if(h.options.displayPosition&&h.options.displayPosition!="topcenter"){k=h.options.displayPosition}}else{k=h.options.displayPosition}if(n){if(h.options.displayMode&&h.options.displayMode!="slide"){n=h.options.displayMode}}else{n=h.options.displayMode}switch(k){case"topleft":m={top:0-j};break;case"topcenter":m={top:0-j};break;case"topright":m={top:0-j};break;case"middleleft":m={left:0-l};break;case"middlecenter":m={top:0-j};break;case"middleright":m={right:0-l};break;case"bottomleft":m={bottom:0-j};break;case"bottomcenter":m={bottom:0-j};break;case"bottomright":m={bottom:0-j};break}if(n=="slide"){e.animate(m,500,function(){b.hide();d(this).hide().empty()})}else{if(n=="fade"){e.animate({opacity:0},500,function(){b.hide();d(this).hide().empty()})}else{e.hide().remove();b.hide()}}},open:function(p,j,o){var m=this,r="",t,k,s=BJUI.alertMsg.alertTimeout,q="";if(o){for(var l=0;l<o.length;l++){var v=o[l].call?"callback":"",u=o[l].cls?o[l].cls:"default",n=(o[l].cls&&o[l].cls=="green")?"check":"close";r+=FRAG.alertBtnFrag.replace("#btnMsg#",'<i class="fa fa-'+n+'"></i> '+o[l].name).replace("#callback#",v).replace("#class#",u)}}if(p==h.options.types.prompt){q='<p style="padding-top:5px;"><input type="text" class="form-control" name="'+(h.options.promptname||"prompt")+'" value=""></p>'}t=d(FRAG.alertBoxFrag.replace("#type#",p).replace("#fa#",h.options.fas[p]).replace("#title#",this.getTitle(p)).replace("#message#",j).replace("#prompt#",q).replace("#btnFragment#",r)).hide().appendTo("body");if(e&&e.length){e.remove()}e=t;m.openPosition();if(g){clearTimeout(g);g=null}if(h.options.mask==null){if(!(h.options.types.info==p||h.options.types.correct==p)){b.show()}}if(h.options.autoClose==null){if(h.options.types.info==p||h.options.types.correct==p){if(s){if(h.options.alertTimeout&&h.options.alertTimeout!=3000){s=h.options.alertTimeout}}else{s=h.options.alertTimeout}g=setTimeout(function(){m.close()},s)}}if(p==h.options.types.prompt){e.find(":text").focus().val(h.options.promptval)}k=e.find(".btn");k.each(function(w){d(this).on("click",d.proxy(function(){if(p!==h.options.types.prompt||k.eq(w).hasClass("btn-red")){h.tools.close()}var x=o[w].call;if(typeof x==="string"){x=x.toFunc()}if(typeof x==="function"){if(p==h.options.types.prompt){var z=e.find("input"),y=z.val();z.focus(function(){e.removeClass("has-error")});if(h.options.promptRequired==="required"&&!y){e.addClass("has-error")
}else{h.tools.close();x.call(h,y)}}else{x.call()}}},h));if(o[w].keyCode===BJUI.keyCode.ENTER){d(document).on("keydown.bjui.alertmsg.ok",{target:k.eq(w)},m.keydownOk)}if(o[w].keyCode===BJUI.keyCode.ESC){d(document).on("keydown.bjui.alertmsg.esc",{target:k.eq(w)},m.keydownEsc)}})},alert:function(j,m,l){d.extend(h.options,typeof l==="object"&&l);var n=d.extend({},{okName:BJUI.regional.alertmsg.btnMsg.ok,okCall:null},h.options);var k=[{name:n.okName,call:n.okCall,cls:"default",keyCode:BJUI.keyCode.ENTER}];this.open(j,m,k)},close:function(){d(document).off("keydown.bjui.alertmsg.ok").off("keydown.bjui.alertmsg.esc");this.closePosition()}};return i};f.prototype.error=function(i,h){this.tools.alert(this.options.types.error,i,h)};f.prototype.info=function(i,h){this.tools.alert(this.options.types.info,i,h)};f.prototype.warn=function(i,h){this.tools.alert(this.options.types.warn,i,h)};f.prototype.ok=function(i,h){this.tools.alert(this.options.types.correct,i,h)};f.prototype.correct=function(i,h){this.tools.alert(this.options.types.correct,i,h)};f.prototype.confirm=function(j,i){d.extend(this.options,typeof i==="object"&&i);var k=d.extend({},{okName:BJUI.regional.alertmsg.btnMsg.ok,okCall:null,cancelName:BJUI.regional.alertmsg.btnMsg.cancel,cancelCall:null},this.options);var h=[{name:k.okName,call:k.okCall,cls:"green",keyCode:BJUI.keyCode.ENTER},{name:k.cancelName,call:k.cancelCall,cls:"red",keyCode:BJUI.keyCode.ESC}];this.tools.open(this.options.types.confirm,j,h)};f.prototype.prompt=function(k,j){d.extend(this.options,typeof j==="object"&&j);var i=this,l=d.extend({},{okName:BJUI.regional.alertmsg.btnMsg.ok,okCall:null,cancelName:BJUI.regional.alertmsg.btnMsg.cancel,cancelCall:null},this.options);if(l.okCall==null&&(typeof i.options.prompt==="object"&&i.options.prompt)){l.okCall=function(n){var m={};m[(i.options.promptname||"prompt")]=n;if(!i.options.prompt.data){i.options.prompt.data=m}else{d.extend(i.options.prompt.data,m)}BJUI.ajax("doajax",i.options.prompt)}}var h=[{name:l.okName,call:l.okCall,cls:"green",keyCode:BJUI.keyCode.ENTER},{name:l.cancelName,call:l.cancelCall,cls:"red",keyCode:BJUI.keyCode.ESC}];this.tools.open(this.options.types.prompt,k,h)};function c(i){var h=arguments,l=i,m="bjui.alertmsg",k=d("body"),j=k.data(m);return this.each(function(){var o=d(this),n=d.extend({},f.DEFAULTS,typeof i==="object"&&i);if(!j){j=new f(n)}else{j.options=n}k.data(m,j);if(typeof l==="string"&&d.isFunction(j[l])){[].shift.apply(h);if(!h){j[l]()}else{j[l].apply(j,h)}}})}var a=d.fn.alertmsg;d.fn.alertmsg=c;d.fn.alertmsg.Constructor=f;d.fn.alertmsg.noConflict=function(){d.fn.alertmsg=a;return this};BJUI.alertmsg=function(){c.apply(d("body"),arguments)};d(document).on("click.bjui.alertmsg.data-api",'[data-toggle="alertmsg"]',function(l){var k=d(this),j=k.data(),h=j.options,i;if(h){if(typeof h==="string"){h=h.toObj()}if(typeof h==="object"){d.extend(j,h)}}i=j.type;if(!i){return false}if(!j.msg){if(h.msg){j.msg=h.msg}}c.call(k,i,j.msg||i,j);l.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(c){var d=function(f,e){this.$element=c(f);this.options=e;this.tools=this.TOOLS()};d.DEFAULTS={width:"100%",pageSize:30,selectPageSize:"30,60,90",pageCurrent:1,total:0,showPagenum:5,form:null,callback:null};d.prototype.TOOLS=function(){var e=this;var f={getPageCount:function(g,h){return Math.ceil(h/g)},getPageInterval:function(i,k,m){var j=Math.ceil(m/2),h=i-m,l=k>j?Math.max(Math.min(k-j,h),0):0,g=k>j?Math.min((k+j),i):Math.min(m,i);if(g-l==m){g=g+1}if(g<m){g=g+1}if(l+1==g){g=g+1}return{start:l+1,end:g}},jumpPage:function(h,g){var i=e.options.callback;if(typeof i==="string"){i=i.toFunc()}if(h){e.options.pageCurrent=h}if(g){e.options.pageSize=g;e.pageCount=this.getPageCount(g,e.options.total);if(e.options.pageCurrent>e.pageCount){e.options.pageCurrent=e.pageCount}}if(i&&typeof i==="function"){i.call(e,e.options.pageCurrent,g)}else{this.setPaging(e.options.pageCurrent,g,true)}e.$element.trigger("bjui.pagination.jump")},setPaging:function(k,g,j){var i=e.options.form,h={};if(i){if(!(i instanceof jQuery)){i=c(i)}if(!i||!i.length){BJUI.debug("BJUI.Pagination: The options 'form' is not incorrect!");return}h[BJUI.pageInfo.pageCurrent]=k;h[BJUI.pageInfo.pageSize]=g;i.data("bjui.paging",h);if(j){i.trigger("submit")}}}};return f};d.prototype.jumpPage=function(i,e){var h=this,g=h.options,f=h.pageCount;if(i&&isNaN(i)){return}if(e&&isNaN(e)){return}if(i){i=parseInt(i,10);if(i<1){i=1}if(i>f){i=f}if(i==g.pageCurrent){return}}if(e){e=parseInt(e,10)}h.tools.jumpPage(i||g.pageCurrent,e||g.pageSize)};d.prototype.init=function(){var k=this,z=k.tools,h=k.options,r=BJUI.regional.pagination,t=FRAG.gridPaging,g=[],C,x=[],l=BJUI.StrBuilder();k.pageCount=z.getPageCount(h.pageSize,h.total);C=z.getPageInterval(k.pageCount,h.pageCurrent,h.showPagenum);for(var v=C.start;v<C.end;v++){g.push(FRAG.gridPageNum.replace("#num#",v).replace("#active#",(h.pageCurrent==v?" active":"")))
}t=BJUI.doRegional(t.replaceAll("#pageCurrent#",h.pageCurrent).replaceAll("#count#",h.total+"/"+parseInt((k.pageCount||0),10)),r);l.add('<div class="paging-content">').add('<span></span><div class="paging-pagesize"><button type="button" class="btn-default btn-refresh" title="'+r.refresh+'" data-icon="refresh"></button>').add('<select data-toggle="selectpicker"></select>').add("</div>").add('<div class="paging-box">').add(t.replace("#pageNumFrag#",g.join(""))).add("</div>").add("</div>");k.$element.addClass("bjui-paging-box").html(l.toString());k.$element.find("> .paging-content").width(h.width).initui();z.setPaging(h.pageCurrent,h.pageSize);var y=k.$element.find("div.paging-pagesize > select"),f=k.$element.find("ul.pagination"),j=f.find("> li.page-total"),q=j.next(),D=q.next(),A=D.next(),B=A.nextAll(".page-next"),p=B.next();var n=function(){D.addClass("disabled");A.addClass("disabled")};var u=function(){D.removeClass("disabled");A.removeClass("disabled")};var o=function(){B.addClass("disabled");p.addClass("disabled")};var w=function(){B.removeClass("disabled");p.removeClass("disabled")};var m=function(){n();w()};var s=function(){u();o()};var e=function(i){y.empty();if(!i){i=k.options.pageSize}x=h.selectPageSize.split(",");x.push(String(i));c.unique(x).sort(function(G,F){return G-F});var E=[];c.each(x,function(F,G){E.push('<option value="'+G+'"'+(G==h.pageSize&&"selected")+">"+G+"/"+r.page+"</option>")});y.html(E.join("")).selectpicker("refresh")};if(h.pageCurrent==1){m()}if(h.pageCurrent==k.pageCount){s();if(h.pageCurrent==1){n()}}if(!h.total){o()}e();k.$element.on("click.bjui.pagination.pagenum","li.page-num",function(E){var i=c(this);if(!i.hasClass("active")){k.jumpPage(i.text())}E.preventDefault()}).on("click.bjui.pagination.refresh","button.btn-refresh",function(){k.jumpPage()}).on("bjui.pagination.jump",function(I){var H=k.options.pageCurrent,E=z.getPageInterval(k.pageCount,H,h.showPagenum),G=[];for(var F=E.start;F<E.end;F++){G.push(FRAG.gridPageNum.replace("#num#",F).replace("#active#",(H==F?" active":"")))}f.find("> li.page-num").remove();A.after(G.join(""));if(H==1){m();if(H==k.pageCount){o()}if(!k.options.total){o()}}else{if(H==k.pageCount){s()}else{u();w()}}q.find("input").val(H);j.find("> span").html(k.options.total+"/"+k.pageCount)}).on("bjui.pagination.pageSize",function(E,i){e(i)}).on("change","div.paging-pagesize > select",function(){var i=c(this).val();k.pageCount=z.getPageCount(i,h.total);k.jumpPage(null,i)});q.find("input").on("keyup",function(E){if(E.which===BJUI.keyCode.ENTER){var i=c(this).val();if(i){k.jumpPage(i)}}});D.on("click",function(){if(k.options.pageCurrent>1){k.jumpPage(1)}});A.on("click",function(){if(k.options.pageCurrent>1){k.jumpPage(k.options.pageCurrent-1)}});B.on("click",function(){if(k.options.pageCurrent<k.pageCount){k.jumpPage(k.options.pageCurrent+1)}});p.on("click",function(){if(k.options.pageCurrent<k.pageCount){k.jumpPage(k.pageCount)}})};d.prototype.destroy=function(){this.$element.removeData("bjui.pagination").empty()};function b(f){var e=arguments,g=f;return this.each(function(){var j=c(this),h=c.extend({},d.DEFAULTS,j.data(),typeof f==="object"&&f),i=j.data("bjui.pagination");if(!i){j.data("bjui.pagination",(i=new d(this,h)))}if(typeof g==="string"&&c.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}else{i.init()}})}var a=c.fn.pagination;c.fn.pagination=b;c.fn.pagination.Constructor=d;c.fn.pagination.noConflict=function(){c.fn.pagination=a;return this};c(document).on(BJUI.eventType.initUI,function(f){c(f.target).find('[data-toggle="pagination"]').each(function(){var h=c(this),g=h.data(),e=g.options;if(e){if(typeof e==="string"){e=e.toObj()}if(typeof e==="object"){delete g.options;c.extend(g,e)}}b.call(h,g)})})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function($){var MONTH_NAMES=new Array("January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");var DAY_NAMES=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat");function LZ(x){return(x<0||x>9?"":"0")+x}function formatDate(date,format){format=format+"";var result="";var i_format=0;var c="";var token="";var y=date.getYear()+"";var M=date.getMonth()+1;var d=date.getDate();var E=date.getDay();var H=date.getHours();var m=date.getMinutes();var s=date.getSeconds();var yyyy,yy,MMM,MM,dd,hh,h,mm,ss,ampm,HH,H,KK,K,kk,k;var value={};if(y.length<4){y=""+(y-0+1900)}value["y"]=""+y;value["yyyy"]=y;value["yy"]=y.substring(2,4);value["M"]=M;value["MM"]=LZ(M);value["MMM"]=MONTH_NAMES[M-1];value["NNN"]=MONTH_NAMES[M+11];value["d"]=d;value["dd"]=LZ(d);value["E"]=DAY_NAMES[E+7];value["EE"]=DAY_NAMES[E];value["H"]=H;value["HH"]=LZ(H);if(!H){value["h"]=12}else{if(H>12){value["h"]=H-12
}else{value["h"]=H}}value["hh"]=LZ(value["h"]);if(H>11){value["K"]=H-12}else{value["K"]=H}value["k"]=H+1;value["KK"]=LZ(value["K"]);value["kk"]=LZ(value["k"]);if(H>11){value["a"]="PM"}else{value["a"]="AM"}value["m"]=m;value["mm"]=LZ(m);value["s"]=s;value["ss"]=LZ(s);while(i_format<format.length){c=format.charAt(i_format);token="";while(format.charAt(i_format)==c&&i_format<format.length){token+=format.charAt(i_format++)}if(value[token]!=null){result+=value[token]}else{result+=token}}return result}function _isInteger(val){return new RegExp(/^\d+$/).test(val)}function _getInt(str,i,minlength,maxlength){for(var x=maxlength;x>=minlength;x--){var token=str.substring(i,i+x);if(token.length<minlength){return null}if(_isInteger(token)){return token}}return null}function parseDate(val,format){val=val+"";format=format+"";var i_val=0;var i_format=0;var c="";var token="";var token2="";var x,y;var now=new Date(1900,0,1);var year=now.getYear();var month=now.getMonth()+1;var date=1;var hh=now.getHours();var mm=now.getMinutes();var ss=now.getSeconds();var ampm="";while(i_format<format.length){c=format.charAt(i_format);token="";while(format.charAt(i_format)==c&&i_format<format.length){token+=format.charAt(i_format++)}if(token=="yyyy"||token=="yy"||token=="y"){if(token=="yyyy"){x=4;y=4}if(token=="yy"){x=2;y=2}if(token=="y"){x=2;y=4}year=_getInt(val,i_val,x,y);if(year==null){return 0}i_val+=year.length;if(year.length==2){if(year>70){year=1900+(year-0)}else{year=2000+(year-0)}}}else{if(token=="MMM"||token=="NNN"){month=0;for(var i=0;i<MONTH_NAMES.length;i++){var month_name=MONTH_NAMES[i];if(val.substring(i_val,i_val+month_name.length).toLowerCase()==month_name.toLowerCase()){if(token=="MMM"||token=="NNN"&&i>11){month=i+1;if(month>12){month-=12}i_val+=month_name.length;break}}}if(month<1||month>12){return 0}}else{if(token=="EE"||token=="E"){for(var i=0;i<DAY_NAMES.length;i++){var day_name=DAY_NAMES[i];if(val.substring(i_val,i_val+day_name.length).toLowerCase()==day_name.toLowerCase()){i_val+=day_name.length;break}}}else{if(token=="MM"||token=="M"){month=_getInt(val,i_val,token.length,2);if(month==null||month<1||month>12){return 0}i_val+=month.length}else{if(token=="dd"||token=="d"){date=_getInt(val,i_val,token.length,2);if(date==null||date<1||date>31){return 0}i_val+=date.length}else{if(token=="hh"||token=="h"){hh=_getInt(val,i_val,token.length,2);if(hh==null||hh<1||hh>12){return 0}i_val+=hh.length}else{if(token=="HH"||token=="H"){hh=_getInt(val,i_val,token.length,2);if(hh==null||hh<0||hh>23){return 0}i_val+=hh.length}else{if(token=="KK"||token=="K"){hh=_getInt(val,i_val,token.length,2);if(hh==null||hh<0||hh>11){return 0}i_val+=hh.length}else{if(token=="kk"||token=="k"){hh=_getInt(val,i_val,token.length,2);if(hh==null||hh<1||hh>24){return 0}i_val+=hh.length;hh--}else{if(token=="mm"||token=="m"){mm=_getInt(val,i_val,token.length,2);if(mm==null||mm<0||mm>59){return 0}i_val+=mm.length}else{if(token=="ss"||token=="s"){ss=_getInt(val,i_val,token.length,2);if(ss==null||ss<0||ss>59){return 0}i_val+=ss.length}else{if(token=="a"){if(val.substring(i_val,i_val+2).toLowerCase()=="am"){ampm="AM"}else{if(val.substring(i_val,i_val+2).toLowerCase()=="pm"){ampm="PM"}else{return 0}}i_val+=2}else{if(val.substring(i_val,i_val+token.length)!=token){return 0}else{i_val+=token.length}}}}}}}}}}}}}}if(i_val!=val.length){return 0}if(month==2){if(year%4==0&&year%100!=0||year%400==0){if(date>29){return 0}}else{if(date>28){return 0}}}if(month==4||month==6||month==9||month==11){if(date>30){return 0}}if(hh<12&&ampm=="PM"){hh=hh-0+12}else{if(hh>11&&ampm=="AM"){hh-=12}}return new Date(year,month-1,date,hh,mm,ss)}Date.prototype.formatDate=function(dateFmt){return formatDate(this,dateFmt)};String.prototype.parseDate=function(dateFmt){if(this.length<dateFmt.length){dateFmt=dateFmt.slice(0,this.length)}return parseDate(this,dateFmt)};function replaceTmEval(data){return data.replace(RegExp("({[A-Za-z0-9_+-]*})","g"),function($1){return eval("("+$1.replace(/[{}]+/g,"")+")")})}Date.prototype.formatDateTm=function(dateFmt){var y=this.getFullYear();var m=this.getMonth()+1;var d=this.getDate();var sDate=dateFmt.replaceAll("%y",y).replaceAll("%M",m).replaceAll("%d",d);sDate=replaceTmEval(sDate);var _y=1900,_m=0,_d=1;var aDate=sDate.split("-");if(aDate.length>0){_y=aDate[0]}if(aDate.length>1){_m=aDate[1]-1}if(aDate.length>2){_d=aDate[2]}return new Date(_y,_m,_d).formatDate("yyyy-MM-dd")}}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(g){var s,j,u,v,o,i,k,t,q,d,p,m,b,e,h,f,l,n;g(function(){var w=function(){var z=BJUI.regional.datepicker;var y=FRAG.calendarFrag.replace("#close#",z.close).replace("#prev#",z.prev).replace("#next#",z.next).replace("#clear#",z.clear).replace("#ok#",z.ok);s=g(y).hide();g("body").append("<!-- datepicker -->").append(s);j=s.find("> .main");u=s.find("a.prev");v=s.find("a.next");o=s.find("select[name=year]");
    i=s.find("select[name=month]");k=s.find(".time");t=k.find(":text");q=k.find("ul > li");d=k.find(".hh");p=k.find(".mm");m=k.find(".ss");b=j.find("> .tm");e=s.find(".close");h=j.find("> .body > .days");f=j.find("> .body > .dayNames");l=s.find(".clearBtn");n=s.find(".okBtn");var A="",x=BJUI.regional.datepicker;g.each(x.dayNames,function(C,B){A+="<dt>"+B+"</dt>"});f.html(A);g.each(x.monthNames,function(D,C){var B=D+1;i.append('<option value="'+B+'">'+C+"</option>")});s.on("selectstart",function(){return false})};w()});var r=function(y,x){this.$element=g(y);this.options=x;this.tools=this.TOOLS();this.$dateBtn=null;var w=new Date();this.options.minDate=w.formatDateTm(this.options.minDate);this.options.maxDate=w.formatDateTm(this.options.maxDate);this.events={focus_time:"focus.bjui.datepicker.time",click_prev:"click.bjui.datepicker.prev",click_next:"click.bjui.datepicker.next",click_ok:"click.bjui.datepicker.ok",click_days:"click.bjui.datepicker.days",click_clear:"click.bjui.datepicker.clear",click_close:"click.bjui.datepicker.close",click_tm:"click.bjui.datepicker.tm",click_spinner:"click.bjui.datepicker.spinner",mousedown_sp:"mousedown.bjui.datepicker.spinner",mouseup_sp:"mouseup.bjui.datepicker.spinner",change_ym:"change.bjui.datepicker.ym",click_time:"click.bjui.datepicker.time",keydown_time:"keydown.bjui.datepicker.time",keyup_time:"keyup.bjui.datepicker.time"}};r.DEFAULTS={pattern:"yyyy-MM-dd",minDate:"1900-01-01",maxDate:"2099-12-31",mmStep:1,ssStep:1};r.EVENTS={afterChange:"afterchange.bjui.datepicker"};r.prototype.TOOLS=function(){var w=this;var x={changeTmMenu:function(y){b.removeClass("hh").removeClass("mm").removeClass("ss");if(y){b.addClass(y);t.removeClass("slt").filter("."+y).addClass("slt")}},clickTmMenu:function(z,y){b.find("> ul").hide().filter("."+y).show().find("> li").off(w.events.click_tm).on(w.events.click_tm,function(){var B=g(this);var A=parseInt(B.text())<10?("0"+B.text()):B.text();z.val(A)})},keydownInt:function(y){if(!((y.keyCode>=48&&y.keyCode<=57)||(y.keyCode==BJUI.keyCode.DELETE||y.keyCode==BJUI.keyCode.BACKSPACE))){return false}},changeTm:function(F,D){var z=parseInt(F.val()),C=parseInt(F.data("start"))||0,B=parseInt(F.data("end"));var E=parseInt(F.data("step")||1);var A=D?(D.data("add")?D.data("add"):-1):0;var y=z;if(A==1){if(z<=B-E){y=z+E}}else{if(A==-1){if(z>=(C+E)){y=z-E}}else{if(z>B){y=B}else{if(z<C){y=C}}}}if(y<10){y="0"+y}F.val(y)},closeCalendar:function(y){x.changeTmMenu();if(y){g(document).off(w.events.click_close);s.hide()}},get:function(y){return w.options[y]},getDays:function(A,z){return z==2?(A%4||(!(A%100)&&A%400)?28:29):(/4|6|9|11/.test(z)?30:31)},minMaxDate:function(A){var z=A.split("-").length-1;var y="y-M-d";if(z==1){y="y-M"}else{if(!z){y="y"}}return A.parseDate(y)},getMinDate:function(){return this.minMaxDate(w.options.minDate)},getMaxDate:function(){var B=w.options.maxDate;var z=B.split("-").length-1;var y=this.minMaxDate(B);if(z<2){var A=this.getDays(y.getFullYear(),y.getMonth()+1);y.setDate(A);if(!z){y.setMonth(11)}}return y},getDateWrap:function(A){if(!A){A=this.parseDate(w.sDate)||new Date()}var C=A.getFullYear(),z=A.getMonth()+1,B=this.getDays(C,z);return{year:C,month:z,day:A.getDate(),hour:A.getHours(),minute:A.getMinutes(),second:A.getSeconds(),days:B,date:A}},changeDate:function(D,z,C){var B=this.getDateWrap(),C=C||1,A;A=new Date(D,z-1,C);if(A.getMonth()+1!=z){A=new Date(D,A.getMonth(),0);A.setMonth(z-1)}w.sDate=this.formatDate(A);return A},changeDateTime:function(F,E,D,B,z,C){var A=new Date(F,E-1,D,B,z,C);if(A.getMonth()+1!=E){A=new Date(F,A.getMonth(),0,B,z,C);A.setMonth(E-1)}w.sDate=this.formatDate(A);return A},changeDay:function(y,A){if(!A){A=0}var z=this.getDateWrap();return this.changeDate(z.year,z.month+parseInt(A),y)},changeMonth:function(z){var A=o.get(0).selectedIndex,y=o.find("option").length,B=(i.val()*1)+z;if(!B){if(!A){B=1}else{B=12;A--;o.get(0).selectedIndex=A}}else{if(B==13){if(A==(y-1)){B=12}else{B=1;A++;o.get(0).selectedIndex=A}}}i.val(B).change()},parseDate:function(y){if(!y){return null}return y.parseDate(w.options.pattern)},formatDate:function(y){return y.formatDate(w.options.pattern)},hasHour:function(){return w.options.pattern.indexOf("H")!=-1},hasMinute:function(){return w.options.pattern.indexOf("m")!=-1},hasSecond:function(){return w.options.pattern.indexOf("s")!=-1},hasTime:function(){return this.hasHour()||this.hasMinute()||this.hasSecond()},hasDate:function(){var z=["y","M","d","E"];for(var y=0;y<z.length;y++){if(w.options.pattern.indexOf(z[y])!=-1){return true}}return false},afterChange:function(y){var z=y?this.formatDate(y):"";w.$element.trigger(r.EVENTS.afterChange,{date:y,value:z}).trigger("change")}};return x};r.prototype.addBtn=function(){var z=this,x=z.$element,y=x.attr("size")?"":" fluid";if(x.data("nobtn")){return}if(!this.$dateBtn&&!this.options.addbtn&&!x.parent().hasClass("wrap_bjui_btn_box")){this.$dateBtn=g(FRAG.dateBtn);this.$element.css({"paddingRight":"15px"}).wrap('<span class="wrap_bjui_btn_box'+y+'"></span>');
    var A=this.$element.parent();var w=this.$element.addClass("form-control").innerHeight();A.css({"position":"relative","display":"inline-block"});this.$dateBtn.css({"height":w,"lineHeight":w+"px"}).appendTo(A);this.$dateBtn.on("selectstart",function(){return false})}};r.prototype.init=function(){if(!this.$element.is(":text")){return}if(this.$element.val()){this.sDate=this.$element.val().trim()}var B=this,F=this.options,A=this.tools,w=A.getDateWrap(),z=A.getMinDate(),x=A.getMaxDate(),E=z.getFullYear(),D=x.getFullYear();if(!F.toggle||F.toggle!=="datepicker"&&!B.JSAPI){B.$element.data("JSAPI",true)}o.empty();for(var C=E;C<=D;C++){o.append('<option value="'+C+'"'+(w.year==C?" selected":"")+">"+C+"</option>")}i.val(w.month);o.add(i).off(this.events.change_ym).on(this.events.change_ym,function(){if(A.hasTime()){var G=h.find(".slt"),y=A.changeDateTime(o.val(),i.val(),G.data("day"),w.hour,w.minute,w.second);B.create(A.getDateWrap(y),z,x)}else{var G=h.find(".slt"),y=A.changeDate(o.val(),i.val(),G.data("day"));B.create(A.getDateWrap(y),z,x)}});u.off(this.events.click_prev).on(this.events.click_prev,function(){B.tools.changeMonth(-1)});v.off(this.events.click_prev).on(this.events.click_prev,function(){B.tools.changeMonth(1)});l.off(this.events.click_clear).on(this.events.click_clear,function(){B.$element.val("");A.closeCalendar(true);A.afterChange("")});n.off(this.events.click_ok).on(this.events.click_ok,function(){var G=h.find("dd.slt");if(G.hasClass("disabled")){return false}var y=A.changeDay(G.data("day"),G.data("month"));if(A.hasTime()){y.setHours(parseInt(d.val()));y.setMinutes(parseInt(p.val()));y.setSeconds(parseInt(m.val()))}A.closeCalendar(true);B.$element.val(A.formatDate(y)).focus();A.afterChange(y)});e.off(this.events.click_close).on(this.events.click_close,function(){A.closeCalendar(true)});g(document).off(this.events.click_close).on(this.events.click_close,function(G){var y=g(G.target);if(G.target==B.$element.get(0)){return}if(y.closest("#calendar").length){return}if(y.data("toggle")=="datepicker"||y.parent().data("toggle")=="datepickerbtn"||y.data("toggle")=="datepickerbtn"||y.data("JSAPI")){A.closeCalendar(false)}else{A.closeCalendar(true)}});B.dw=w;B.minDate=z;B.maxDate=x;if(B.$element.data("JSAPI")){if(!F.nobtn){B.addBtn()}B.$element.off("click.bjui.datepicker.data-api").on("click.bjui.datepicker.data-api",g.proxy(function(y){B.create()},B));if(!F.nobtn){B.$element.parent(".wrap_bjui_btn_box").find('[data-toggle="datepickerbtn"]').off("click.bjui.datepicker.data-api").on("click.bjui.datepicker.data-api",g.proxy(function(y){B.create()},B))}}};r.prototype.create=function(w,A,x){if(!w){this.init();w=this.dw;A=this.minDate;x=this.maxDate}var F=this,L=this.options,E=this.tools,I=new Date(w.year,w.month-1,1),G=I.getDay(),C="";if(G>0){I.setMonth(I.getMonth()-1);var D=E.getDateWrap(I);for(var J=D.days-G+1;J<=D.days;J++){var K=new Date(w.year,w.month-2,J),z=(K>=A&&K<=x)?"":" disabled";C+='<dd class="other'+z+'" data-month="-1" data-day="'+J+'">'+J+"</dd>"}}for(var J=1;J<=w.days;J++){var K=new Date(w.year,w.month-1,J),z=(K>=A&&K<=x)?"":"disabled";if(J==w.day){z+=" slt"}C+='<dd class="'+z+'" data-day="'+J+'">'+J+"</dd>"}for(var J=1;J<=42-G-w.days;J++){var K=new Date(w.year,w.month,J),z=(K>=A&&K<=x)?"":" disabled";C+='<dd class="other'+z+'" data-month="1" data-day="'+J+'">'+J+"</dd>"}var H=h.html(C).find("dd");H.not(".disabled").off(this.events.click_days).on(this.events.click_days,function(){var N=g(this);if(!E.hasTime()){var M=E.changeDay(N.data("day"),N.data("month"));E.closeCalendar(true);F.$element.val(E.formatDate(M)).focus();E.afterChange(M)}else{H.removeClass("slt");N.addClass("slt")}});if(!E.hasDate()){j.addClass("nodate")}else{j.removeClass("nodate")}if(E.hasTime()){k.show();d.val(w.hour<10?("0"+w.hour):w.hour).off(this.events.focus_time).on(this.events.focus_time,function(){E.changeTmMenu("hh")});var B=parseInt(w.minute/L.mmStep)*L.mmStep;p.val(B<10?("0"+B):B).data("step",L.mmStep).off(this.events.focus_time).on(this.events.focus_time,function(){E.changeTmMenu("mm")});m.val(E.hasSecond()?(w.second<10?("0"+w.second):w.second):"00").data("step",L.ssStep).off(this.events.focus_time).on(this.events.focus_time,function(){E.changeTmMenu("ss")});s.off("click").on("click",function(M){if(g(M.target).closest(".time").length){return}b.find("> ul").hide();E.changeTmMenu()});t.off(this.events.keydown_time).on(this.events.keydown_time,E.keydownInt).each(function(){var M=g(this);M.off(F.events.keyup_time).on(F.events.keyup_time,function(){E.changeTm(M)})}).off(this.events.click_time).on(this.events.click_time,function(){E.clickTmMenu(g(this),g(this).data("type"))});var y=null;q.off(this.events.click_spinner).on(this.events.click_spinner,function(N){var M=g(this);t.filter(".slt").each(function(){E.changeTm(g(this),M)});N.preventDefault()}).off(this.events.mousedown_sp).on(this.events.mousedown_sp,function(N){var M=g(this);y=setInterval(function(){t.filter(".slt").each(function(){E.changeTm(g(this),M)})},150)}).off(this.events.mouseup_sp).on(this.events.mouseup_sp,function(M){clearTimeout(y)
});d.prop("disabled",!E.hasHour());p.prop("disabled",!E.hasMinute());m.prop("disabled",!E.hasSecond())}else{k.hide()}this.show()};r.prototype.show=function(){var B=this.$element.offset(),A=B.top+this.$element.get(0).offsetHeight,z=B.left,w=s.outerHeight(true),y=s.outerWidth(true),x={};if(A>w&&A>g(window).height()-w){A=B.top-w}x.left=z;x.top=A;if(z>g(window).width()-y){s.css("left","");delete x.left;x.right=10}s.css(x).show().click(function(C){C.stopPropagation()})};function c(x){var w=arguments;var y=x;return this.each(function(){var B=g(this);var z=g.extend({},r.DEFAULTS,B.data(),typeof x==="object"&&x);var A=B.data("bjui.datepicker");if(!A){B.data("bjui.datepicker",(A=new r(this,z)))}if(typeof y==="string"&&g.isFunction(A[y])){[].shift.apply(w);if(!w){A[y]()}else{A[y].apply(A,w)}}else{A.init()}})}var a=g.fn.datepicker;g.fn.datepicker=c;g.fn.datepicker.Constructor=r;g.fn.datepicker.noConflict=function(){g.fn.datepicker=a;return this};g(document).on(BJUI.eventType.initUI,function(w){g(w.target).find('[data-toggle="datepicker"]').each(function(){var x=g(this);if(!x.length){return}if(x.data("nobtn")){return}c.call(x,"addBtn")})});g(document).on("click.bjui.datepicker.data-api",'[data-toggle="datepickerbtn"]',function(w){var x=g(this).prevAll('[data-toggle="datepicker"]');if(!x||!x.is(":text")){return}c.call(x,"create");w.preventDefault()});g(document).on("click.bjui.datepicker.data-api",'[data-toggle="datepicker"]',function(x){var w=g(this);if(w.data("onlybtn")){return}if(!w.is(":text")){return}c.call(w,"create");x.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(c){var d=function(f,e){this.$element=c(f);this.options=e};d.DEFAULTS={url:undefined,target:undefined,reload:false};d.prototype.init=function(){var e=this.options;if(!(e.url)){BJUI.debug("Ajaxtab Plugin: Error trying to open a tab, url is undefined!");return}else{e.url=decodeURI(e.url).replacePlh(this.$element.closest(".unitBox"));if(!e.url.isFinishedTm()){this.$element.alertmsg("error",(e.warn||BJUI.regional.plhmsg));BJUI.debug("Ajaxtab Plugin: The new ajaxtab's url is incorrect, url: "+e.url);return}e.url=encodeURI(e.url)}if(!e.target){BJUI.debug("Ajaxtab Plugin: Attribute 'target' is not defined!");return}if(e.reload){this.load()}else{var f=this.$element.data("bjui.ajaxtab.reload");if(!f){this.load()}else{this.$element.tab("show")}}};d.prototype.load=function(){var e=this.$element;var f=this.options;c(f.target).ajaxUrl({url:f.url,data:{},callback:function(){e.data("bjui.ajaxtab.reload",true).tab("show")}})};function b(f){var e=arguments;var g=f;return this.each(function(){var j=c(this);var h=c.extend({},d.DEFAULTS,j.data(),typeof f==="object"&&f);var i=j.data("bjui.ajaxtab");if(!i){j.data("bjui.ajaxtab",(i=new d(this,h)))}if(typeof g==="string"&&c.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}else{i.init()}})}var a=c.fn.ajaxtab;c.fn.ajaxtab=b;c.fn.ajaxtab.Constructor=d;c.fn.ajaxtab.noConflict=function(){c.fn.ajaxtab=a;return this};c(document).on("click.bjui.ajaxtab.data-api",'[data-toggle="ajaxtab"]',function(h){var g=c(this);var f=g.data();if(!f.url){f.url=g.attr("href")}b.call(g,f);h.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(d){var c=function(f,e){this.$element=d(f);this.options=e;this.tools=this.TOOLS();this.datanames={tbody:"bjui.datagrid.tbody.dom",td_html:"bjui.datagrid.td.html",changeData:"bjui.datagrid.tr.changeData"};this.classnames={s_checkbox:"datagrid-checkbox",s_linenumber:"datagrid-linenumber",s_edit:"datagrid-column-edit",s_lock:"datagrid-lock",s_menu:"datagrid-menu-box",s_filter:"datagrid-filter-box",s_showhide:"datagrid-showhide-box",th_cell:"datagrid-cell",th_menu:"datagrid-column-menu",btn_menu:"datagrid-column-menu-btn",th_col:"datagrid-col",th_field:"datagrid-col-field",th_sort:"datagrid-sortable",th_resize:"datagrid-resize-head",th_resizemark:"datagrid-column-resizemark",tr_child:"datagrid-child-tr",tr_edit:"datagrid-edit-tr",tr_add:"datagrid-add-tr",tr_selected:"datagrid-selected-tr",td_edit:"datagrid-edit-td",td_changed:"datagrid-changed",td_child:"datagrid-child-td",td_linenumber:"datagrid-linenumber-td",td_checkbox:"datagrid-checkbox-td",li_asc:"datagrid-li-asc",li_desc:"datagrid-li-desc",li_filter:"datagrid-li-filter",li_showhide:"datagrid-li-showhide",li_lock:"datagrid-li-lock",li_unlock:"datagrid-li-unlock"}};c.DEFAULTS={gridTitle:"",columns:null,data:null,dataUrl:null,updateRowUrl:null,postData:null,loadType:"POST",dataType:"json",local:"remote",fieldSortable:true,filterThead:true,sortAll:true,filterAll:true,filterMult:true,initFilter:{},selectMult:false,linenumberAll:false,showLinenumber:true,showCheckboxcol:false,showChildcol:undefined,showEditbtnscol:false,customEditbtns:{position:"after",buttons:null,width:0},showTfoot:false,showToolbar:false,showNoDataTip:true,toolbarItem:"",toolbarCustom:"",columnResize:true,columnMenu:true,columnShowhide:true,columnFilter:false,columnLock:true,paging:true,pagingAlign:"center",keys:{gridChild:"gridChild",gridNumber:"gridNumber",gridCheckbox:"gridCheckbox",gridEdit:"gridEdit",gridIndex:"gridIndex",dropFlag:"dropFlag",treePTr:"datagrid.tree.parentTr",treePData:"datagrid.tree.parentData",childlen:"childlen",isExpand:"isExpand",isParent:"isparent"},hasChild:false,childOptions:{width:"100%",height:"auto",paging:false,columnMenu:false,filterThead:false,childUpdate:false},isTree:false,treeOptions:{keys:{key:"id",parentKey:"pid",childKey:"children",childLen:"childlen",isParent:"isparent",level:"level",order:"order",isExpand:"isExpand"},simpleData:true,expandAll:false,add:true},dropOptions:{drop:false,dropUrl:null,paging:true,scope:"drop",beforeDrag:null,beforeDrop:null,afterDrop:"POST"},tdTemplate:"",editUrl:null,editCallback:null,editMode:"inline",editDialogOp:null,editType:"POST",inlineEditMult:true,saveAll:true,addLocation:"first",delUrl:null,delType:"POST",delPK:null,delConfirm:true,delCallback:null,jsonPrefix:"",contextMenuH:true,contextMenuB:false,templateWidth:600,flowLayoutWidth:0,dialogFilterW:360,hScrollbar:false,fullGrid:false,importOption:null,exportOption:null,beforeEdit:null,beforeDelete:null,beforeSave:null,afterSave:null,afterDelete:null,afterCancel:null};
    c.renderItem=function(i,h,e,g){if(!e||!e.length){return""}var f="";d.each(e,function(j,k){if(g&&g.value){if(k[g.value]==i){f=k[g.label];return false}}else{if(typeof k[i]!=="undefined"){f=k[i];return false}}});return f};c.renderItemMulti=function(i,h,e,g){if(!e||!e.length){return""}var f=[],j=d.type(i)==="array"?i:String(i).split(",");d.each(e,function(k,l){d.each(j,function(n,m){if(g&&g.value){if(l[g.value]==m){f.push(l[g.label]);return false}}else{if(typeof l[m]!=="undefined"){f.push(l[m]);return false}}})});return f.join(",")};c.prototype.TOOLS=function(){var f=this,e=f.options;var g={getPageCount:function(h,i){return Math.ceil(i/h)},getPageInterval:function(j,l,n){var k=Math.ceil(n/2),i=j-n,m=l>k?Math.max(Math.min(l-k,i),0):0,h=l>k?Math.min((l+k),j):Math.min(n,j);if(h-m==n){h=h+1}if(h<n){h=h+1}if(m+1==h){h=h+1}return{start:m+1,end:h}},getRight:function(m){var l=0,j=m.data("index"),h=f.columnModel;for(var k=j;k>=0;k--){l+=h[k].th.outerWidth()}return l},getRight4Lock:function(i){var j=0,k=f.$lockTbody.find("> tr:first > td:eq("+i+")"),h=k&&k.prevAll().add(k);if(!h||!h.length){h=f.$lockColgroupH.filter(":lt("+(i+1)+")")}h.each(function(){var m=d(this),l=m.is(":hidden")?0:m.outerWidth();j+=l});return j},beforeEdit:function(i,h){var j=e.beforeEdit;if(j){if(typeof j==="string"){j=j.toFunc()}if(typeof j==="function"){return j.call(f,i,h)}}return true},beforeSave:function(h,j){var i=e.beforeSave;if(i){if(typeof i==="string"){i=i.toFunc()}if(typeof i==="function"){return i.call(f,h,j)}}return true},afterSave:function(h,j){var m=e.afterSave,n=f.options.childUpdate,l=f.$element.data("bjui.datagrid.parent"),i=function(o){o.closest("table").datagrid("updateRow",o)};if(m){if(typeof m==="string"){m=m.toFunc()}if(typeof m==="function"){m.call(f,h,j)}}h.each(function(){d(this).removeData("datagrid.addData")});if(l&&n){if(typeof n==="string"&&n.indexOf("all")===-1){if(j.addFlag&&n.indexOf("add")!==-1){i(l)}else{if(n.indexOf("edit")!==-1){i(l)}}}else{i(l)}}if(f.needfixedWidth){f.fixedWidth();f.needfixedWidth=false}if(e.height==="auto"){var k=f.$boxB.scrollTop();f.$boxB.scrollTop(5);if(f.$boxB.scrollTop()){f.fixedHeight();f.$boxB.scrollTop(k)}}f.$element.data("allData",f.allData)},afterDelete:function(){var h=e.afterDelete;if(h){if(typeof h==="string"){h=h.toFunc()}if(typeof h==="function"){h.call(f)}}f.$element.data("allData",f.allData)},afterCancel:function(){var h=e.afterCancel;if(h){if(typeof h==="string"){h=h.toFunc()}if(typeof h==="function"){h.call(f)}}f.$element.data("allData",f.allData)},setColspan:function(i,h){if(i.colspan){i.colspan=i.colspan+h-1}i.index=i.index+h-1;if(i.parent){this.setColspan(i.parent,h)}},setOp:function(h){if(!h.name){h.menu=h.lock=h.edit=h.add=h.quickSort=h.quickfilter=false}else{h.menu=(typeof h.menu==="undefined")?true:h.menu;h.lock=(typeof h.lock==="undefined")?true:h.lock;h.edit=(typeof h.edit==="undefined")?true:h.edit;h.add=(typeof h.add==="undefined")?true:h.add;h.quicksort=(typeof h.quicksort==="undefined")?true:h.quicksort;h.quickfilter=(typeof h.quickfilter==="undefined")?true:h.quickfilter;h.finalWidth=(typeof h.finalWidth==="undefined")?false:h.finalWidth}h.hide=(typeof h.hide==="undefined")?false:h.hide;return h},json2Array4Tree:function(y,v,j,u){if(!v){return[]}if(!j){j=0}var o=y.key,p=y.parentKey,m=y.childKey,x=y.childLen,w=y.level,t=y.isParent,h=[],s;if(v){v.sort(function(k,i){return k[y.order]-i[y.order]})}if(d.isArray(v)){for(var q=0,n=v.length;q<n;q++){s=d.extend({},v[q]);s[w]=j;h.push(s);if(s[m]){delete s[m];s[t]=true;s[x]=v[q][m].length;u=s[o];h=h.concat(this.json2Array4Tree(y,v[q][m],s[w]+1,u));u=null}}}else{s=d.extend({},v);s[w]=j;h.push(s);if(s[m]){delete s[m];s[t]=true;s[x]=v[m].length;u=s[o];h=h.concat(this.json2Array4Tree(y,v[m],s[w]+1));u=null}}return h},array2Json4Tree:function(t,n){var h=[],q=[],s=t.keys,p=s.key,o=s.parentKey,j=s.childKey;if(!d.isArray(n)){return[n]}for(var m=0,k=n.length;m<k;m++){q[n[m][p]]=n[m]}for(var m=0,k=n.length;m<k;m++){if(q[n[m][o]]&&n[m][o]&&n[m][p]!==n[m][o]){if(!q[n[m][o]][j]){q[n[m][o]][j]=[]}q[n[m][o]][j].push(n[m])}else{h.push(n[m])}}return h},createTrsByData:function(j,h){var i;if(!f.$tbody){f.$tbody=d("<tbody></tbody>")}if(j){if(j.list){i=j.list}else{i=j}f.paging.total=i.length||0;if(f.options.isTree){if(f.options.treeOptions.simpleData){i=this.array2Json4Tree(f.options.treeOptions,i);i=this.json2Array4Tree(f.options.treeOptions.keys,i)}else{i=this.json2Array4Tree(f.options.treeOptions.keys,i)}}if(i&&!d.isArray(i)){i=[i]}f.paging.total=(i&&i.length)||0;if(!f.paging.total){i=[]}if(typeof j==="object"&&f.paging.total){if(j[BJUI.pageInfo.total]){f.paging.total=parseInt(j[BJUI.pageInfo.total],10)}if(j[BJUI.pageInfo.pageSize]){if(h&&f.paging.pageSize!=j[BJUI.pageInfo.pageSize]){f.$boxP&&f.$boxP.trigger("bjui.datagrid.paging.pageSize",j[BJUI.pageInfo.pageSize])}f.paging.pageSize=parseInt(j[BJUI.pageInfo.pageSize],10)}}f.paging.pageCount=g.getPageCount(f.paging.pageSize,f.paging.total);if(f.paging.pageCurrent>f.paging.pageCount){f.paging.pageCurrent=f.paging.pageCount
    }if(!f.paging.pageCurrent){f.paging.pageCurrent=1}this.initTbody(i,h)}if(!f.init_tbody){f.$tbody.appendTo(f.$tableB)}if(!f.init_thead){f.initThead()}},initTbody:function(p,o){var r=this,j=f.allData,t=e.dataType||"json",q=f.columnModel,k=f.hiddenFields,l=f.regional,w=[],s=f.attach,v;var i=f.paging,h=0,n=i.pageSize,u=f.options.keys;var m=function(){t=t.toLowerCase();if(p){j=f.allData=p}f.$element.data("allData",f.allData);if(!j.length){n=0}else{if(e.local==="local"){h=(i.pageSize*(i.pageCurrent-1));n=h+i.pageSize;if(i.total!=j.length){i.total=j.length}if(h>j.length){h=i.pageSize*(i.pageCount-1)}}else{if(j.length>i.pageSize){n=i.pageSize}}}if(n>j.length){n=j.length}if(t==="array"&&p&&p.length&&d.type(p[0])==="array"){var y=h,x=n,z=[],B;if(e.local==="local"){y=0;x=j.length}for(var A=y;A<x;A++){v={};B=0;d.each(j[A],function(D,C){var E,F=C;if(q[B]&&q[B][u.gridChild]){B++}if(q[B]&&q[B][u.gridNumber]){B++}if(q[B]&&q[B][u.gridCheckbox]){B++}if(typeof F==="string"){F='"'+F+'"'}if(q[B]&&!q[B][u.gridEdit]){E='{"'+q[B].name+'":'+F+"}";d.extend(v,JSON.parse(E))}else{if(q[B]&&q[B][u.gridEdit]){B++}if(B>=q.length&&k){if(k[D-q.length]){E='{"'+k[D-q.length]+'":'+F+"}";d.extend(v,JSON.parse(E))}}}B++});z.push(v)}j=f.allData=z}for(var A=h;A<n;A++){v=d.extend({},f.allData[A],s);if(e.local==="local"&&!o){v["bjui_local_index"]=A;f.allData[A]["bjui_local_index"]=A}w.push(v)}r.createTrs(w,o);f.data=w;f.$element.trigger("afterLoad.bjui.datagrid",{datas:w})};if(o&&f.$boxM){f.$boxM.show().trigger("bjui.ajaxStop").trigger("bjui.ajaxStart",[50,m])}else{m()}},createTrs:function(s,O){var F=this,G=f.options.keys,m=f.columnModel,C=f.paging,t=[],A=BJUI.doRegional(FRAG.gridEditBtn,f.regional),M=BJUI.doRegional(FRAG.gridExpandBtn,f.regional),K=[],P=false,q=f.options.customEditbtns,x=q.buttons;if(x){if(typeof x==="function"){x=x.apply()}if(x){if(q.position==="before"){A=x+A}else{if(q.position==="replace"){A=x}else{A+=x}}}}if(O){d.each(m,function(j,l){if(l.locked){f.colLock(l.th,false);l.lock_refresh=true}});if(f.$tbody.find("> tr.datagrid-nodata").length){f.needfixedWidth=true}f.$tbody.empty();f.$lockTableH&&f.$lockTableH.empty();f.$lockTableB&&f.$lockTableB.empty()}if(!s.length&&!O){var J={};J[m[0].name]="0";P=true;s=[];s.push(J)}for(var X=0,V=s.length;X<V;X++){var D=s[X],Q=m.length,w=Q,k=e.linenumberAll?((C.pageCurrent-1)*C.pageSize+(X+1)):(X+1),L=[],S,Y=BJUI.StrBuilder(),Z,y,R,T,h,U,o,E,B,r=false,v="",z=e.tdTemplate;D[G.gridNumber]=k;D[G.gridIndex]=X;if(f.options.hasChild&&f.options.childOptions){w=w-1}if(f.options.showLinenumber){w=w-1}if(f.options.showCheckboxcol){w=w-1}var N=d.extend({},D);for(var W=0;W<Q;W++){S=m[W];y=S.name||"datagrid-noname";R=D[y];U="";o=[];T="";E="";B="";h=undefined;if(typeof R==="undefined"||R==="null"||R===null){R=""}T=R;if(S.align){U=' align="'+S.align+'"'}if(S[G.gridChild]){R=M}if(S[G.gridCheckbox]){R='<div><input type="checkbox" data-toggle="icheck" name="datagrid.checkbox" value="true"></div>'}if(S[G.gridEdit]){R=A;o.push(f.classnames.s_edit)}if(e.hScrollbar){if(!S.width||S.width==="auto"){o.push("nowrap")}}if(S[G.gridChild]){o.push(f.classnames.td_child)}if(S[G.gridNumber]){o.push(f.classnames.td_linenumber)}if(S[G.gridCheckbox]){o.push(f.classnames.td_checkbox)}if(o.length){o=o.join(" ")}else{o=""}if(O&&S.hidden){E=' style="display:none;"'}if(S.items&&!S.render){if(S.attrs&&S.attrs["multiple"]){S.render=d.datagrid.renderItemMulti}else{S.render=d.datagrid.renderItem}}if(S.render&&typeof S.render==="string"){S.render=S.render.toFunc()}if(S.render&&typeof S.render==="function"){if(S.items){if(typeof S.items==="string"){if(S.items.trim().startsWith("[")){S.items=S.items.toObj()}else{S.items=S.items.toFunc()}}if(!f.renderTds){f.renderTds=[]}var I=function(l,j,i,aa){d.when(aa.items.call(f)).done(function(n){aa.items=n;f.delayRender--})};if(typeof S.items==="function"){if(!X){if(!f.delayRender){f.delayRender=0}f.delayRender++;I((X*W),T,D,S)}S.delayRender=true;f.renderTds.push({trindex:X,tdindex:W,label:T,data:D,render:S.render})}else{delete S.delayRender;h=S.render.call(f,T,D,S.items,S.itemattr)}}else{h=S.render.call(f,T,D)}}if(e.isTree&&!r&&(!(S===f.childColumn||S===f.linenumberColumn||S===f.checkboxColumn||S===f.editBtnsColumn)||f.treeColumn)){if(typeof e.isTree==="string"){if(S.name&&S.name===e.isTree){r=true}}else{r=true}if(r){!f.treeColumn&&(f.treeColumn=S);S.hasTree=true;!D[e.treeOptions.keys.level]&&(D[e.treeOptions.keys.level]=0);B=f.tools.createTreePlaceholder(D,(h||R));U=' align="left"';if(o){o+=" datagrid-tree-td"}else{o="datagrid-tree-td"}v=' data-child="'+(D[e.treeOptions.keys.childLen]||0)+'" data-level="'+D[e.treeOptions.keys.level]+'" class="datagrid-tree-tr datagrid-tree-level-'+D[e.treeOptions.keys.level]+'"'}}o&&(o=' class="'+o+'"');if(f.isTemplate){if(!S.delayRender){N[S.name]=(typeof h==="undefined"?R:h)}else{delete N[S.name]}if(!L[0]&&W==(Q-1)){if(z&&typeof z==="function"){z=z.apply(f,[D])}z=f.tools.replacePlh4Template(z,N,true);if(f.options.hasChild&&f.options.childOptions){E=f.childColumn.hidden?' style="display:none;"':"";
        L[0]=['<td data-title="..." align="center" class="datagrid-child-td"'+E+"><div>"+M+"</div></td>"]}if(f.options.showLinenumber){E=f.linenumberColumn.hidden?' style="display:none;"':"";var H=['<td data-title="No." align="center" class="datagrid-linenumber-td"'+E+">"+k+"</td>"];L[L.length]=H}if(f.options.showCheckboxcol){E=f.checkboxColumn.hidden?' style="display:none;"':"";var u=['<td data-title="Checkbox" align="center" class="datagrid-checkbox-td"'+E+'><div><input type="checkbox" data-toggle="icheck" name="datagrid.checkbox" value="true"></div></td>'];L[L.length]=u}var p=['<td class="datagrid-template-td" colspan="'+w+'">'+z+"</td>"];L[L.length]=p;v=' class="datagrid-template-tr"'}}else{Y.add('<td data-title="'+S.label+'"').add(U).add(o).add(E).add(">");if(B){Y.add(B)}else{Y.add("<div>").add(typeof h==="undefined"?R:h).add("</div>")}Y.add("</td>");L.push(Y.toString())}}t.push("<tr"+v+">"+L.join("")+"</tr>");if(P){t=[];t.push(F.createNoDataTr(true)||"")}else{t.push(F.createChildTr(null,D))}}f.$tbody.html(t.join(""));if(O){f.initEvents();if(e.editMode){f.edit()}if(!s.length){F.createNoDataTr()}f.$boxP&&f.$boxP.trigger("bjui.datagrid.paging.jump");d.each(m,function(j,l){if(l.lock_refresh){f.colLock(l.th,true);delete l.lock_refresh}});setTimeout(function(){f.$tableB.initui();f.$lockTableB&&f.$lockTableB.initui();f.fixedHeight();if(f.needfixedWidth){f.fixedWidth();f.needfixedWidth=null}f.$boxM&&f.$boxM.trigger("bjui.ajaxStop").hide();if(f.doInitFilter){f.tools.initFilter();f.doInitFilter=undefined}},s.length+1)}},coverTemplate:function(){var l=this,k=f.options,i=f.data,j=f.columnModel,h;if(f.isTemplate){h=f.$grid.data("bjui.datagrid.trs.template");if(!h){l.createTrs(i,true)}else{f.$tbody.html(h);f.initEvents();if(k.editMode){f.edit()}if(!i.length){l.createNoDataTr()}f.$boxP&&f.$boxP.trigger("bjui.datagrid.paging.jump");d.each(j,function(m,o){if(o.lock_refresh){f.colLock(o.th,true);delete o.lock_refresh}});setTimeout(function(){f.$tableB.initui();f.$lockTableB&&f.$lockTableB.initui();f.fixedHeight();f.$boxM&&f.$boxM.trigger("bjui.ajaxStop").hide();if(f.doInitFilter){f.tools.initFilter();f.doInitFilter=undefined}},i.length+1)}}else{h=f.$grid.data("bjui.datagrid.trs.normal");if(!h){this.createTrs(i,true)}else{f.$tbody.html(h);f.initEvents();if(k.editMode){f.edit()}if(!i.length){l.createNoDataTr()}f.$boxP&&f.$boxP.trigger("bjui.datagrid.paging.jump");d.each(j,function(m,o){if(o.lock_refresh){f.colLock(o.th,true);delete o.lock_refresh}});setTimeout(function(){f.$tableB.initui();f.$lockTableB&&f.$lockTableB.initui();f.fixedHeight();f.$boxM&&f.$boxM.trigger("bjui.ajaxStop").hide();if(f.doInitFilter){f.tools.initFilter();f.doInitFilter=undefined}},i.length+1)}}setTimeout(function(){f.initFixedW=false;f.hasAutoCol=true;f.fixedWidth(true)},300)},replacePlh:function(h,i){return h.replace(/{\/?[^}]*}/g,function(j){var k=j.replace(/[{}]+/g,""),l=i[k];if(typeof l==="undefined"||l==="null"||l===null){l=""}return l})},replacePlh4Template:function(i,j,h){return i.replace(/{#\/?[^}]*}/g,function(k){var l=k.replace(/[{#}]+/g,""),m=j[l];if(h&&typeof m==="undefined"){return k}if(typeof m==="undefined"||m==="null"||m===null){m=""}return m})},createNoDataTr:function(h){if(f.options.showNoDataTip){if(h){return'<tr class="datagrid-nodata"><td colspan="'+f.columnModel.length+'">'+(typeof f.options.showNoDataTip==="string"?f.options.showNoDataTip:BJUI.getRegional("datagrid.noData"))+"</td></tr>"}else{if(!f.$tbody.find("> tr").length){d('<tr class="datagrid-nodata"></tr>').html('<td colspan="'+f.columnModel.length+'">'+(typeof f.options.showNoDataTip==="string"?f.options.showNoDataTip:BJUI.getRegional("datagrid.noData"))+"</td>").appendTo(f.$tbody)}}}},createTreePlaceholder:function(l,j,i){var k=f.options.treeOptions.keys,m=BJUI.StrBuilder();var h=function(o){var n=[];while(o--){n.push('<span class="datagrid-tree-indent"></span>')}return n.join("")};m.add('<div class="datagrid-tree-box">');if(l[k.level]){m.add(h(l[k.level]))}m.add('<span class="datagrid-tree-switch'+(typeof i!=="undefined"&&!i?" collapsed":"")+'">');if(l[k.isParent]){if(typeof i==="undefined"){if(typeof l[k.isExpand]==="undefined"){l[k.isExpand]=true}if(!l[k.isExpand]){if(!f.collapseIndex){f.collapseIndex=[]}f.collapseIndex.push(l.gridIndex)}m.add('<i class="fa fa-minus-square-o"></i>')}else{m.add('<i class="fa fa-'+(i?"minus":"plus")+'-square-o"></i>')}}m.add("</span>").add('<span class="datagrid-tree-'+(l[k.isParent]?"branch":"leaf")+'"><i class="fa fa-'+(l[k.isParent]?"folder":"file")+'-o"></i></span>').add('<span class="datagrid-tree-title">').add(j).add("</span>").add("</div>");return m.toString()},createChildTr:function(i,h){if(i&&i.next()&&i.next().hasClass(f.classnames.tr_child)){return}if(e.hasChild&&e.childOptions&&e.childOptions.dataUrl){f.childOptions=d.extend(true,{},c.DEFAULTS,e.childOptions);var j='<tr class="'+f.classnames.tr_child+'"><td colspan="'+f.columnModel.length+'" style="width:100%; padding:10px;"><table class="table-child"></table></td></tr>';if(i&&i.length){i.after(j)
    }else{return j}}return""},getNoChildTrIndex:function(i){var h;if(isNaN(i)){if(!i||!i.length){return -1}h=i.index()}else{h=parseInt(i,10)}if(f.options.hasChild&&f.options.childOptions){h=h*2}return h},getNoChildDataIndex:function(i){var h;if(isNaN(i)){h=this.getNoChildTrIndex(i)}else{h=parseInt(i,10)}if(h===-1){return h}if(f.options.hasChild&&f.options.childOptions){h=h/2}return h},loadData:function(l,h){var m=this,k=e.dataUrl,i=e.dataType||"json",j=f.columnModel;f.$boxM&&f.$boxM.show().trigger("bjui.ajaxStart");i=i.toLowerCase();if(i==="array"){i="text"}if(e.postData){if(typeof e.postData==="string"){if(e.postData.trim().startsWith("{")){e.postData=e.postData.toObj()}else{e.postData=e.postData.toFunc()}}if(typeof e.postData==="function"){e.postData=e.postData.apply()}if(typeof e.postData==="object"){if(!l){l=e.postData}else{l=d.extend({},e.postData,l)}}}l=l||{};if(!l.pageSize&&e.paging){l.pageSize=f.paging.pageSize;l.pageCurrent=f.paging.pageCurrent}if(!e.paging){delete l.pageSize;delete l.pageCurrent}BJUI.ajax("doajax",{url:k,data:l,type:e.loadType,cache:e.cache||false,dataType:i,okCallback:function(n){if(i==="json"||i==="jsonp"){m.createTrsByData(n,h)}else{if(i==="text"){if(d.type(n)!=="array"){n=[]}m.createTrsByData(n,h)}else{if(i==="xml"){var o=[],p;d(n).find("row").each(function(){p={};d(this).find("cell").each(function(s){var t=d(this),r=t.text(),q=t.attr("name");p[q]=r});o.push(p)});if(o.length){m.createTrsByData(o,h)}}else{BJUI.debug("BJUI.Datagrid: The options 'dataType' is incorrect!")}}}},errCallback:function(n){if(n&&n[BJUI.keys.statusCode]){BJUI.alertmsg("error",n[BJUI.keys.message]||BJUI.getRegional("datagrid.errorData"))}else{BJUI.alertmsg("warn",BJUI.getRegional("datagrid.errorData"))}m.createTrsByData([],h)},failCallback:function(n){BJUI.alertmsg("warn",BJUI.getRegional("datagrid.failData"));m.createTrsByData([],h)}})},appendColumns:function(){f.childColumn={name:f.options.keys.gridChild,gridChild:true,width:30,minWidth:30,label:"...",align:"center",menu:false,edit:false,quicksort:false};f.linenumberColumn={name:f.options.keys.gridNumber,gridNumber:true,width:"auto",minWidth:80,label:"No.",align:"center",menu:false,edit:false,quicksort:false};f.checkboxColumn={name:f.options.keys.gridCheckbox,gridCheckbox:true,width:30,minWidth:30,label:"Checkbox",align:"center",menu:false,edit:false,quicksort:false};f.editBtnsColumn={name:f.options.keys.gridEdit,gridEdit:true,width:f.options.customEditbtns.width,minWidth:110,label:(typeof e.showEditbtnscol==="string"?e.showEditbtnscol:"Edit"),align:"center",menu:false,edit:false,hide:false,quicksort:false}},setBoxbH:function(i){var j=i||f.boxH||e.height,m=0,n,l,k;if(j<100){return}if(isNaN(j)){if(j==="auto"){l=f.$boxB.clone().height("").prependTo("body").find("> colgroup").remove().end();k=l.outerHeight();l.remove();j=(f.$boxT?f.$boxT.outerHeight():0)+(f.$boxH?f.$boxH.outerHeight():0)+(f.$toolbar?f.$toolbar.outerHeight():0)+(f.$boxP?f.$boxP.outerHeight():0)+k+(f.$boxF?f.$boxF.outerHeight():0);if(e.maxHeight&&Number(e.maxHeight)<j){j=Number(e.maxHeight)}f.$grid.height(j);f.boxH=j}else{j=f.$grid.height()}}if(f.$boxT){n=f.$boxT.outerHeight();j-=n;m+=n}if(f.$toolbar){n=f.$toolbar.outerHeight();j-=n;m+=n}if(f.$boxP){j-=f.$boxP.outerHeight()}if(f.$boxF){j-=f.$boxF.outerHeight()}m+=f.$tableH.outerHeight();j-=f.$boxH.outerHeight();if(j<0){j=0}f.$boxB.height(j);f.$boxM.height(j).css({top:m});f.$lockB&&f.$lockB.height(j);if(f.$element.data("bjui.datagrid.parent")){f.$element.data("bjui.datagrid.parent").closest("table").datagrid("fixedHeight")}},showSubMenu:function(s,i,r){var m,l=i.outerWidth(),o=r.data("width")||r.outerWidth(),k=f.$grid.height(),j,q=r.data("height"),n,p=f.$boxH.width();var h=function(v,u,t){m=u.offset().left-f.$grid.offset().left-1;n={left:"50%"};v.removeClass("active");if(u.hasClass("position-right")||(p-m<l+o)){t.css({left:"auto",right:"100%"});n={right:"50%"}}else{t.css({left:"100%",right:"auto"})}n.opacity=0.2;t.stop().animate(n,"fast",function(){d(this).hide()})};s.hover(function(){r.appendTo(s);if(s.hasClass(f.classnames.li_filter)&&r.is(":visible")){return false}else{var t=s.siblings("."+f.classnames.li_filter);if(t.length&&t.hasClass("active")){h(t,i,t.find("> ."+f.classnames.s_filter))}}if(s.hasClass(f.classnames.li_showhide)){j=s.position().top+i.position().top;if((k-j)<q){if(q>k){q=k;r.css("height",k)}r.css({top:(-(q-(k-j)))})}}m=i.offset().left-f.$grid.offset().left-1;n={left:"100%"};if(i.hasClass("position-right")||(p-m<l+o)){r.css({left:"auto",right:"50%"});n={right:"100%"}}else{r.css({left:"50%",right:"auto"})}n.opacity=1;s.addClass("active");r.show().stop().animate(n,"fast")},function(){if(s.hasClass(f.classnames.li_filter)){return false}h(s,i,r)});s.on("hidesubmenu.bjui.datagrid.th",function(u,v,t){h(d(this),v,t)})},locking:function(o){var m=o.data("index"),l=f.columnModel[m],n=l.lock,k=l.locked,h=f.$menu,j=h.find("> ul"),i=j.find("> li."+f.classnames.li_lock),p=i.next();if(k){i.addClass("disable");p.removeClass("disable")}else{p.addClass("disable");
        i.removeClass("disable")}if(n){i.show().off("click").on("click",function(){if(i.hasClass("disable")){return}h.hide().data("bjui.datagrid.menu.btn").removeClass("active");f.colLock(o,true)});p.show().off("click").on("click",function(){if(p.hasClass("disable")){return}h.hide().data("bjui.datagrid.menu.btn").removeClass("active");f.colLock(o,false)})}else{i.hide().off("click");p.hide().off("click")}},createShowhide:function(){var i,h=f.options.keys;if(!f.$showhide){f.col_showhide_count=f.columnModel.length;i=d('<ul class="'+f.classnames.s_showhide+'" role="menu"></ul>');d.each(f.columnModel,function(j,m){if(f.tools.isGridModel(m)){f.col_showhide_count--}var k=d(FRAG.gridShowhide.replaceAll("#index#",m.index).replaceAll("#label#",(m.label||""))).attr("title",(m.label||"")).toggleClass("nodisable",!!(f.tools.isGridModel(m)));var l=function(o){k.click(function(){if(d(this).hasClass("disable")){return false}var q=d(this),n=!q.find("i").hasClass("fa-check-square-o"),p=o.index;q.toggleClass("datagrid-col-check").find("i").attr("class","fa fa"+(n?"-check":"")+"-square-o");f.showhideColumn(o.th,n);if(!(f.tools.isGridModel(o))){f.col_showhide_count=n?f.col_showhide_count+1:f.col_showhide_count-1}if(f.col_showhide_count==1){i.find("> li.datagrid-col-check").addClass("disable")}else{i.find("> li.disable").removeClass("disable")}i.find("> li.nodisable").removeClass("disable")})};l(m);k.appendTo(i);if(m.hide){k.trigger("click")}});i.appendTo(f.$grid);i.data("width",i.outerWidth()).data("height",i.outerHeight());f.$showhide=i}},showhide:function(k,j){var o=f.options.keys,l=k.index,p=k.th,h=f.$tbody.find("> tr"),m=j?"":"none";var n=function(q){var r=q.colspan;if(j){r++}else{r--}if(!r){q.th.css("display","none")}else{q.th.css("display","")}q.th.attr("colspan",r);q.colspan=r;if(q.parent){n(q.parent)}};if(typeof k.hidden==="undefined"){k.hidden=false}if(k.hidden===!j){return}k.hidden=!j;p.css("display",m);if(f.options.tdTemplate&&!this.isGridModel(k)){var i=h.eq(0).find("> td.datagrid-template-td").attr("colspan");if(i){h.find("> td.datagrid-template-td").attr("colspan",parseInt(i,10)+(k.hidden?-1:1))}}else{h.find("> td:eq("+l+")").css("display",m)}f.$colgroupH.find("> col").eq(l).css("display",m);f.$colgroupB.find("> col").eq(l).css("display",m);f.$thead.find("> tr.datagrid-filter > th:eq("+l+")").css("display",m);if(f.$boxF){f.$tableF.find("> thead > tr > th:eq("+l+")").css("display",m);f.$colgroupF.find("> col").eq(l).css("display",m)}if(k.calc){f.$tfoot&&f.$tfoot.trigger("resizeH.bjui.datagrid.tfoot")}if(k.parent){n(k.parent)}f.$tbody.find("> tr."+f.classnames.tr_child+":visible > td table").trigger("bjui.datagrid.child.resize")},isGridModel:function(h){var i=f.options.keys;if(!h||typeof h!=="object"){return false}return(h[i.gridChild]||h[i.gridNumber]||h[i.gridCheckbox]||h[i.gridEdit])},isGridData:function(i){var k=f.options.keys,h=false;for(var j in k){if(k[j]===i){h=true;break}}return h},jumpPage:function(k,h){var j=f.allData,i;if(k){f.paging.oldPageCurrent=f.paging.pageCurrent;f.paging.pageCurrent=k}if(h){f.paging.oldPageSize=f.paging.pageSize;f.paging.pageSize=h;f.paging.pageCount=this.getPageCount(h,f.paging.total);if(f.paging.pageCurrent>f.paging.pageCount){f.paging.pageCurrent=f.paging.pageCount}}if(e.local==="remote"){i=this.getRemoteFilterData(true);this.loadData(i,true)}else{this.initTbody(j,true)}},quickSort:function(m){if(f.isDom){if(e.local==="local"){return}e.sortAll=true}if(!f.sortData){f.sortData={}}if(f.$tbody.find("> tr."+f.classnames.tr_edit).length){f.$tbody.alertmsg("info",BJUI.getRegional("datagrid.editMsg"));return}var r=m.th,l=f.data,i=f.allData,j,p,h=m.name,o=m.type,n=f.$thead.find("> tr > th.datagrid-quicksort-th");if(!h){h="datagrid-noname"}var q=function(){var s=[];d.each(f.sortData,function(u,t){s.push(u+" "+t.direction)});return s};var k=function(u,t){var s=function(w,v){var y=0;function x(){var A=t[y].split(" "),z=A[0],B=A[1],D=(typeof w[z]),C=(typeof v[z]);if(w[z]==v[z]&&y<t.length-1){y++;return x()}if((D=C==="number")||(D=C==="boolean")){return B==="asc"?(w[z]-v[z]):(v[z]-w[z])}else{return B==="asc"?String(w[z]).localeCompare(v[z]):String(v[z]).localeCompare(w[z])}}if(!t||!t.length){return(w["bjui_local_index"]-v["bjui_local_index"])}return x()};u.sort(s)};if(e.fieldSortable){r.find("> div > .datagrid-label > i").remove()}else{f.$thead.find("> tr:not(.datagrid-filter) > th > div > .datagrid-label > i").remove()}if(m.sortDesc){m.sortDesc=false}else{if(m.sortAsc){p="desc";m.sortAsc=false;m.sortDesc=true}else{p="asc";m.sortAsc=true}r.find("> div > .datagrid-label").prepend('<i class="datagrid-sort-i fa fa-long-arrow-'+(m.sortAsc?"up":"down")+'"></i>')}if(p){if(f.sortData[h]){f.sortData[h]["direction"]=p}else{f.sortData[h]={index:(Object.keys(f.sortData)).length,direction:p}}}else{delete f.sortData[h]}if(e.sortAll){if(e.local==="remote"){j=f.$element.data("filterDatas")||{};j[BJUI.pageInfo.pageSize]=f.paging.pageSize;j[BJUI.pageInfo.pageCurrent]=f.paging.pageCurrent;if(p){j[BJUI.pageInfo.orderField]=h;
        j[BJUI.pageInfo.orderDirection]=p}else{j[BJUI.pageInfo.orderField]="";j[BJUI.pageInfo.orderDirection]=""}j["orders"]=q().join(",");f.orders={orders:j["orders"]};this.loadData(f.tools.getRemoteFilterData(true),true)}else{k(i,q());this.initTbody(i,true)}}else{k(l,q());this.createTrs(l,true)}},showFilterMsg:function(j){var h=f.$boxH.find(".datagrid-thead-dialog-filter-msg"),k=h.find("> .msg-filter"),i=BJUI.StrBuilder();k.html("");if(!j.length){return}d.each(j,function(m,p){if(!p){return true}var l=p.label,o=p.data.valA;if(p.model.type==="select"||p.model.type==="boolean"){o=p.model.render.call(f,o,{},p.model.items,p.model.itemattr)}i.add("；").add(p.model.label+":"+o)});i=i.toString();i.length>1&&(i=i.substr(1));k.html(i)},quickFilter:function(m,k){if(f.isDom){if(e.local!="remote"){BJUI.debug("BJUI.Datagrid: Please change the local option is remote!");return}if(!e.dataUrl){BJUI.debug("BJUI.Datagrid: Not Set the dataUrl option!");return}}var n=this,s=m.th,l=f.data,i=f.allData,h=m.name,j,o,p=[];var r=function(t,x,v,u){var w=false;switch(t){case"=":w=String(x)===String(v);break;case"!=":w=String(x)!==String(v);break;case">":w=parseFloat(v)>parseFloat(x);break;case"<":w=parseFloat(v)<parseFloat(x);break;case"like":if(u&&u.type==="select"){w=String(x)===String(v);if(u.attrs&&u.attrs.multiple){if(d.isArray(x)&&String(v)){d.each(String(v).split(","),function(y,z){w=d.inArray(z,x)!=-1;if(w){return false}})}}}else{w=String(v).indexOf(String(x))>=0}break;default:break}return w};var q=function(v,t){var u=function(x){var w=0;d.each(t,function(z,y){var A=y.datas;w++;if(!A){w--;y.model.isFiltered=false;y.model.th.trigger("filter.bjui.datagrid.th",[false]);if(y.model.$quickfilter){y.model.$quickfilter.trigger("clearfilter.bjui.datagrid.thead")}return true}y.model.isFiltered=true;y.model.th.trigger("filter.bjui.datagrid.th",[true]);if(!p[y.model.index]){p[y.model.index]={model:y.model,data:y.datas}}if(A.andor){if(A.andor==="and"){if(r(A.operatorA,A.valA,x[z],y.model)&&r(A.operatorB,A.valB,x[z],y.model)){w--}}else{if(A.andor==="or"){if(r(A.operatorA,A.valA,x[z],y.model)||r(A.operatorB,A.valB,x[z],y.model)){w--}}}}else{if(A.operatorB){if(r(A.operatorB,A.valB,x[z],y.model)){w--}}else{if(r(A.operatorA,A.valA,x[z],y.model)){w--}}}});return !w?true:false};return d.grep(v,function(x,w){return u(x)})};if(!f.filterDatas){f.filterDatas={}}if(e.filterMult){f.filterDatas[h]={datas:k,model:m}}else{f.filterDatas={};f.filterDatas[h]={datas:k,model:m}}if(e.local!=="remote"&&i){if(!f.oldAllData){f.oldAllData=i.concat()}else{i=f.oldAllData.concat()}}if(e.filterAll){if(e.local==="remote"){n.loadData(n.getRemoteFilterData(false,p),true)}else{o=q(i,f.filterDatas);f.tools.showFilterMsg(p);f.paging.pageCurrent=1;f.paging.pageCount=this.getPageCount(f.paging.pageSize,o.length);this.initTbody(o,true)}}else{if(f.isDom){n.loadData(n.getRemoteFilterData(false,p),true)}else{if(!f.oldData){f.oldData=l.concat()}else{l=f.oldData.concat()}o=q(l,f.filterDatas);f.tools.showFilterMsg(p);this.createTrs(o,true)}}},getRemoteFilterData:function(k,j){var i={};if(f.filterDatas&&!d.isEmptyObject(f.filterDatas)){d.each(f.filterDatas,function(m,l){if(!l.datas){l.model.isFiltered=false;l.model.th.trigger("filter.bjui.datagrid.th",[false]);if(l.model.$quickfilter){l.model.$quickfilter.trigger("clearfilter.bjui.datagrid.thead")}j&&j[l.model.index]&&(j[l.model.index]=false);return true}l.model.isFiltered=true;l.model.th.trigger("filter.bjui.datagrid.th",[true]);if(e.jsonPrefix){m=e.jsonPrefix+"."+m}if(l.datas.andor){i["andor"]=l.datas.andor}if(l.datas.operatorA){i[m]=l.datas.valA;i[m+".operator"]=l.datas.operatorA}if(l.datas.operatorB){if(i[m]){i[m]=[i[m],l.datas.valB];i[m+".operator"]=[i[m+".operator"],l.datas.operatorB]}else{i[m]=l.datas.valB;i[m+".operator"]=l.datas.operatorB}}});if(!k){f.paging.pageCurrent=1}}if(f.initFilter){var h=e.jsonPrefix?e.jsonPrefix+".":"";d.each(f.initFilter,function(m,l){if(!f.filterDatas||typeof f.filterDatas[m]==="undefined"){i[h+m]=l.value}})}i[BJUI.pageInfo.pageSize]=f.paging.pageSize;i[BJUI.pageInfo.pageCurrent]=f.paging.pageCurrent||1;d.extend(i,f.orders||{});f.$element.data("filterDatas",i);return i},setDomData:function(l){var j=f.columnModel,k={},i=l.attr("data-hidden-datas"),h=f.attach;l.find("> td").each(function(n){var p=d(this),m=j[n],o=p.attr("data-val")||p.text();if(!m.name){k["datagrid-noname"+n]=o}else{k[m.name]=o}});if(i){i=i.toObj()}h[f.options.keys.gridNumber]=(l.index()+1);d.extend(k,h,i);l.data("initData",k);return k},updateLinenumber:function(){if(d.inArray(f.linenumberColumn,f.columnModel)==-1){return}var h=false;if(f.linenumberColumn.locked){f.colLock(f.linenumberColumn.th,false);h=true}f.$tbody.find("> tr:not(."+f.classnames.tr_child+")").each(function(j){var k=d(this);k.find("> td."+f.classnames.td_linenumber).text(j+1)});if(h){f.colLock(f.linenumberColumn.th,true)}},updateGridIndex:function(){var h=f.paging,i=f.options,j=(h.pageCurrent-1)*h.pageSize;d.each(f.data,function(l,m){var k=i.linenumberAll?(j+(l+1)):(l+1);m[i.keys.gridNumber]=k;
        m[i.keys.gridIndex]=l})},initFilter:function(k,h){var i=f.initFilter;var j=function(n,l){n.val(String(f.options.initFilter[l.name]));if(f.$headFilterUl){var m=f.$headFilterUl.find("> li.li-"+l.index+"> "+n[0].tagName);if(m.length){m.val(n.val());if(m.isTag("select")){m.selectpicker("refresh")}}}if(f.options.local==="remote"){l.isFiltered=true;l.th.trigger("filter.bjui.datagrid.th",[true])}else{f.tools.quickFilter(l,{operatorA:"like",valA:f.options.initFilter[l.name]})}};if(!k&&!h){if(i){d.each(i,function(l,m){j(m.input,m.model)})}return}if(!i){i={}}if(!h){return}j(k,h);if(!i[h.name]){i[h.name]={};i[h.name].input=k;i[h.name].model=h;i[h.name].value=f.options.initFilter[h.name]}f.initFilter=i},initEditInputs:function(){var h=f.columnModel;f.inputs=[];d.each(h,function(m,p){var k=p.name,o="",n="",l=[],j="";if(!p){return}if(p.attrs&&typeof p.attrs==="object"){d.each(p.attrs,function(q,r){if(typeof r==="object"){r=JSON.stringify(r).replaceAll('"',"'")}j+=" "+q+"="+r})}if(p===f.childColumn||p===f.linenumberColumn||p===f.checkboxColumn||p===f.editBtnsColumn){f.inputs.push("")}else{if(k){if(p.rule){o=' data-rule="'+p.label+"："+p.rule+'"'}else{if(p.type==="date"){o=' data-rule="pattern('+(p.pattern||"yyyy-MM-dd")+')"'}}if(p.type){switch(p.type){case"date":if(!p.pattern){p.pattern="yyyy-MM-dd"}n=' data-pattern="'+p.pattern+'"';f.inputs.push('<input type="text" name="'+k+'" data-toggle="datepicker"'+n+o+j+">");break;case"select":if(!p.items){return}d.each(p.items,function(q,r){if(p.itemattr){l.push('<option value="'+r[p.itemattr.value]+'">'+r[p.itemattr.label]+"</option>")}else{d.each(r,function(i,s){l.push('<option value="'+i+'">'+s+"</option>")})}});f.inputs.push('<select name="'+k+'" data-toggle="selectpicker"'+o+j+' data-width="100%">'+l.join("")+"</select>");break;case"boolean":f.inputs.push('<input type="checkbox" name="'+k+'" data-toggle="icheck"'+o+j+' value="true">');break;case"findgrid":f.inputs.push('<input type="text" name="'+k+'" data-toggle="findgrid" data-custom-event="true"'+o+j+">");break;case"tags":f.inputs.push('<input type="text" name="'+k+'" data-toggle="tags"'+j+">");break;case"spinner":f.inputs.push('<input type="text" name="'+k+'" data-toggle="spinner"'+o+j+">");break;case"textarea":f.inputs.push('<textarea data-toggle="autoheight" rows="1"'+o+j+"></textarea>");break;default:f.inputs.push('<input type="text" name="'+k+'"'+o+j+">");break}}else{f.inputs.push('<input type="text" name="'+k+'"'+o+j+">")}}else{f.inputs.push("")}}});return f.inputs},contextmenuH:function(){var h=this;f.$tableH.on("contextmenu","tr:not(.datagrid-filter)",function(k){if(!f.$showhide){h.createShowhide()}var m=k.pageX,l=k.pageY,i=d(window).height(),j=f.$showhide.data("height");if(d(window).width()<m+f.$showhide.width()){m-=f.$showhide.width()}if(l<0||(l+j)>i){l=0}if(j>i){f.$showhide.css({height:i})}else{f.$showhide.css({height:""})}if(f.$menu){f.$grid.trigger("click.bjui.datagrid.filter")}f.$showhide.appendTo("body").css({left:m,top:l,opacity:1,"z-index":9999}).show();d(document).on("click",function(n){var o=d(n.target).closest("."+f.classnames.s_showhide);if(!o.length){f.$showhide.css({left:"50%",top:0,opacity:0.2,"z-index":""}).hide().appendTo(f.$grid)}});k.preventDefault();k.stopPropagation()})},contextmenuB:function(i,h){i.contextmenu("show",{exclude:"input, .bootstrap-select",items:[{icon:"refresh",title:BJUI.getRegional("datagrid.refresh"),func:function(j,k){f.refresh()}},{title:"diver"},{icon:"plus",title:BJUI.getRegional("datagrid.add"),func:function(j,k){f.add()}},{icon:"edit",title:BJUI.getRegional("datagrid.edit"),func:function(j,l){var k=j;if(h){k=f.$tbody.find("> tr:eq("+k.index()+")")}f.doEditRow(k)}},{icon:"undo",title:BJUI.getRegional("datagrid.cancel"),func:function(j,l){var k=j;if(h){k=f.$tbody.find("> tr:eq("+k.index()+")")}if(!k.hasClass(f.classnames.tr_edit)){k=f.$tbody.find("> tr."+f.classnames.tr_edit)}f.doCancelEditRow(k)}},{icon:"remove",title:BJUI.getRegional("datagrid.del"),func:function(j,l){var k=j;if(h){k=f.$tbody.find("> tr:eq("+k.index()+")")}f.delRows(k)}}]})}};return g};c.prototype.init=function(){if(!this.$element.isTag("table")){return}if(this.$element.data("bjui.datagrid.init")){return}this.$element.data("bjui.datagrid.init",true);var h=this,f=h.options,g=f.keys,j=h.tools,i=h.$element.parent(),e=BJUI.StrBuilder();f.tableWidth=f.tableWidth||"";f.width=f.width||"100%";f.height=f.height||"auto";h.isDom=false;h.columnModel=[];h.inputs=[];h.regional=BJUI.regional.datagrid;e.add('<div class="bjui-datagrid">').add(f.gridTitle?'<div class="datagrid-title">'+f.gridTitle+"</div>":"").add(f.showToolbar?'<div class="datagrid-toolbar"></div>':"").add('<div class="datagrid-box-h"><div class="datagrid-wrap-h"><table class="table table-bordered"><colgroup></colgroup></table></div></div>').add('<div class="datagrid-box-b"><div class="datagrid-wrap-b"></div></div>').add('<div class="datagrid-box-m"></div>').add(f.paging?'<div class="datagrid-paging-box bjui-paging-box"></div>':"").add("</div>");h.$grid=d(e.toString()).insertAfter(h.$element).css("height",f.height);
        h.$boxH=h.$grid.find("> div.datagrid-box-h");h.$boxB=h.$boxH.next();h.$boxM=h.$boxB.next().css("height",f.height);h.$boxP=f.paging?h.$boxM.next():null;h.$boxT=f.gridTitle?h.$grid.find("> div.datagrid-title"):null;h.$toolbar=f.showToolbar?h.$boxH.prev():null;h.$tableH=h.$boxH.find("> div > table");h.$tableB=h.$element;h.isTemplate=(f.tdTemplate&&f.templateWidth)&&f.templateWidth>h.$grid.width()||(f.tdTemplate&&!f.templateWidth);h.$grid.data("bjui.datagrid.table",h.$element.clone());h.$boxB.find("> div").append(h.$element);h.initTop();if(typeof f.paging==="string"){f.paging=f.paging.toObj()}h.paging=d.extend({},{pageSize:30,selectPageSize:"30,60,90",pageCurrent:1,total:0,showPagenum:5},(typeof f.paging==="object")&&f.paging);h.$thead=h.$element.find("> thead");h.$tbody=h.$element.find("> tbody");h.attach={};h.attach[g.gridNumber]=0;h.attach[g.gridCheckbox]="#checkbox#";h.attach[g.gridEdit]="#edit#";if(h.$tbody&&h.$tbody.find("> tr").length){h.isDom=true;h.setColumnModel();h.$tbody.find("> tr > td").each(function(){var l=d(this),k=l.html();l.html("<div>"+k+"</div>")});if(!h.paging.total){h.paging.total=h.$tbody.find("> tr").length;h.paging.pageCount=1}else{h.paging.pageCount=j.getPageCount(h.paging.pageSize,h.paging.total)}h.paging.pageCurrent=1;h.initThead()}else{h.$tbody=null;h.$element.find("> tbody").remove();if(f.columns){if(typeof f.columns==="string"){if(f.columns.trim().startsWith("[")){f.columns=f.columns.toObj()}else{f.columns=f.columns.toFunc()}}if(typeof f.columns==="function"){f.columns=f.columns.call()}h.$thead=null;h.$element.find("> thead").remove();h.createThead()}else{if(h.$thead&&h.$thead.length&&h.$thead.find("> tr").length){h.setColumnModel()}else{BJUI.debug("BJUI.Datagrid: No set options 'columns' !");h.destroy();return}}if(f.data||f.dataUrl){h.createTbody()}else{BJUI.debug("BJUI.Datagrid: No options 'data' or 'dataUrl'!");h.destroy()}}};c.prototype.setColumnModel=function(){var j=this,g=j.options,f=j.$thead.find("> tr"),k=[],e=[],l=f.length;if(!j.isDom){j.tools.appendColumns();var i,h=l>1?' rowspan="'+l+'"':"";if(g.showCheckboxcol){j.columnModel.push(j.checkboxColumn);if(g.showCheckboxcol==="lock"){j.checkboxColumn.initLock=true}i=d('<th class="'+j.classnames.td_checkbox+'"'+h+'><input type="checkbox" data-toggle="icheck"></th>');i.prependTo(f.first());if(h){i.data("datagrid.column",j.checkboxColumn)}}if(g.showLinenumber){j.columnModel.unshift(j.linenumberColumn);if(g.showLinenumber==="lock"){j.linenumberColumn.initLock=true}i=d('<th class="'+j.classnames.td_linenumber+'"'+h+">No.</th>");i.prependTo(f.first());if(h){i.data("datagrid.column",j.linenumberColumn)}}if(g.showChildcol||(g.showChildcol===undefined&&g.hasChild&&g.childOptions)){j.columnModel.unshift(j.childColumn);i=d('<th class="'+j.classnames.td_child+'"'+h+">...</th>");i.prependTo(f.first());if(h){i.data("datagrid.column",j.childColumn)}}if(g.showEditbtnscol){i=d("<th"+h+">"+j.editBtnsColumn.label+"</th>");i.appendTo(f.first());if(h){i.data("datagrid.column",j.editBtnsColumn)}j.columnModel[i.index()]=j.editBtnsColumn}}if(f.length&&l==1){f.find("> th").each(function(o){var p=d(this).addClass("single-row").data("index",o),q=p.data("options"),m=p.attr("width")||"auto",n=p.html();if(j.columnModel.length&&j.columnModel[o]){q=j.columnModel[o];q.index=o}else{if(q&&typeof q==="string"){q=q.toObj()}if(typeof q!=="object"){q={}}q.index=o;q.label=n;q.width=(typeof q.width==="undefined")?m:q.width;q=j.tools.setOp(q);j.columnModel[o]=q}j.columnModel[o].th=p;p.html('<div><div class="datagrid-space"></div><div class="datagrid-label">'+n+'</div><div class="'+j.classnames.th_cell+'"><div class="'+j.classnames.th_resizemark+'"></div></div></div>');if(q.menu&&g.columnMenu){p.addClass(j.classnames.th_menu)}if(g.fieldSortable&&q.quicksort){p.addClass("datagrid-quicksort-th")}if(q.align){p.attr("align",q.align)}})}else{f.each(function(n){var q=[],m=[],o=-1,p=0;if(k.length){q=k.concat();m=e.concat()}k=[];e=[];d(this).find("> th").each(function(u){var z=d(this),v=z.data("options")||z.data("datagrid.column")||{},r=parseInt((z.attr("colspan")||0),10),t=parseInt((z.attr("rowspan")||0),10),w=z.attr("width")||"auto",y=z.html();if(v&&typeof v==="string"){v=v.toObj()}if(typeof v!=="object"){v={}}if(BJUI.isIE(8)&&r===1){r=0}v.label=y;v.th=z;if(v[g.keys.gridCheckbox]){v.label="Checkbox"}o++;if(r){v.colspan=r;for(var x=(q.length?q[o]:o),s=x;s<(x+r);s++){k[p++]=s;e[p-1]=v}o+=(r-1);z.data("index",o);if(q.length){v.parent=m[o]}}if(!t||t==1){z.addClass("single-row")}if(!r){v.width=(typeof v.width==="undefined")?w:v.width;v=j.tools.setOp(v);z.html('<div><div class="datagrid-space"></div><div class="datagrid-label">'+y+'</div><div class="'+j.classnames.th_cell+'"><div class="'+j.classnames.th_resizemark+'"></div></div></div>');if(v.menu&&g.columnMenu){z.addClass(j.classnames.th_menu)}if(g.fieldSortable&&v.quicksort){z.addClass("datagrid-quicksort-th")}if(v.align){z.attr("align",v.align)}if(!q.length){v.index=o;j.columnModel[o]=v}else{v.index=q[o];v.parent=m[o];j.columnModel[q[o]]=v
    }z.data("index",v.index)}else{z.html('<div><div class="datagrid-space"></div><div class="datagrid-label">'+y+'</div><div class="'+j.classnames.th_cell+'"><div class="'+j.classnames.th_resizemark+'"></div></div></div>')}})})}};c.prototype.createThead=function(){var k=this,r=k.options,p=r.keys,i=r.columns.concat(),n=[],q=[],o,l,e,h,j,g,f,m=function(t,v,s,u){if(!v){v=[]}if(!s){s=0}if(!v[s]){v[s]=[]}d.each(t,function(x,z){var w=v[s].length,y;if(u){z.parent=u}if(z.columns){y=z.columns.length;if(s&&z.parent){k.tools.setColspan(z.parent,y)}z.index=k.columnModel.length+y-1;z.colspan=y;z.quicksort=false;v[s][w++]=z;return m(z.columns,v,s+1,z)}else{z.rowspan=s;z.index=k.columnModel.length;z=k.tools.setOp(z);v[s][w++]=z;k.columnModel.push(z)}});return v};k.tools.appendColumns();if(r.showCheckboxcol){i.unshift(k.checkboxColumn);if(r.showCheckboxcol==="lock"){k.checkboxColumn.initLock=true}}if(r.showLinenumber){i.unshift(k.linenumberColumn);if(r.showLinenumber==="lock"){k.linenumberColumn.initLock=true}}if(r.showChildcol||(r.showChildcol===undefined&&r.hasChild&&r.childOptions)){i.unshift(k.childColumn)}if(r.showEditbtnscol){i.push(k.editBtnsColumn)}n=m(i,n);k.columnModel[k.columnModel.length-(r.showEditbtnscol?2:1)].lock=false;if(r.hiddenFields){k.hiddenFields=r.hiddenFields}k.$thead=d("<thead></thead>");d.each(n,function(t,s){var w=d('<tr style="height:25px;"></tr>'),v='<th class="datagrid-number"></th>',u;d.each(s,function(x,y){o=y.label||y.name;l=y.align?(' align="'+y.align+'"'):"";e=y.width?(' width="'+y.width+'"'):"";h=y.colspan?' colspan="'+y.colspan+'"':"";j=(n.length-y.rowspan>1)?' rowspan="'+(n.length-y.rowspan)+'"':"";g='<div class="'+k.classnames.th_resizemark+'"></div>';f="";if(y[p.gridCheckbox]){o='<input type="checkbox" data-toggle="icheck">'}if(y.colspan){l=' align="center"'}if(y.thalign){l=' align="'+y.thalign+'"'}if(y.menu&&r.columnMenu){f=' class="'+k.classnames.th_menu+'"'}u=d("<th"+f+e+l+h+j+'><div><div class="datagrid-space"></div><div class="datagrid-label">'+o+'</div><div class="'+k.classnames.th_cell+'">'+g+"</div></div></th>");u.data("index",y.index).appendTo(w);if(!j){u.addClass("single-row")}if(y[p.gridChild]){u.addClass(k.classnames.td_child)}if(y[p.gridNumber]){u.addClass(k.classnames.td_linenumber)}if(y[p.gridCheckbox]){u.addClass(k.classnames.td_checkbox)}if(r.fieldSortable&&y.quicksort){u.addClass("datagrid-quicksort-th")}y.th=u});w.appendTo(k.$thead)});k.$thead.appendTo(k.$element).initui()};c.prototype.createTbody=function(){var g=this,f=g.options,h=f.data,e=g.columnModel,i=[];if(h){if(typeof h==="string"){if(h.trim().startsWith("[")||h.trim().startsWith("{")){h=h.toObj()}else{h=h.toFunc()}}if(typeof h==="function"){h=h.call()}f.data=h;g.tools.createTrsByData(h)}else{if(f.dataUrl){var h={};if(typeof f.initFilter==="object"&&f.initFilter&&f.jsonPrefix){d.each(f.initFilter,function(l,j){h[f.jsonPrefix+"."+l]=j})}g.$element.data("filterDatas",h);g.tools.loadData(h)}}};c.prototype.refresh=function(g){var k=this,h=k.options,l=k.tools,i=k.isDom,j=BJUI.pageInfo,f=k.paging,e={};if(!h.dataUrl){if(h.data&&h.data.length){l.initTbody(k.allData,true);return}BJUI.debug("BJUI.Datagrid: Not Set the dataUrl option!");return}if(!h.postData||!h.postData[j.pageSize]){e[j.pageSize]=f.pageSize;e[j.pageCurrent]=f.pageCurrent}if(h.initFilter&&typeof h.initFilter==="object"){if(typeof h.initFilter==="object"&&h.initFilter&&h.jsonPrefix){d.each(h.initFilter,function(n,m){e[h.jsonPrefix+"."+n]=m})}k.doInitFilter=true}if(g){d.extend(e,k.$element.data("filterDatas")||{})}l.loadData(e,true);if(!g){k.filterDatas=null;d.each(k.columnModel,function(m,o){o.th.trigger("filter.bjui.datagrid.th",[false]);o.isFiltered=false;if(o.$quickfilter){o.$quickfilter.trigger("clearfilter.bjui.datagrid.thead")}});k.orders={};k.$thead.find("> tr > th.datagrid-quicksort-th").find("> div > .datagrid-label > i").remove()}};c.prototype.refreshParent=function(e){var f=this,g=f.$element.data("bjui.datagrid.parent");if(g&&g.length){g.closest("table").datagrid("refresh",e)}};c.prototype.refreshChild=function(j,f){var i=this,e=i.$tbody.find("> tr"),g,h=function(k){g=k.data("bjui.datagrid.child");if(g&&g.length&&g.isTag("table")){g.datagrid("refresh",f)}};if(j instanceof jQuery){j.each(function(){h(d(this))})}else{if(isNaN(j)){d.each(j.split(","),function(k,l){if(l*2<e.length){h(e.eq(l*2))}})}else{if(j*2<e.length){h(e.eq(j*2))}}}};c.prototype.showChild=function(i,s,g){if(typeof s==="undefined"){s="toggle"}var k=this,f=k.options,v,h,m,j,t,q,n,u=k.$tbody.find("> tr:not(."+k.classnames.tr_child+")"),p=function(){k.fixedWidth();k.fixedHeight()},l=function(y,z,x){if(k.$lockTableB){var A=k.$lockTableB.find("> tbody > tr:eq("+y+")");A.toggle(z);if(x){A.height(x)}else{if(!A.height()){A.height(v.height())}}}},w=function(y,z,x){h.find("> div").html(BJUI.doRegional(FRAG.gridShrinkBtn,k.regional));z.fadeIn("normal",function(){if(!x.data("bjui.datagrid.init")){q=d.extend(true,{},k.childOptions),n=q.dataUrl;if(k.isDom){t=y.data("initData")||k.tools.setDomData(y)
    }else{t=k.data[k.tools.getNoChildDataIndex(y.index())]}if(n&&!n.isFinishedTm()){n=k.tools.replacePlh(n,t);if(!n.isFinishedTm()){BJUI.debug("BJUI.Datagrid: The datagrid options 'childOptions' in the 'dataUrl' options is incorrect: "+n)}else{q.dataUrl=n}}x.datagrid(q).data("bjui.datagrid.parent",y).on("completed.bjui.datagrid",d.proxy(function(){p();l(j,true,z.outerHeight());if(g){g.apply(k,[x])}},k)).on("bjui.datagrid.child.resize",function(){x.datagrid("fixedWidth").datagrid("fixedHeight")});y.data("bjui.datagrid.child",x)}else{p();l(j,true);if(g){g.apply(k,[x])}}})},o=function(y,z,x){z.fadeOut("normal",function(){h.find("> div").html(BJUI.doRegional(FRAG.gridExpandBtn,k.regional));p();l(j,false);if(g){g.apply(k,[x])}})},r=function(x){v=x.next("."+k.classnames.tr_child);if(v&&v.length){h=x.find("> td."+k.classnames.td_child);j=v.index();m=v.find("> td").find("table.table-child");if(m&&m.length){if(s&&s==="toggle"){v.is(":hidden")?w(x,v,m):o(x,v,m)}else{s?w(x,v,m):o(x,v,m)}}}};if(g){if(typeof g==="string"){g=g.toFunc()}if(typeof g!=="function"){g=false}}if(i instanceof jQuery){i.each(function(){r(d(this))})}else{if(isNaN(i)){d.each(i.split(","),function(x,z){var y=u.eq(parseInt(z.trim(),10));if(y&&y.length){r(y)}})}else{if(!isNaN(i)){var e=u.eq(i);if(e&&e.length){r(e)}}}}};c.prototype.updateRow=function(l,j){var i=this,m=i.options,g,f,e,h,k=function(p,n){d.extend(f,typeof n==="object"&&n);i.dialogEditComplete(p,f);if(f["refresh.datagrid.child"]){var o=p.data("bjui.datagrid.child");if(o&&o.length){o.datagrid("refresh")}else{i.showChild(l)}}if(m.height==="auto"){var q=i.$boxB.scrollTop();i.$boxB.scrollTop(5);if(i.$boxB.scrollTop()){i.fixedHeight();i.$boxB.scrollTop(q)}}};if(l instanceof jQuery){h=l}else{if(!isNaN(l)){h=i.$tbody.find("> tr:not(."+i.classnames.tr_child+")").eq(parseInt(l,10))}else{BJUI.debug("BJUI.Datagrid: Func 'updateRow', Parameter 'row' is incorrect!");return}}if(i.isDom){f=h.data("initData")||i.tools.setDomData(h)}else{g=i.tools.getNoChildDataIndex(h.index());f=i.data[g]}if(j){if(typeof j==="string"){if(j.trim().startsWith("{")){j=j.toObj()}else{j=j.toFunc()}}if(typeof j==="function"){j=j.apply()}if(typeof j!=="object"&&!m.updateRowUrl){BJUI.debug("BJUI.Datagrid: Func 'updateRow', Parameter 'updateData' is incorrect!");return}k(h,j)}else{if(m.updateRowUrl){e=i.tools.replacePlh(m.updateRowUrl,f);if(!e.isFinishedTm()){BJUI.debug("BJUI.Datagrid: The datagrid options 'updateRowUrl' is incorrect!")}else{BJUI.ajax("doajax",{url:e,type:m.loadType,okCallback:function(n){k(h,n)}})}}else{BJUI.debug("BJUI.Datagrid: The datagrid options 'updateRowUrl' is not set!")}}};c.prototype.doAjaxRow=function(l,j){var i=this,g=i.options,h,k,e,f;if(l instanceof jQuery){h=l}else{if(!isNaN(l)){h=i.$tbody.find("> tr:not(."+i.classnames.tr_child+")").eq(parseInt(l,10))}else{BJUI.debug("BJUI.Datagrid: Func 'doAjaxRow', Parameter 'row' is incorrect!");return}}if(typeof j==="object"&&j.url){if(typeof j.reload==="undefined"){j.reload=false}if(!j.callback&&!j.okCallback){j.okCallback=function(n,m){i.updateRow(h,typeof n==="object"&&!n[BJUI.keys.statusCode]&&n)}}if(i.isDom){k=h.data("initData")||i.tools.setDomData(h)}else{e=i.tools.getNoChildDataIndex(h.index());k=i.data[e]}f=j.url;if(!k||k.addFlag){f=f.replace(/{\/?[^}]*}/g,"")}else{f=i.tools.replacePlh(f,k)}if(!f.isFinishedTm()){BJUI.debug("BJUI.Datagrid: Func 'doAjaxRow', options 'url' is incorrect: "+f)}j.url=f;j.loadingmask=true;j.target=i.$boxB;BJUI.ajax("doajax",j)}else{BJUI.debug("BJUI.Datagrid: Func 'doAjaxRow', options is incorrect or the property 'url' is not set!")}};c.prototype.filter=function(h){var g=this,e=g.options,f=g.$tbody.find("> tr.datagrid-nodata").length;if(h&&typeof h==="object"){if(h.clearOldPostData||!e.postData){e.postData={}}d.extend(e.postData,h)}g.paging.pageCurrent=1;g.refresh();if(f){g.$element.one("afterLoad.bjui.datagrid",function(){g.needfixedWidth=true;g.fixedWidth();g.needfixedWidth=null})}};c.prototype.reload=function(g){var h=this,f=h.options,i,e;if(g&&typeof g==="object"){if(g.clearOldPostData){delete f.postData}if(g.columns){delete f.columns}d.extend(true,f,g)}h.destroy();e=h.$element;e.data("bjui.datagrid",(i=new c(e,f)));if(i){i.init()}};c.prototype.destroy=function(){var f=this,e=f.$grid.data("bjui.datagrid.table");if(e){f.$element.html(e.html()).removeData().insertBefore(f.$grid);f.$grid.remove()}};c.prototype.initTop=function(){var j=this,o=j.options,h=j.regional,l=false,m,i='<div class="btn-group" role="group"></div>',f='<button type="button" class="btn" data-icon=""></button>';if(o.showToolbar){if(o.toolbarItem||o.toolbarCustom){if(o.toolbarItem){var g=o.toolbarItem.toFunc();if(typeof g==="function"){o.toolbarItem=g.apply()}l=true;if(o.toolbarItem.indexOf("all")>=0){o.toolbarItem="add, edit, cancel, save, |, del, |, refresh, |, import, export, exportf"}d.each(o.toolbarItem.split(","),function(p,q){q=q.trim().toLocaleLowerCase();if(!m||q==="|"){m=d(i).appendTo(j.$toolbar);if(q==="|"){return true}}if(q==="add"){j.$toolbar_add=d(f).attr("data-icon","plus").addClass("btn-blue").text(o.addName||BJUI.getRegional("datagrid.add")).appendTo(m).on("click",function(r){j.add()
    })}else{if(q==="edit"){j.$toolbar_edit=d(f).attr("data-icon","edit").addClass("btn-green").text(o.editName||BJUI.getRegional("datagrid.edit")).appendTo(m).on("click",function(s){var r=j.$tbody.find("> tr."+j.classnames.tr_selected);if(!o.editMode){return false}if(!r.length){d(this).alertmsg("info",BJUI.getRegional("datagrid.selectMsg"))}else{if(o.inlineEditMult){j.doEditRow(r)}else{if(j.$lastSelect){j.doEditRow(j.$lastSelect)}else{j.doEditRow(r.first())}}}})}else{if(q==="cancel"){j.$toolbar_calcel=d(f).attr("data-icon","undo").addClass("btn-orange").text(o.cancelName||BJUI.getRegional("datagrid.cancel")).appendTo(m).on("click",function(r){j.doCancelEditRow(j.$tbody.find("> tr."+j.classnames.tr_edit))})}else{if(q==="save"){j.$toolbar_save=d(f).attr("data-icon","save").addClass("btn-default").text(o.saveName||BJUI.getRegional("datagrid.save")).appendTo(m).on("click",function(r){j.doSaveEditRow()})}else{if(q==="del"){j.$toolbar_del=d(f).attr("data-icon","times").addClass("btn-red").text(o.delName||BJUI.getRegional("datagrid.del")).appendTo(m).on("click",function(s){var r=j.$tbody.find("> tr."+j.classnames.tr_selected);if(r.length){j.delRows(r)}else{d(this).alertmsg("info",BJUI.getRegional("datagrid.selectMsg"))}})}else{if(q==="refresh"){j.$toolbar_refresh=d(f).attr("data-icon","refresh").addClass("btn-green").text(o.refreshName||BJUI.getRegional("datagrid.refresh")).appendTo(m).on("click",function(r){j.refresh()})}else{if(q==="import"){j.$toolbar_add=d(f).attr("data-icon","sign-in").addClass("btn-blue").text(o.importName||BJUI.getRegional("datagrid.import")).appendTo(m).on("click",function(s){if(o.importOption){var r=o.importOption;if(typeof r==="string"){r=r.toObj()}if(r.options&&r.options.url){if(r.type==="dialog"){j.$grid.dialog(r.options)}else{if(r.type==="navtab"){j.$grid.navtab(r.options)}else{j.$grid.bjuiajax("doajax",r.options)}}}}})}else{if(q==="export"){j.$toolbar_add=d(f).attr("data-icon","sign-out").addClass("btn-green").text(o.exportName||BJUI.getRegional("datagrid.export")).appendTo(m).on("click",function(s){if(o.exportOption){var r=o.exportOption;if(typeof r==="string"){r=r.toObj()}if(r.options&&r.options.url){if(!r.options.data){r.options.data={}}d.extend(r.options.data,j.$element.data("filterDatas")||{},j.sortData||{});r.options.type="POST";if(r.type==="dialog"){BJUI.dialog(r.options)}else{if(r.type==="navtab"){BJUI.navtab(r.options)}else{if(r.type==="file"){r.options.target=j.$boxB;BJUI.ajax("ajaxdownload",r.options)}else{BJUI.ajax("doajax",r.options)}}}}}})}else{if(q==="exportf"){j.$toolbar_add=d(f).attr("data-icon","filter").addClass("btn-green").text(o.exportfName||BJUI.getRegional("datagrid.exportf")).appendTo(m).on("click",function(t){if(o.exportOption){var s=o.exportOption,r=j.tools.getRemoteFilterData(true);if(typeof s==="string"){s=s.toObj()}if(s.options&&s.options.url){if(!s.options.data){s.options.data={}}d.extend(s.options.data,r,j.sortData||{});s.options.type="POST";if(s.type==="dialog"){BJUI.dialog(s.options)}else{if(s.type==="navtab"){BJUI.navtab(s.options)}else{if(s.type==="file"){s.options.target=j.$boxB;BJUI.ajax("ajaxdownload",s.options)}else{BJUI.ajax("doajax",s.options)}}}}}})}}}}}}}}}})}if(o.toolbarCustom){var k,n=d('<div style="display:inline-block;"></div>');if(typeof o.toolbarCustom==="string"){var e=d(o.toolbarCustom);if(e&&e.length){k=e}else{e=e.toFunc();if(e){k=e.call(j);if(typeof k==="string"){k=d(k)}}}}else{if(typeof o.toolbarCustom==="function"){k=o.toolbarCustom.call(j);if(typeof k==="string"){k=d(k)}}else{k=o.toolbarCustom}}if(k&&k.length&&typeof k!=="string"){if(l){n.css("margin-left","5px")}n.appendTo(j.$toolbar);k.appendTo(n)}}j.$toolbar.initui()}}};c.prototype.initThead=function(){var i=this,e=i.options,l=i.tools,h=i.columnModel,g,k=[];i.$tableH.append(i.$thead);i.init_thead=true;i.$trsH=i.$thead.find("> tr");i.table_width=0;i.$colgroupH=i.$tableH.find("> colgroup");i.fixtedColumnWidthCount=0;d.each(i.columnModel,function(o,p){var m="";if(p===i.checkboxColumn||p===i.childColumn||p===i.editBtnsColumn||p.finalWidth){m=' class="datagrid_col_lockwidth"'}g=p.width;if((!g||g==="auto")&&!i.hasAutoCol){i.hasAutoCol=true}k.push('<col style="width:'+(g&&g!=="auto"?g+"px":"auto")+'"'+m+">");p.width=g});i.table_width=i.$grid.width();i.$colgroupH.html(k.join(""));var f=i.$trsH.find("> th");f.filter(".datagrid-quicksort-th").on("click.bjui.datagrid.quicksort",function(n){var m=d(n.target);if(!m.closest("."+i.classnames.th_cell).length&&!i.isResize){l.quickSort(h[d(this).data("index")])}});f.filter(".datagrid-column-menu").on("filter.bjui.datagrid.th",function(p,m){var n=d(this),o=n.find("> div > ."+i.classnames.th_cell+"> ."+i.classnames.btn_menu+"> .btn");if(m){n.addClass("filter-active");o.find("> i").attr("class","fa fa-filter")}else{n.removeClass("filter-active");o.find("> i").attr("class","fa fa-bars")}});if(e.contextMenuH){l.contextmenuH()}i.initTbody();if(e.columnResize){i.colResize()}if(e.columnMenu){i.colMenu()}if(e.paging){i.initPaging()}if(e.editMode){i.edit()}var j=function(){if(e.showTfoot){i.initTfoot()
    }if(i.renderTds&&i.renderTds.length){var m=i.$tbody.find("> tr:not(."+i.classnames.tr_child+", .datagrid-nodata)"),o=i.renderTds&&i.renderTds.length,v={};var n=d(),s=[];for(var q=0;q<o;q++){var p=i.renderTds[q],u=p.render.call(i,p.label,p.data,i.columnModel[p.tdindex].items,i.columnModel[p.tdindex].itemattr);var r=d.extend({},p.data);if(!v[p.tdindex]&&i.columnModel[p.tdindex].fixedWidth){v[p.tdindex]=i.columnModel[p.tdindex]}if(i.isTemplate){var r={},t=d.inArray(m.eq(p.trindex)[0],n);if(t==-1){n=n.add(m.eq(p.trindex));r=d.extend({},p.data);r[i.columnModel[p.tdindex]["name"]]=u;s.push(r)}else{s[t][i.columnModel[p.tdindex]["name"]]=u}}else{m.eq(p.trindex).find("> td:eq("+p.tdindex+") > div:last").html(u)}}d.each(n,function(x){var y=d(this).find("> td.datagrid-template-td"),w=y.html();if(y.length){y.html(l.replacePlh4Template(w,s[x]))}})}if(i.isTemplate){i.$grid.data("bjui.datagrid.trs.template",i.$tbody.html())}else{i.$grid.data("bjui.datagrid.trs.normal",i.$tbody.html())}i.initEvents();i.$tableB.initui();i.$lockTableB&&i.$lockTableB.initui();l.setBoxbH();if(i.collapseIndex&&i.collapseIndex.length){i.expand(i.collapseIndex.join(","),false);i.collapseIndex=null}setTimeout(function(){i.fixedWidth("init");i.initLock();i.$element.trigger("completed.bjui.datagrid",{datas:i.data});i.$boxM&&i.$boxM.trigger("bjui.ajaxStop").hide();if((i.options.width.endsWith("%")&&(i.options.flowLayoutWidth&&i.$grid.width()<i.options.flowLayoutWidth)||i.options.dialogFilterW&&i.$grid.width()<i.options.dialogFilterW)||i.options.dialogFilterW===0){d(window).resize()}i.resizeGrid()},50);i.delayFilterTimeout&&clearInterval(i.delayFilterTimeout)};if(e.filterThead){if(i.delayRender){i.delayFilterTimeout=setInterval(function(){if(!i.delayRender){i.filterInThead();j()}},100)}else{i.filterInThead();j()}}else{j()}};c.prototype.fixedWidth=function(i){var k=this,m=k.options,e,f=0,h,j=k.columnModel,g=j.length;if(i&&k.initFixedW){return}k.initFixedW=true;var l=function(){if(String(k.options.width).endsWith("%")){k.$grid.css("width","")}k.$boxH.find("> div").css("width","");k.$boxB.find("> div").css("width","");k.$boxF&&k.$boxF.find("> div").css("width","");k.$boxP&&k.$boxP.find("> div.paging-content").css("width","");e=(k.$boxB.find("> div"))[0].clientWidth;if(k.options.hasChild){var n=k.$boxB.scrollTop();k.$boxB.scrollTop(1);if(k.$boxB.scrollTop()){k.$boxB.scrollTop(n)}}if(k.$element.hasClass("table-child")){e=e-18}k.$boxB.find("> div").width(e);k.$boxH.find("> div").width(e);k.$boxF&&k.$boxF.find("> div").width(e);if(k.table_width>e||m.fullGrid){k.$boxP&&k.$boxP.find("> div.paging-content").width(e)}else{k.$boxP&&k.$boxP.find("> div.paging-content").width(k.table_width)}if(m.fullGrid||k.isTemplate||k.needfixedWidth||(k.hasAutoCol&&i)){d("body").find("> .bjui-datagrid").remove();var u=k.$tableH.height(),v=d('<div class="bjui-datagrid forwidth"></div>'),s=k.$element.clone().addClass("table table-bordered").appendTo(v);s.find("> tbody").before(k.$thead.clone());s.find("> colgroup > col").each(function(w){var x=d(this),y=k.data.length?String(k.data[k.data.length-1].gridNumber).length:2;if(x.hasClass("datagrid_col_lockwidth")){return true}if(j[w]===k.linenumberColumn){y==1&&(y=2);x.width(y*15)}else{if(!j[w].width||j[w].width==="auto"||k.isTemplate){x.width("")}}});v.width(e+17).height(k.$boxB.height()).prependTo(d("body"));if(!(m.fullGrid||k.isTemplate)&&m.hScrollbar){v.width("")}if(k.isTemplate){m.tableWidth="100%"}s.attr("style","width:"+(m.tableWidth||"auto")+" !important;");s.find("thead th > div").height("");var r=s.find("> tbody > tr:first");if(!r.length||k.isTemplate||r.hasClass("datagrid-nodata")){var q=BJUI.StrBuilder();q.add("<tr>");for(var p=0,o=s.find("colgroup > col").length;p<o;p++){q.add("<td");if(j[p].hide){q.add(' style="display:none;"')}q.add("></td>")}q.add("</tr>");s.find("> tbody").prepend(q.toString());r=s.find("> tbody > tr:first")}if(k.isTemplate){k.$boxP&&k.$boxP.find("> div.paging-content").width("100%")}var t=k.$thead.find("th");s.find("thead > tr:not(.datagrid-filter) > th").each(function(x){var y=d(this),w=y.is(":hidden");if(w){y.show()}t.eq(x).find("> div").height(y.find("> div").height());if(w){y.hide()}});k.$boxB.height(k.$boxB.height()+(u-s.find("> thead").height()));k.$boxM&&k.$boxM.height(k.$boxB.height()).css("top",k.$boxB.position().top);k.$lockB&&k.$lockB.height(k.$boxB.height());r.find("> td").each(function(w){var x=k.$colgroupB.find("> col:eq("+w+")");!(x.hasClass("datagrid_col_lockwidth"))&&x.width(d(this).outerWidth())});k.$colgroupH.html(k.$colgroupB.html());if(!k.options.noremove){v.remove()}}};l()};c.prototype.fixedHeight=function(e){var g=this,f=g.options;if(f.height==="auto"){g.boxH="auto";g.$grid.css("height","");g.$boxB.css("height","");g.tools.setBoxbH()}else{g.tools.setBoxbH(e)}var h=g.$boxB.scrollLeft();g.$boxB.scrollLeft(5);if(g.$boxB.scrollLeft()){g.fixedWidth();g.$boxB.scrollLeft(h)}};c.prototype.initTbody=function(){var h=this,f=h.options,j=h.tools,e=h.$tbody.find("> tr"),i=e.find("> td"),g=f.tableWidth||"0";
        h.init_tbody=true;h.$colgroupB=h.$colgroupH.clone();h.$tableB.prepend(h.$colgroupB);if(f.fullGrid||h.isTemplate){g="100%"}h.$tableH.css("width",g);h.$tableB.css("width",g);h.$tableB.removeAttr("data-toggle width").addClass("table table-bordered").removeClass("table-hover");h.$boxB.scroll(function(){h.$boxH.find("> div").prop("scrollLeft",this.scrollLeft);h.$boxF&&h.$boxF.find("> div").prop("scrollLeft",this.scrollLeft);h.$lockB&&h.$lockB.prop("scrollTop",this.scrollTop)});if(h.isDom){if(f.showLinenumber){h.showLinenumber(f.showLinenumber)}if(f.showCheckboxcol){h.showCheckboxcol(f.showCheckboxcol)}if(f.showEditbtnscol){h.showEditCol(f.showEditbtnscol)}h.$grid.data(h.datanames.tbody,h.$tbody.clone())}};c.prototype.initEvents=function(g){var i=this,h=i.options,e=i.$tbody.find("> tr");if(!g){g=e}g.on("click.bjui.datagrid.tr",function(o,l){var m=d(this),n=m.index(),k,r=i.$tbody.find("> tr."+i.classnames.tr_selected),p=i.$lastSelect,q,j=i.$lockTbody&&i.$lockTbody.find("> tr");if(l){q=l.is(":checked");if(!q){i.$lastSelect=m}i.selectedRows(m,!q)}else{if(m.hasClass(i.classnames.tr_edit)){return}if(h.selectMult){i.selectedRows(m)}else{if(!BJUI.KeyPressed.ctrl&&!BJUI.KeyPressed.shift){if(r.length>1&&m.hasClass(i.classnames.tr_selected)){i.selectedRows(r.not(m));i.$lastSelect=m}else{if(r.length&&r[0]!=this){i.selectedRows(null)}if(!m.hasClass(i.classnames.tr_selected)){i.$lastSelect=m}i.selectedRows(m)}}else{if(BJUI.KeyPressed.ctrl){if(!m.hasClass(i.classnames.tr_selected)){i.$lastSelect=m}i.selectedRows(m)}else{if(BJUI.KeyPressed.shift){if(!p){p=i.$lastSelect=m}if(p.length){i.selectedRows(null);if(p.index()!=n){if(p.index()>n){i.selectedRows(m.nextUntil(p).add(m).add(p),true)}else{i.selectedRows(m.prevUntil(p).add(m).add(p),true)}}else{i.selectedRows(n)}}}}}}}if(i.isDom){k=i.tools.setDomData(m)}else{k=i.data[i.tools.getNoChildDataIndex(n)]}i.$element.trigger("clicked.bjui.datagrid.tr",{target:o.target,tr:m,data:k})}).on("mouseenter.bjui.datagrid",function(l){var k=d(this),j=k.index();if(i.isDrag){return false}k.addClass("datagrid-hover");i.$lockTbody&&i.$lockTbody.find("> tr:eq("+j+")").addClass("datagrid-hover")}).on("mouseleave.bjui.datagrid",function(l){var k=d(this),j=k.index();if(i.isDrag){return false}k.removeClass("datagrid-hover");i.$lockTbody&&i.$lockTbody.find("> tr:eq("+j+")").removeClass("datagrid-hover")}).on("delete.bjui.datagrid.tr",function(r){r.stopPropagation();var p=d(this),s=p.index(),o=s,n=i.data,j,k=i.allData,m=i.$lockTbody&&i.$lockTbody.find("> tr");if(p.hasClass("datagrid-nodata")){return false}if(i.options.hasChild&&i.options.childOptions){o=o/2;p.next().remove();m&&m.eq(s).next().remove()}if(i.options.isTree){var l=i.getChildrens(p,null,true),q=l.length;if(i.options.hasChild&&i.options.childOptions){q=q/2}l.remove();if(!i.isDom){j=n[o].gridIndex;i.data.splice(o+1,q);i.allData.splice(j+1,q)}}if(!i.isDom){j=n[o].gridIndex;i.data=n.remove(o);i.allData=k.remove(j);i.tools.updateGridIndex()}if(d.inArray(i.linenumberColumn,i.columnModel)!=-1){p.nextAll(":not(."+i.classnames.tr_child+")").each(function(){var u=d(this).find("> td."+i.classnames.td_linenumber),t=parseInt(u.text(),10);u.text(t-1)});m&&m.eq(s).trigger("delete.bjui.datagrid.tr",[s])}p.remove();m&&m.eq(s).remove();i.tools.createNoDataTr()});i.$grid.off("click.bjui.datagrid.tr.child").on("click.bjui.datagrid.tr.child","td."+i.classnames.td_child,function(m){m.stopPropagation();var l=d(this),j=l.closest("tr"),k=j.next("."+i.classnames.tr_child);if(k&&k.length){i.showChild(j,!k.is(":visible"))}}).off("ifClicked").on("ifClicked","td."+i.classnames.td_checkbox+" input",function(m){m.stopPropagation();var l=d(this),k=l.closest("tr"),j=k.index();i.$tbody.find("> tr:eq("+j+")").trigger("click.bjui.datagrid.tr",[l])}).off("ifChanged").on("ifChanged","th."+i.classnames.td_checkbox+" input",function(l){l.stopPropagation();var k=d(this).is(":checked"),j=i.$tbody.find('> tr:not(".'+i.classnames.tr_child+'")');i.selectedRows(j,k)});if(h.contextMenuB){g.each(function(){i.tools.contextmenuB(d(this))})}i.$tableB.off("click.bjui.datagrid.refresh").on("click.bjui.datagrid.refresh",'tbody > tr > td [data-toggle="update.datagrid.tr"]',function(j){j.stopPropagation();j.preventDefault();i.updateRow(d(this).closest("tr"))}).off("click.bjui.datagrid.edit").on("click.bjui.datagrid.edit",'tbody > tr > td [data-toggle="edit.datagrid.tr"]',function(m){m.stopPropagation();m.preventDefault();var l=d(this),k=l.data("options"),j=l.closest("tr");if(k&&typeof k==="string"){k=k.toObj()}if(typeof k==="object"){i.externalEdit(j,k)}else{i.doEditRow(j)}}).off("click.bjui.datagrid.ajax").on("click.bjui.datagrid.ajax",'tbody > tr > td [data-toggle="ajax.datagrid.tr"]',function(l){l.stopPropagation();l.preventDefault();var k=d(this),j=k.data();if(j.options&&typeof j.options==="string"){j.options=j.options.toObj()}d.extend(j,typeof j.options==="object"&&j.options);if(!j.url&&k.attr("href")){j.url=k.attr("href")}i.doAjaxRow(k.closest("tr"),j)}).off("click.bjui.datagrid.addchild").on("click.bjui.datagrid.addchild",'tbody > tr > td [data-toggle="addchild.datagrid.tr"]',function(p){p.stopPropagation();
        p.preventDefault();var q=d(this),o=q.closest("tr"),s=o.data("bjui.datagrid.child"),j=o.next("."+i.classnames.tr_child),n,m=q.data("addData"),l,r=function(t){return t.replace(/#\/?[^#]*#/g,function(u){var v=u.replace(/[##]+/g,""),w=n[v];if(typeof w==="undefined"||w==="null"||w===null){w=""}return w})},k=function(t){if(m){if(typeof m==="string"){m=r(m);if(m.trim().startsWith("{")){m=m.toObj()}else{m=m.toFunc()}}else{if(typeof m==="function"){m=m.toFunc()}if(typeof m==="object"){m=JSON.stringify(m)}m=r(m).toObj()}if(typeof m==="object"){l=m}}t.datagrid("add",false,l)};if(j&&j.length){if(i.isDom){n=o.data("initData")||tools.setDomData(o)}else{n=i.data[i.tools.getNoChildDataIndex(o.index())]}if(s&&s.length){k(s)}else{i.showChild(o,true,k)}}}).off("click.bjui.datagrid.del").on("click.bjui.datagrid.del",'tbody > tr > td [data-toggle="del.datagrid.tr"]',function(j){j.stopPropagation();j.preventDefault();i.delRows(d(this).closest("tr"))}).off("click.bjui.datagrid.tree").on("click.bjui.datagrid.tree","tbody > tr > td .datagrid-tree-switch",function(m){m.stopPropagation();m.preventDefault();var o=d(this),l=o.closest("tr"),k=l.data("child"),n=l.data("level"),j=!o.hasClass("collapsed");if(k){l.data("isExpand",!j).nextAll(".datagrid-tree-level-"+(n+1)).slice(0,k).toggleClass("collapsed",j).trigger("switch.child.bjui.datagrid.tree",{isExpand:j});o.toggleClass("collapsed",j).find("> i").attr("class","fa "+(j?"fa-plus-square-o":"fa-minus-square-o"))}if(h.height==="auto"){i.fixedHeight()}}).off("switch.child.bjui.datagrid.tree").on("switch.child.bjui.datagrid.tree","tbody > tr",function(m,l){m.stopPropagation();m.preventDefault();var k=d(this),j=k.data("child"),n=k.data("level");if(j){k.nextAll(".datagrid-tree-level-"+(n+1)).slice(0,j).toggleClass("collapsed-child",l[i.options.treeOptions.isExpand]).trigger("switch.child.bjui.datagrid.tree",{isExpand:l[i.options.treeOptions.isExpand]})}}).off("expand.bjui.datagrid.tree").on("expand.bjui.datagrid.tree","tbody > tr",function(k){k.stopPropagation();k.preventDefault();var j=d(this).data("isExpand",true),l=j.find("> td.datagrid-tree-td .datagrid-tree-switch");if(!l||!l.length||!l.hasClass("collapsed")){return false}l.trigger("click.bjui.datagrid.tree");if(h.height==="auto"){i.fixedHeight()}}).off("collapse.bjui.datagrid.tree").on("collapse.bjui.datagrid.tree","tbody > tr",function(k){k.stopPropagation();k.preventDefault();var j=d(this).data("isExpand",false),l=j.find("> td.datagrid-tree-td .datagrid-tree-switch");if(!l||!l.length||l.hasClass("collapsed")){return false}l.trigger("click.bjui.datagrid.tree");if(h.height==="auto"){i.fixedHeight()}}).off("mouseover.bjui.datagrid.tree").on("mouseover.bjui.datagrid.tree","tbody > tr > td.datagrid-tree-td",function(k){k.stopPropagation();k.preventDefault();if(!h.treeOptions.add||i.isDrag){return false}var l=d(this),j=l.closest("tr"),m=l.find(".datagrid-tree-add");if(!m||!m.length){l.find("> div").append('<a href="javascript:;" class="datagrid-tree-add" data-toggle="add.datagrid.tree" title="添加"><i class="fa fa-plus-circle"></i></a>')}else{m.show()}}).off("mouseout.bjui.datagrid.tree").on("mouseout.bjui.datagrid.tree","tbody > tr > td.datagrid-tree-td",function(j){j.stopPropagation();j.preventDefault();if(!h.treeOptions.add||i.isDrag){return false}var k=d(this),l=k.find(".datagrid-tree-add");if(l&&l.length){l.hide()}}).off("click.bjui.datagrid.tree.add").on("click.bjui.datagrid.tree.add",'tbody > tr > td.datagrid-tree-td [data-toggle="add.datagrid.tree"]',function(l){l.stopPropagation();l.preventDefault();var m=d(this),k=m.closest("tr"),j=m.data();if(j.addData){if(typeof j.addData==="string"){j.addData=j.addData.toObj()}}i.addTree(k,j.addLocation||"",j.addData||{})});if(h.dropOptions.drop){var g=i.$tbody.find("> tr:not(."+i.classnames.tr_child+")"),f=h.dropOptions.beforeDrag;if(typeof f==="string"){f=f.toFunc()}if(typeof f!=="function"){f=false}g.basedrag("destroy").basedrag({exclude:"input, button, a, .bjui-lookup, .datagrid-tree-switch, .datagrid-tree-add, .datagrid-child-td",drop:g,container:i.$boxB,beforeDrag:f,treeData:i.data,drag:function(){i.isDrag=true},stop:function(){i.isDrag=false;d(this).find("> td.datagrid-tree-td").trigger("mouseout.bjui.datagrid.tree")}}).off("dropover.bjui.basedrag").on("dropover.bjui.basedrag",function(p,k,q,o){e.removeClass("datagrid-hover datagrid-drop-over-after datagrid-drop-over-before").find(".datagrid-tree-box").removeClass("datagrid-drop-over-append");if(this===o[0]||o.hasClass(i.classnames.tr_edit)){return false}if(i.options.isTree){var l=i.getChildrens(o);if(d.inArray(this,l)!==-1){return false}}var n=d(this).addClass("datagrid-hover"),j=n.outerHeight()/2,m=n.offset().top;if(i.options.isTree){j=5}if(q<(m+j)){n.addClass("datagrid-drop-over-before").prevAll(":visible:first").addClass("datagrid-drop-over-after")}else{if(!i.options.isTree||(i.options.isTree&&q>(m+n.outerHeight()-j))){n.addClass("datagrid-drop-over-after")}else{if(i.options.isTree){n.find(".datagrid-tree-box").addClass("datagrid-drop-over-append")
    }}}}).off("dropout.bjui.basedrag").on("dropout.bjui.basedrag",function(k,j){g.removeClass("datagrid-hover datagrid-drop-over-after datagrid-drop-over-before");g.find("div.datagrid-drop-over-append").removeClass("datagrid-drop-over-append")}).off("drop.bjui.basedrag").on("drop.bjui.basedrag",function(o,p){var s=d(this),n,r=h.dropOptions.beforeDrop,l=h.dropOptions.afterDrop;i.afterDrop=false;if(s.hasClass("datagrid-drop-over-before")){n="top"}else{if(s.hasClass("datagrid-drop-over-after")){n="bottom"}else{if(i.options.isTree&&s.find(".datagrid-tree-box").hasClass("datagrid-drop-over-append")){n="append"}}}if(n){if(n!="append"){i.insertTr(p,s,n)}else{var m=i.getParents(p,null,true);if(d.inArray(this,m)!==-1){s.find(".datagrid-tree-box").removeClass("datagrid-drop-over-append");return false}i.appendTr(p,s)}}g.removeClass("datagrid-drop-over-after datagrid-drop-over-before").find(".datagrid-tree-box").removeClass("datagrid-drop-over-append");if(l&&i.afterDrop){if(typeof l==="function"){l.apply(i,[p,s])}else{if(h.dropOptions.dropUrl){var k={pageSize:i.paging.pageSize,pageCurrent:i.paging.pageCurrent},q=h.editType,j={url:h.dropOptions.dropUrl,type:"POST",reload:false};k["list"]=[];d.each(i.data,function(u,w){var v=d.extend({},w);if(h.dropOptions.scope!=="drop"||w[h.keys.dropFlag]){for(var t in h.keys){delete v[h.keys[t]]}}if(h.dropOptions.scope==="drop"){if(w[h.keys.dropFlag]){k["list"].push(v)}}else{k["list"].push(v)}});if(k){k=JSON.stringify(h.dropOptions.paging&&h.paging?k:k["list"]);if(q&&q==="raw"){j.data=k;j.contentType="application/json"}else{j.data={json:k};q&&(j.type=q)}BJUI.ajax("doajax",j)}}}}})}};c.prototype.getChildrens=function(i,j,h,e){var g=this,f=i.data("child"),k=i.data("level");if(e){e--}if(!j){j=d()}if(f){i.nextAll(".datagrid-tree-level-"+(k+1)).slice(0,f).each(function(){j=j.add(this);if(h&&d(this).next().hasClass(g.classnames.tr_child)){j=j.add(d(this).next())}if(e){j=j.add(g.getChildrens(d(this),j,h,e))}})}return j};c.prototype.getParents=function(j,f,e,i){var h=this,k=j.data("level"),g;if(!f){f=d()}if(k){g=j.prevAll(".datagrid-tree-level-"+(k-1)+":first");if(g.length){f=f.add(g);if(i&&g.next().hasClass(h.classnames.tr_child)){f=f.add(g.next())}if(!e){f=f.add(h.getParents(g,f,i))}}}return f};c.prototype.appendTr=function(x,m,o){if(!this.options.isTree){return}var i=this,f=i.options,e,D,u=i.tools.getNoChildDataIndex(x.index()),y=i.tools.getNoChildDataIndex(m.index()),B=x.next().hasClass(i.classnames.tr_child),p=f.treeOptions.keys,l,q,k=x.data("level"),n=(m.data("level")+1)||0,g=m.data("child")+1,j,w=m.find("> td.datagrid-tree-td"),s,v,z;var h=f.dropOptions.beforeDrop;if(B){x=x.add(x.next());m=m.add(m.next())}e=i.data[u];D=i.data[y];if(h&&typeof h==="string"){h=h.toFunc()}if(h&&typeof h==="function"){if(!h.apply(this,[e,D,"append"])){return}}l=i.getParents(x,null,true);if(l.length){q=i.data[i.tools.getNoChildDataIndex(l.index())];q[p.childLen]=q[p.childLen]-1;l.data("child",q[p.childLen]).attr("data-child",q[p.childLen]);if(!q[p.childLen]){delete q[p.isParent];delete q[p.isExpand];var C=l.find("> td.datagrid-tree-td");C.html(i.tools.createTreePlaceholder(q,C.find(".datagrid-tree-title").html()),l.data("isExpand"))}}if(m.length){m=i.getChildrens(m,m,true);z=i.getChildrens(m.last(),m.last(),true,true).last();i.expand(m.first(),true);D[p.isParent]=true;D[p.childLen]=g;m.first().data("child",g).attr("data-child",g);w.html(i.tools.createTreePlaceholder(D,w.find(".datagrid-tree-title").html(),m.first().data("isExpand")))}x=i.getChildrens(x,x,true);x.filter(":not(."+i.classnames.tr_child+")").each(function(){var I=d(this),K=I.data("level"),E=K+(n-k),J=I.find("> td.datagrid-tree-td"),G=J.find(".datagrid-tree-title").html(),H=I.index(),F=i.data[i.tools.getNoChildDataIndex(H)];if(o&&o.isUp){E=D[p.level]}F[p.level]=E;I.removeClass("datagrid-tree-level-"+K).addClass("datagrid-tree-level-"+E).data("level",E).attr("data-level",E);J.html(i.tools.createTreePlaceholder(F,G,I.data("isExpand")))});if(o&&o.dIndex){s=o.dIndex}else{s=m.last().index()+1;if(B){s=s/2}}v=(B?x.length/2:x.length);i.data.moveItems(u,s,v);i.allData.moveItems(e.gridIndex,(e.gridIndex+(s-u)),v);i.tools.updateGridIndex();if(o&&o._dTr){j=i.getParents(o._dTr,null,true,false);if(o.isBefore){x.insertBefore(o._dTr)}else{if(o.isUp){x.insertAfter(z)}else{x.insertAfter(o._dTr)}}}else{x.insertAfter(z)}if(l){var r=i.getChildrens(l,null,false);r.each(function(E){var F=i.data[i.tools.getNoChildDataIndex(d(this).index())];if(F){F[p.order]=E;F[f.keys.dropFlag]=true}})}if(!j){j=m.first()}if(j&&j.length){var r=i.getChildrens(j,null,false),A=i.data[i.tools.getNoChildDataIndex(j.index())];e[p.parentKey]=A[p.key];r.each(function(E){var F=i.data[i.tools.getNoChildDataIndex(d(this).index())];if(F){F[p.order]=E;F[f.keys.dropFlag]=true}})}else{var t=x.siblings(".datagrid-tree-level-"+e[p.level]).addBack();e[p.parentKey]=null;t.each(function(E){var F=i.data[i.tools.getNoChildDataIndex(d(this).index())];if(F){F[p.order]=E;F[f.keys.dropFlag]=true}})}i.tools.updateLinenumber();
        i.afterDrop=true};c.prototype.insertTr=function(x,o,D){var l=this,t,h=l.options,q=h.treeOptions.keys,f,C,s,u=l.tools.getNoChildDataIndex(x.index()),y=l.tools.getNoChildDataIndex(o.index()),B=x.next().hasClass(l.classnames.tr_child),A,k;var j=h.dropOptions.beforeDrop;var e=function(E,F,i){if(D==="bottom"){if(B){F=F.next()}E.insertAfter(F)}else{E.insertBefore(F)}};f=l.data[u];C=l.data[y];if(j&&typeof j==="string"){j=j.toFunc()}if(j&&typeof j==="function"){if(!j.apply(this,[f,C,D])){return}}if(u>y){t=D==="top"?0:1}else{t=D==="top"?-1:0}s=y+t;if(s==u&&!h.isTree){return}if(B){x=x.add(x.next())}if(l.isDom){e(x,o,t)}else{f=l.data[u];C=l.data[y];if(h.isTree){var w,p={},z=false,n=l.getParents(x.first(),null,true),m=l.getParents(o,null,true);if(C[q.level]===f[q.level]&&C[q.order]==f[q.order]+(D==="bottom"?-1:1)){return}if(D==="bottom"&&C[q.isParent]){z=true;p._dTr=o;p.dIndex=y+1;p.isUp=true}else{if(x.data("level")!=o.data("level")||n[0]!==m[0]){z=true;p._dTr=o;p.dIndex=s;o=m;if(D==="top"){p.isBefore=true}if(u<y){p.dIndex++}}}if(z){l.appendTr(x,o,p);return}x=l.getChildrens(x,x,true);w=(B?x.length/2:x.length);l.data.moveItems(u,s,w);l.allData.moveItems(f.gridIndex,(C.gridIndex+t),w);A=(u>y?y:u);k=(u>y?u:y)+(w-1)}else{l.data.move(u,s);l.allData.move(f.gridIndex,(C.gridIndex+t));A=u>y?y:u;k=u>y?u:y}l.tools.updateGridIndex();e(x,o,t);if(n){var r=l.getChildrens(n,null,false,1);r.each(function(E){var F=l.data[l.tools.getNoChildDataIndex(d(this).index())];if(F&&(F[h.keys.gridIndex]>=A&&F[h.keys.gridIndex]<=k)){F[q.order]=E;F[h.keys.dropFlag]=true}})}else{for(var v=A;v<=k;v++){var g=l.data[v];g[h.keys.dropFlag]=true}}l.tools.updateLinenumber();l.afterDrop=true}};c.prototype.addTree=function(l,j,e){var i=this,m=i.options,g,f,k,h;if(m.isTree){if(!e||typeof e!=="object"){e={}}if(l instanceof jQuery){g=l.first()}else{g=i.$tbody.find("> tr:not(."+i.classnames.tr_child+")").eq(parseInt(l,10))}if(g&&g.length){i.$lastSelect=g;i.add(j,e)}}};c.prototype.expand=function(j,k){var h=this,f=h.options,e=h.$tbody.find("> tr:not(."+h.classnames.tr_child+")"),g;if(typeof k==="undefined"){k=true}g=(k?"expand":"collapse")+".bjui.datagrid.tree";if(f.isTree){if(j instanceof jQuery){j.trigger(g)}else{if(isNaN(j)){d.each(j.split(","),function(l,o){var m=e.eq(parseInt(o.trim(),10));if(m&&m.length){m.trigger(g)}})}else{if(!isNaN(j)){var i=e.eq(j);if(i&&i.length){i.trigger(g)}}}}}};c.prototype.initTfoot=function(){var h=this,e=h.options,i=h.tools,f=h.columnModel,g=d("<tr></tr>");h.$boxF=d('<div class="datagrid-box-f"></div>');h.$colgroupF=h.$colgroupH.clone();h.$tableF=h.$tableH.clone().empty();h.$tableF.append(h.$colgroupF);h.$boxF.append(d('<div class="datagrid-wrap-h"></div>').append(h.$tableF));h.$boxF.insertAfter(h.$boxB);h.$tfoot=d("<thead></thead>");d.each(f,function(j,m){var k=d("<th><div></div></th>");if(m.calc){var l='<div><div class="datagrid-calcbox">#tit#</div>#number#</div>';if(m.calc==="avg"){k.html(l.replace("#tit#",(m.calcTit||"AVG")).replace("#number#",(m.calc_sum/m.calc_count).toFixed(m.calcDecimal||2)))}else{if(m.calc==="count"){k.html(l.replace("#tit#",(m.calcTit||"COUNT")).replace("#number#",(m.calc_count)))}else{if(m.calc==="sum"){k.html(l.replace("#tit#",(m.calcTit||"SUM")).replace("#number#",(m.calc_sum)))}else{if(m.calc==="max"){k.html(l.replace("#tit#",(m.calcTit||"MAX")).replace("#number#",(m.calc_max)))}else{if(m.calc==="min"){k.html(l.replace("#tit#",(m.calcTit||"MIN")).replace("#number#",(m.calc_min)))}}}}}}if(m.hidden){k.css("display","none")}k.appendTo(g)});h.$tfoot.append(g).appendTo(h.$tableF);h.$tfoot.on("resizeH.bjui.datagrid.tfoot",function(){i.setBoxbH(e.height)})};c.prototype.selectedRows=function(k,i){var j=this,f=j.$lockTbody&&j.$lockTbody.find("> tr"),h=j.$tbody.find("> tr");var l=function(m){if(typeof i==="undefined"){i=true}if(h.eq(m).hasClass(j.classnames.tr_child)){return}h.eq(m).toggleClass(j.classnames.tr_selected,i).find("> td."+j.classnames.td_checkbox+" input").iCheck(i?"check":"uncheck");f&&f.eq(m).toggleClass(j.classnames.tr_selected,i).find("> td."+j.classnames.td_checkbox+" input").iCheck(i?"check":"uncheck")};if(k===null){h.removeClass(j.classnames.tr_selected).find("> td."+j.classnames.td_checkbox+" input").iCheck("uncheck");f&&f.removeClass(j.classnames.tr_selected).find("> td."+j.classnames.td_checkbox+" input").iCheck("uncheck")}else{if(typeof k==="object"){k.each(function(){var m=d(this),n=m.index();if(m.hasClass(j.classnames.tr_child)){return true}if(typeof i!=="undefined"){l(n)}else{m.toggleClass(j.classnames.tr_selected).trigger("bjui.datagrid.tr.selected").find("> td."+j.classnames.td_checkbox+" input").iCheck((m.hasClass(j.classnames.tr_selected)?"check":"uncheck"));f&&f.eq(n).toggleClass(j.classnames.tr_selected).trigger("bjui.datagrid.tr.selected").find("> td."+j.classnames.td_checkbox+" input").iCheck((m.hasClass(j.classnames.tr_selected)?"check":"uncheck"))}})}else{if(isNaN(k)){d.each(k.split(","),function(m,o){l(parseInt(o.trim(),10))})}else{if(!isNaN(k)){l(parseInt(k,10))}}}}if(j.$lastSelect&&!j.$lastSelect.hasClass(j.classnames.tr_selected)){j.$lastSelect=null
    }var g=j.$tbody.find("> tr."+j.classnames.tr_selected),e=[];g.each(function(){var n=d(this),m=n.index(),o;m=j.tools.getNoChildDataIndex(m);if(j.isDom){o=n.data("initData")||j.tools.setDomData(n)}else{o=j.data[m]}e.push(o)});j.$element.data("selectedTrs",g).data("selectedDatas",e)};c.prototype.initLock=function(){var f=this,e=f.columnModel;f.col_lock_count=0;d.each(f.columnModel,function(g,h){if(h.initLock){f.col_lock_count++}});if(f.col_lock_count){f.doLock()}};c.prototype.colLock=function(i,e){var j=this,h,f,g;if(j.isTemplate){return}if(d.type(i)==="number"){f=parseInt(i,10);if(f<0||f>j.columnModel.length-1){return}g=j.columnModel[f];h=g.th}else{h=i;f=h.data("index");g=j.columnModel[f]}if(g===j.editBtnsColumn){return}else{if(g.index===j.columnModel.length-1){return}}if(typeof g.locked==="undefined"){g.locked=false}if(g.locked===e){return}g.initLock=e;if(e){j.col_lock_count++}else{j.col_lock_count--}if(j.col_lock_count<0){j.col_lock_count=0}j.doLock()};c.prototype.fixedLockItem=function(i){var g=this,f=g.columnModel,l=g.$thead.find("> tr.datagrid-filter > th"),e=g.$lockTbody&&g.$lockTbody.find("> tr");if(!i){var j=function(o,n){n.clone().insertAfter(n);n.hide().insertAfter(o);o.remove()};if(l&&l.length){g.$lockThead&&g.$lockThead.find("> tr.datagrid-filter > th:visible").each(function(){var n=d(this),o=n.index(),p=l.eq(o);j(p,n)})}if(g.$lockThead){if(d.inArray(g.checkboxColumn,f)!=-1&&g.checkboxColumn.locked){var k=g.$lockThead.find("> tr:first > th."+g.classnames.td_checkbox),h=g.checkboxColumn.index,m=g.$thead.find("> tr:first > th:eq("+h+")");j(m,k)}}if(e&&e.length){e.each(function(){var o=d(this),n=o.index(),s,t,r=function(v,u,w){s=g.$tbody.find("> tr:eq("+u+")");t=s.find("> td:eq("+w+")");v.clone().insertAfter(v);v.hide().insertAfter(t);t.remove()};if(o.hasClass(g.classnames.tr_edit)){var p=o.find("> td:eq("+f.lockIndex+")"),q=p.index();if(p.hasClass(g.classnames.td_edit)){r(p,n,q)}}if(d.inArray(g.checkboxColumn,f)!=-1&&g.checkboxColumn.locked){o.find("> td."+g.classnames.td_checkbox).each(function(){var u=d(this),v=g.checkboxColumn.index;r(u,n,v)})}})}}else{var j=function(o,n){o.clone().html("").insertAfter(o);o.show().insertAfter(n);n.remove()};if(l&&l.length){g.$lockThead.find("> tr.datagrid-filter > th:visible").each(function(){var n=d(this),o=n.index(),p=l.eq(o);j(p,n)})}if(g.$lockThead){if(d.inArray(g.checkboxColumn,f)!=-1&&g.checkboxColumn.locked){var k=g.$lockThead.find("> tr:first > th."+g.classnames.td_checkbox),h=g.checkboxColumn.index,m=g.$thead.find("> tr:first > th:eq("+h+")");j(m,k)}}if(e&&e.length){e.each(function(){var o=d(this),n=o.index(),q,r,p=function(t,s,u){q=g.$tbody.find("> tr:eq("+s+")");r=q.find("> td:eq("+u+")");r.clone().insertAfter(r);r.show().insertAfter(t);t.remove()};if(o.hasClass(g.classnames.tr_edit)){o.find("> td."+g.classnames.td_edit+":visible").each(function(){var t=d(this),u=t.index(),s=f[u];if(s.locked){p(t,n,u)}})}if(d.inArray(g.checkboxColumn,f)!=-1&&g.checkboxColumn.locked){o.find("> td."+g.classnames.td_checkbox).each(function(){var s=d(this),t=g.checkboxColumn.index;p(s,n,t)})}})}}};c.prototype.doLock=function(){var n=this,s=n.options,l=n.tools,m=n.columnModel,f=n.$tableH.width(),g=0,h,i,e=0;var k=n.$boxF&&true,o=0;if(!n.$lockBox||!n.$lockBox.length){n.$lockBox=d('<div class="datagrid-box-l"></div>');n.$lockH=d('<div class="datagrid-box-h"></div>');n.$lockB=d('<div class="datagrid-box-b"></div>');n.$lockF=d('<div class="datagrid-box-f"></div>');n.$lockTableH=d('<table class="table table-bordered"></table>');n.$lockTableB=d("<table></table>").addClass(n.$tableB.attr("class"));n.$lockTableF=d('<table class="table table-bordered"></table>');n.$lockH.append(n.$lockTableH);n.$lockB.append(n.$lockTableB);n.$lockF.append(n.$lockTableF);n.$lockBox.append(n.$lockH).append(n.$lockB).prependTo(n.$grid);if(k){n.$lockBox.append(n.$lockF);n.$lockF.css("margin-top",(n.$boxB.outerHeight()-n.$boxB[0].clientHeight)).height(n.$boxF.outerHeight())}}else{n.fixedLockItem();n.$lockTableH.empty();n.$lockTableB.empty();n.$lockTableF&&n.$lockTableF.empty()}if(n.$boxT){o+=n.$boxT.outerHeight()}if(n.$toolbar){o+=n.$toolbar.outerHeight()}if(o){n.$lockBox.css({top:o})}d.each(m,function(t,u){u.lockShow=false;u.lockHide=false;if(u.initLock){if(u.hidden){l.showhide(u,true)}u.lockHide=true;u.locked=true;u.lockIndex=e++;g+=u.width}else{u.lockShow=true;if(!u.hidden){l.showhide(u,false)}else{u.lockShow=false}if(u.locked){u.lockShow=true}u.locked=false}});n.$lockThead=n.$thead.clone(true);n.$lockTbody=n.$tbody.clone();n.$lockColgroupH=n.$colgroupH.clone();n.$lockColgroupB=n.$colgroupB.clone();n.$lockTableH.append(n.$lockColgroupH).append(n.$lockThead).css("width",g);n.$lockTableB.append(n.$lockColgroupB).append(n.$lockTbody).css("width",g);if(k){n.$lockTfoot=n.$tableF.find("> thead").clone();n.$lockColgroupF=n.$colgroupF.clone();n.$lockTableF.append(n.$lockColgroupF).append(n.$lockTfoot).css("width",g)}d.each(n.columnModel,function(t,u){if(u.lockShow){l.showhide(u,true)}if(u.lockHide){l.showhide(u,false)
    }});n.$boxH.find("> div").css("width","");n.$boxB.find("> div").css("width","");n.$boxF&&n.$boxF.find("> div").css("width","");setTimeout(function(){var t=n.$boxB.find("> div").width();n.$boxB.find("> div").width(t);n.$boxH.find("> div").width(t);n.$boxF&&n.$boxF.find("> div").width(t)},50);if(!n.col_lock_count){n.$lockBox.hide()}else{n.$lockBox.show()}n.$tbody.find("> ."+n.classnames.tr_child+", .datagrid-nodata").each(function(){d(this).find("> td").attr("colspan",n.columnModel.length-n.col_lock_count)});if(g>1){g=g-1}n.$boxH.css("margin-left",g);n.$boxB.css("margin-left",g);if(k){n.$boxF.css("margin-left",g)}n.$lockB.height(n.$boxB[0].clientHeight);n.$lockB.prop("scrollTop",n.$boxB[0].scrollTop);var p=n.$lockTableH.height(),q=n.$thead.height(),j=n.$lockTableF&&n.$lockTableF.height(),r=n.$tableF&&n.$tableF.height();if(p!=q){if(p<q){n.$lockTableH.height(q)}else{n.$tableH.height(p)}}if(j&&r&&(j!=r)){if(j<r){n.$lockTableF.find("> thead > tr:first-child > th:visible:first").height(r)}else{n.$tableF.find("> thead > tr:first-child > th:visible:first").height(j)}}i=n.$lockTbody.find("> tr");h=n.$tbody.find("> tr");setTimeout(function(){var u=n.$lockTableB.height(),t=n.$tableB.height();if(u!=t){if(u>t){i.each(function(w){var v=d(this),y=v.find("> td:visible:first"),x=y.outerHeight();if(x>30){v.height(x);h.eq(w).height(x)}})}else{h.each(function(v){var x=d(this),y=x.find("> td:visible:first"),w=y.outerHeight();if(w>30){x.height(w);i.eq(v).height(w)}})}}},20);n.fixedLockItem(1);i.find("> td:hidden").remove();n.initLockEvents(i)};c.prototype.initLockEvents=function(f){if(!this.$lockTbody){return}var g=this,e=g.options;if(!f){f=g.$lockTbody.find("> tr")}f.on("click.bjui.datagrid.tr",function(i){var h=d(this).index(),j=d(i.target).closest("td");g.$tbody.find("> tr:eq("+h+")").trigger("click.bjui.datagrid.tr")}).on("delete.bjui.datagrid.tr",function(j,h){var i=d(this);if(g.linenumberColumn&&g.linenumberColumn.locked){i.nextAll(":not(."+g.classnames.tr_child+")").each(function(){var l=d(this).find("> td."+g.classnames.td_linenumber),k=parseInt(l.text(),10);l.text(k-1)})}}).on("mouseenter.bjui.datagrid",function(j){var i=d(this),h=i.index();i.addClass("datagrid-hover");g.$tbody.find("> tr:eq("+h+")").addClass("datagrid-hover")}).on("mouseleave.bjui.datagrid",function(j){var i=d(this),h=i.index();i.removeClass("datagrid-hover");g.$tbody.find("> tr:eq("+h+")").removeClass("datagrid-hover")});if(e.contextMenuB){f.each(function(){g.tools.contextmenuB(d(this),true)})}};c.prototype.filterInThead=function(f){var j=this,o=j.options,g=j.tools,e=j.regional,i=j.columnModel,l={};var h=f?d('<ul class="datagrid-thead-dialog-view-ul"></ul>'):d('<tr class="datagrid-filter"></tr>');var n=function(t,p,r){var q=p.type,s;if(r.isTag("th")){s=j.$headFilterUl&&j.$headFilterUl.find("> li.li-"+p.index)}else{if(r.isTag("li")){s=j.$thead.find("> tr.datagrid-filter > th:eq("+p.index+")")}}if(s){t.val(s.find("input").val());if(t.isTag("select")){t.val(s.find("select").val()).selectpicker("refresh")}}if(q==="date"){t.change(function(){k(p,t.val())})}else{if(q==="findgrid"){t.change(function(){k(p,t.val())})}else{if(q==="tags"){r.on("aftercreated.bjui.tags",'[data-toggle="tags"]',function(v,u){k(p,u.value)});t.change(function(){k(p,t.val())})}else{t.change(function(){k(p,t.val())})}}}t.change(function(){if(r.isTag("th")&&!s){s=j.$headFilterUl&&j.$headFilterUl.find("> li.li-"+p.index)}s&&s.find("input").val(t.val());if(t.isTag("select")){s&&s.find("select").val(t.val()).selectpicker("refresh")}})};var k=function(p,q){g.quickFilter(p,q?{operatorA:"like",valA:q}:null)};var m=(typeof o.initFilter==="object")&&o.initFilter;if(!j.inputs||!j.inputs.length){g.initEditInputs()}d.each(i,function(q,t){if(f){if(t===j.linenumberColumn||t===j.checkboxColumn||t===j.editBtnsColumn||t===j.childColumn){return true}}var s=d(j.inputs[q]),r=f?d("<li></li>"):d("<th></th>"),p="";if(!t.quickfilter){r.appendTo(h);return true}else{if(t.type==="findgrid"){s.data("context",h)}else{if(t.type==="spinner"){s=d('<input type="text" name="'+t.name+'">')}else{if(t.type==="boolean"){s=d(BJUI.doRegional('<select name="'+t.name+'" data-toggle="selectpicker"><option value="">#all#</option><option value="true">#true#</option><option value="false">#false#</option></select>',e))}else{if(t.type==="select"){if(t.attrs&&typeof t.attrs==="object"){d.each(t.attrs,function(u,v){p+=" "+u+"="+v})}if(s.find("> option:first-child").val()&&(!t.attrs||!t.attrs.multiple)){s=d('<select name="'+t.name+'" data-toggle="selectpicker"'+p+"></select>").append(BJUI.doRegional('<option value="">#all#</option>',e)).append(s.html());s.val("")}}}}}}if(f){r.data("index",q).addClass("li-"+q).append('<a href="javascript:;" class="datagrid-thead-dialog-sort" title="'+BJUI.getRegional("datagrid.asc")+"/"+BJUI.getRegional("datagrid.desc")+'">'+t.label+"</a>")}r.append(s);if(t.hidden){r.hide()}if(t.type==="boolean"&&!f){r.attr("align","center")}r.appendTo(h);s.data("clearFilter",false);n(s,t,r);s.on("clearfilter.bjui.datagrid.thead",function(){s.val("");
        if(t.type==="boolean"||t.type==="select"){s.selectpicker("refresh")}});t.$quickfilter=s;if(m&&typeof m[t.name]!=="undefined"){j.tools.initFilter(s,t)}});if(f){h.prepend("<li><label>"+BJUI.getRegional("datagrid.asc")+"/"+BJUI.getRegional("datagrid.desc")+'</label><span class="quicksort-title">'+BJUI.getRegional("datagrid.filter")+"</span></li>");h.hide().appendTo(j.$grid).initui();j.$headFilterUl=h;j.sortModels=!j.sortModels?[]:j.sortModels;h.off("click.datagrid.thead.quicksort").on("click.datagrid.thead.quicksort","a.datagrid-thead-dialog-sort",function(s){var r=d(this),p=j.columnModel[r.closest("li").data("index")],q=[];r.find("> i").remove();j.tools.quickSort(p);if(p.sortDesc){r.append('<i class="fa fa-long-arrow-down"></i>');j.sortModels[p.index]=p}else{if(p.sortAsc){r.append('<i class="fa fa-long-arrow-up"></i>');j.sortModels[p.index]=p}else{delete j.sortModels[p.index]}}if(!j.sortData||d.isEmptyObject(j.sortData)){j.sortModels=[]}d.each(j.sortModels,function(t,u){if(u){q.push('<i class="datagrid-sort-i fa fa-long-arrow-'+(u.sortAsc?"up":"down")+'"></i> '+u.label)}});j.$boxH.find(".datagrid-thead-dialog-filter-msg > .msg-sort").html(q.length>0?q.join("<em>&nbsp;&gt;&nbsp;</em>"):"")})}else{h.appendTo(j.$thead).initui()}};c.prototype.showLinenumber=function(m){var l=this,q=l.options,i=l.columnModel,o,n=-1,h=l.data,j=d.inArray(l.linenumberColumn,i);if(j!=-1){o=i[j]}if(o){if(typeof m==="string"&&(m==="lock"||m==="unlock")){l.colLock(o.th,m==="lock"?true:false)}else{l.showhideColumn(o.th,m?true:false)}}else{if(m){n=d.inArray(l.childColumn,i);n++;o=l.linenumberColumn;o.index=n;i.splice(n,0,o);if(l.inputs&&l.inputs.length){l.inputs=l.inputs.splice(n,0,"")}var f=l.$thead.find("> tr"),e='<col style="width:30px;">',p,k=f.filter(".datagrid-filter"),g=f.length-k.length;p=d('<th align="center"'+(g>1?' rowspan="'+g+' "':"")+'class="'+l.classnames.td_linenumber+(g==1?" single-row":"")+'"><div><div class="datagrid-space"></div><div class="datagrid-label">'+l.linenumberColumn.label+"</div></div></th>");l.$colgroupH.find("> col:eq("+n+")").before(e);l.$colgroupB.find("> col:eq("+n+")").before(e);l.$colgroupF&&l.$colgroupF.find("> col:eq("+n+")").before(e);k.length&&k.find("> th:eq("+n+")").before("<th></th>");f.first().find("> th:eq("+n+")").before(p);l.$tableF&&l.$tableF.find("> thead > tr > th:eq("+n+")").before("<th></th>");o.th=p;o.width=30;l.$tbody.find("> tr").each(function(t){var u=d(this),v=l.columnModel.length,s=t,r=l.paging;if(u.hasClass(l.classnames.tr_child)||u.hasClass("datagrid-nodata")){u.find("> td").attr("colspan",v)}else{s=l.tools.getNoChildDataIndex(s);if(q.linenumberAll){s=((r.pageCurrent-1)*r.pageSize+(s))}u.find("> td:eq("+n+")").before('<td align="center" class="'+l.classnames.td_linenumber+'">'+(s+1)+"</td>")}});l.$tableF&&l.$tableF.find("> thead > tr > th:eq("+n+")").before("<th></th>");d.each(i,function(r,s){s.index=r;if(s.th){s.th.data("index",r)}});p.find("> div").height(p.outerHeight());if(m==="lock"){l.colLock(p,true)}if(l.$showhide){l.$showhide.remove();l.colShowhide(q.columnShowhide)}}}};c.prototype.showCheckboxcol=function(n){var m=this,r=m.options,k=m.columnModel,p=k[0],i,o=-1,e=d.inArray(m.checkboxColumn,k);if(e!=-1){i=m.columnModel[e]}if(i){if(typeof n==="string"&&(n==="lock"||n==="unlock")){m.colLock(i.th,n==="lock"?true:false)}else{m.showhideColumn(i.th,n)}}else{if(n){o=d.inArray(m.linenumberColumn,k);if(o==-1){o=d.inArray(m.childColumn,k)}o++;i=m.checkboxColumn;i.index=o;k.splice(o,0,i);if(m.inputs&&m.inputs.length){m.inputs=m.inputs.splice(o,0,"")}var h=m.$thead.find("> tr"),g='<col style="width:30px;">',q,f,l=h.filter(".datagrid-filter"),j=h.length-l.length;q=d('<th align="center"'+(j>1?' rowspan="'+j+' "':"")+'class="'+m.classnames.td_checkbox+(j==1?" single-row":"")+'"><div><div class="datagrid-space"></div><div class="datagrid-label"><input type="checkbox" data-toggle="icheck"></div></th>');m.$colgroupH.find("> col:eq("+o+")").before(g);m.$colgroupB.find("> col:eq("+o+")").before(g);m.$colgroupF&&m.$colgroupF.find("> col:eq("+o+")").before(g);l.length&&l.find("> th:eq("+o+")").before("<th></th>");h.first().find("> th:eq("+o+")").before(q);m.$tableF&&m.$tableF.find("> thead > tr > th:eq("+o+")").before("<th></th>");q.initui();i.th=q;i.width=30;m.$tbody.find("> tr").each(function(s){var t=d(this),u=m.columnModel.length;if(t.hasClass(m.classnames.tr_child)||t.hasClass("datagrid-nodata")){t.find("> td").attr("colspan",u)}else{f=d('<td align="center" class="'+m.classnames.td_checkbox+'"><input type="checkbox" data-toggle="icheck" name="datagrid.checkbox"></td>');t.find("> td:eq("+o+")").before(f);f.initui()}});d.each(k,function(s,t){t.index=s;if(t.th){t.th.data("index",s)}});q.find("> div").height(q.outerHeight());if(n==="lock"){m.colLock(q,true)}if(m.$showhide){m.$showhide.remove();m.colShowhide(r.columnShowhide)}}}};c.prototype.showEditCol=function(n){var l=this,p=l.options,j=l.columnModel,m=j[j.length-1],i=l.data;if(m===l.editBtnsColumn){l.showhideColumn(m.th,n?true:false)}else{if(n){var g=l.$thead.find("> tr"),f='<col style="width:110px;">',o,e,k=g.filter(".datagrid-filter"),h=g.length-k.length;
        m=l.editBtnsColumn;j.push(m);l.$colgroupH.append(f);l.$colgroupB.append(f);l.$colgroupF&&l.$colgroupF.append(f);o=d('<th align="center" rowspan="'+h+'">'+l.editBtnsColumn.label+"</th>");g.first().append(o);k.length&&k.append("<th></th>");o.initui().data("index",j.length-1);m.th=o;m.width=110;m.index=j.length-1;l.$tbody.find("> tr").each(function(q){var r=d(this),s=l.columnModel.length;if(r.hasClass(l.classnames.tr_child)||r.hasClass("datagrid-nodata")){r.find("> td").attr("colspan",s)}else{e=d('<td align="center" class="'+l.classnames.s_edit+'">'+BJUI.doRegional(FRAG.gridEditBtn,l.regional)+"</td>");r.append(e);e.initui()}});l.edit(l.$tbody.find("> tr"));l.$tableF&&l.$tableF.find("> thead > tr").append("<th></th>");if(l.$showhide){l.$showhide.remove();l.colShowhide(p.columnShowhide)}}}};c.prototype.colResize=function(){var g=this,h=g.tools,f=g.columnModel,e=g.$thead,i=g.$grid.find("> .resizeProxy");if(!i.length){i=d('<div class="resizeProxy" style="left:0; display:none;"></div>');i.appendTo(g.$grid)}e.find("> tr > th").each(function(j){var k=d(this),l=k.find("> div > ."+g.classnames.th_cell+"> ."+g.classnames.th_resizemark);l.on("mousedown.bjui.datagrid.resize",function(u){var v=g.$boxH.scrollLeft(),q=parseInt(g.$boxH.css("marginLeft")||0,10),o,t=k.data("index"),r=f[t],m=r.th.width(),n=g.$tbody.find("> tr"),p=g.$lockTbody&&g.$lockTbody.find("> tr"),w=g.$lockTableB&&g.$lockTableB.height(),y=g.$tableB.height(),x,s;if(isNaN(q)){q=0}o=h.getRight(k)-v+q;g.isResize=true;if(r.locked){o=h.getRight4Lock(r.lockIndex);if(r.lockWidth){m=r.lockWidth}}i.show().css({left:o,bottom:(g.$boxP?g.$boxP.outerHeight():0),cursor:"col-resize"}).basedrag({scop:true,cellMinW:20,relObj:i,move:"horizontal",event:u,stop:function(){var B=i.position().left,A=B-o,C=A+m,E=g.$tableH.width()+A,z=g.$lockTableH&&g.$lockTableH.width()+A;if(C<5){C=20}if(r.minWidth&&C<r.minWidth){C=r.minWidth}if(C!=m+A){E=E-A+(C-m);z=z-A+(C-m)}r.width=C;if(r.locked){if(z<(g.$grid.width()*0.75)){r.lockWidth=C;g.$lockColgroupH.find("> col:eq("+t+")").width(C);g.$lockColgroupB.find("> col:eq("+t+")").width(C);g.$lockColgroupF&&g.$lockColgroupF.find("> col:eq("+t+")").width(C);g.$lockTableH.width(z);g.$lockTableB.width(z);g.$lockTableF&&g.$lockTableF.width(z);var D=g.$lockBox.width();g.$boxH.css("margin-left",D-1);g.$boxB.css("margin-left",D-1);g.$boxH.find("> div").width(g.$boxH.width());g.$boxB.find("> div").width(g.$boxH.width());g.$boxF&&g.$boxF.css("margin-left",D-1);g.$colgroupH.find("> col:eq("+t+")").width(C);g.$colgroupB.find("> col:eq("+t+")").width(C);g.$colgroupF&&g.$colgroupF.find("> col:eq("+t+")").width(C)}}else{setTimeout(function(){g.$colgroupH.find("> col:eq("+t+")").width(C);g.$colgroupB.find("> col:eq("+t+")").width(C);g.$colgroupF&&g.$colgroupF.find("> col:eq("+t+")").width(C)},1)}setTimeout(function(){n.css("height","");s=g.$tableB.height();if(g.$lockTbody){p.css("height","");x=g.$lockTableB.height();if(x!=w||s!=y){if(x>s){p.each(function(G){var F=d(this),I=F.find("> td:eq("+r.lockIndex+")"),H=I.outerHeight();if(H>30){F.height(H);n.eq(G).height(H)}})}else{n.each(function(F){var H=d(this),I=H.find("> td:eq("+t+")"),G=I.outerHeight();if(G>30){H.height(G);p.eq(F).height(G)}})}}g.$lockB.height(g.$boxB[0].clientHeight)}if(r.calc){g.$tfoot&&g.$tfoot.trigger("resizeH.bjui.datagrid.tfoot")}g.isResize=false},10);i.hide();g.resizeFlag=true}})})})};c.prototype.colMenu=function(){var i=this,e=i.options,j=i.tools,h=i.regional,f=i.$trsH.find("> th."+i.classnames.th_menu),g=i.$grid.find("> ."+i.classnames.s_menu);if(!g.legnth){g=d(BJUI.doRegional(FRAG.gridMenu,h));g.hide().appendTo(i.$grid);i.$menu=g}i.colShowhide(e.columnShowhide);f.each(function(){var n=d(this),m=n.data("index"),l=i.columnModel[m],p=n.find("> div > ."+i.classnames.th_cell),k=p.find("> ."+i.classnames.btn_menu),o;if(!k.length){o=d('<button type="button" class="btn btn-default"><i class="fa fa-bars"></button>'),k=d('<div class="'+i.classnames.btn_menu+'"></div>').append(o);k.appendTo(p);o.click(function(){var z=n.closest("tr"),u=parseInt((n.attr("rowspan")||1),10),q=d(this).offset().left-i.$grid.offset().left-1,B=(i.$trsH.length-u)*25+(13*u)+11,A=g.find("> ul > li.datagrid-li-showhide"),v,t;var r=g.data("bjui.datagrid.menu.btn");if(r&&r.length){r.removeClass("active")}d(this).addClass("active");if(A.length&&i.$showhide){i.$showhide.appendTo(A);t=i.$showhide.data("width")}g.css({position:"absolute",top:B,left:q}).show().data("bjui.datagrid.menu.btn",o).siblings("."+i.classnames.s_menu).hide();v=g.outerWidth();var y=function(C){if(i.$boxH.width()-C<v){g.css({left:C-v+18}).addClass("position-right")}else{g.css({left:C}).removeClass("position-right")}};var s=function(C){i.$boxB.scroll(function(){var D=C.offset().left-i.$grid.offset().left-1;y(D)})};y(q);s(o);if(e.columnFilter){i.colFilter(n)}else{g.find("> ul > li."+i.classnames.li_filter).hide()}j.locking(n);var w=g.find("> ul > li."+i.classnames.li_asc),x=w.next();w.off("click.bjui.datagrid.sort").on("click.bjui.datagrid.sort",function(){if(l.sortDesc){l.sortDesc=false
    }else{l.sortAsc=false}j.quickSort(l)});x.off("click.bjui.datagrid.sort").on("click.bjui.datagrid.sort",function(){if(l.sortAsc){l.sortDesc=false}else{l.sortAsc=true}j.quickSort(l)});g.on("sort.bjui.datagrid.th",function(D,C){w.toggleClass("sort-active",C);x.toggleClass("sort-active",!C)})})}});i.$grid.on("click.bjui.datagrid.filter",function(m){var k=d(m.target),l=i.$grid.find("."+i.classnames.s_menu+":visible");if(l.length&&!k.closest("."+i.classnames.btn_menu).length){if(!k.closest("."+i.classnames.s_menu).length){l.hide().data("bjui.datagrid.menu.btn").removeClass("active")}}})};c.prototype.colShowhide=function(i){var h=this,f=h.options,k=h.tools,g=h.$menu,e=g.find("> ul"),j=e.find("> li."+h.classnames.li_showhide);if(i){if(!h.$showhide){k.createShowhide();k.showSubMenu(j,g,h.$showhide)}}else{j.hide()}};c.prototype.showhideColumn=function(g,i){var h=this,j=h.tools,f,e;if(d.type(g)==="number"){f=parseInt(g,10);if(f<0){return}}else{f=g.data("index")}e=h.columnModel[f];if(e){if(e.locked){if(i){return}else{h.colLock(e.th,i)}}j.showhide(e,i)}};c.prototype.colFilter=function(g,B){var o=this,f=o.options,A=o.tools,E=o.regional,u=g.data("bjui.datagrid.filter"),m=o.$menu,D=m.find("> ul > li."+o.classnames.li_filter);var j=o.columnModel[g.data("index")];if(!o.inputs||!o.inputs.length){A.initEditInputs()}if(j.quickfilter){D.show().find("."+o.classnames.s_filter).addClass("hide");if(!u||!u.length){u=d(BJUI.doRegional(FRAG.gridFilter.replaceAll("#label#",g.text()),E)).hide().appendTo(o.$grid);var n=g.data("index"),j=o.columnModel[n],h=j.type||"string",p=j.operator||[],G=u.find("span.filter-a"),F=u.find("span.filter-b"),y=d('<select data-toggle="selectpicker" data-container="true"></select>'),e=d(o.inputs[n]),z,x;e.removeAttr("data-rule").attr("size",10).addClass("filter-input");if(h==="string"||h==="findgrid"||h==="tags"){if(!p.length){p=["=","!=","like"]}if(h==="findgrid"){e.data("context",u)}}else{if(h==="number"||h==="int"||h==="spinner"){if(h==="spinner"){e.removeAttr("data-toggle")}if(!p.length){p=["=","!=",">","<",">=","<="]}}else{if(h==="date"){if(!p.length){p=["=","!="]}}else{if(h==="boolean"){if(!p.length){p=["=","!="]}e=d(BJUI.doRegional('<select name="'+j.name+'" data-toggle="selectpicker"><option value="">#all#</option><option value="true">#true#</option><option value="false">#false#</option></select>',E))}else{if(h==="select"){if(!p.length){p=["=","!="]}e.attr("data-width","80");if(e.find("> option:first-child").val()){e=d('<select name="'+j.name+'" data-toggle="selectpicker" data-width="80"></select>').append(BJUI.doRegional('<option value="">#all#</option>',E)).append(e.html())}}}}}}for(var w=0,v=p.length;w<v;w++){y.append('<option value="'+(p[w])+'">'+(p[w])+"</option>")}z=e;x=z.clone();G.append(y).append(e);F.append(y.clone()).append(x);g.data("bjui.datagrid.filter",u);u.appendTo(D);u.data("width",u.outerWidth()).hide().initui();var q=u.find("button.ok"),k=u.find("button.clear"),C=u.find("select"),s=C.first(),r=C.last(),t=C.eq(1);q.click(function(){var K=s.val(),l=z.val().trim(),J=r.val(),i=x.val().trim(),I=t.val();var H={};if(l.length){d.extend(H,{operatorA:K,valA:l})}if(i.length){if(l.length){d.extend(H,{andor:I})}d.extend(H,{operatorB:J,valB:i})}if(!d.isEmptyObject(H)){A.quickFilter(o.columnModel[g.data("index")],H);o.$grid.trigger("click");D.trigger("hidesubmenu.bjui.datagrid.th",[m,u])}else{k.trigger("click")}});k.click(function(){var i=o.columnModel[g.data("index")];C.find("> option:first").prop("selected",true);C.selectpicker("refresh");z.val("");x.val("");if(i.isFiltered){A.quickFilter(i,null);o.$grid.trigger("click");D.trigger("hidesubmenu.bjui.datagrid.th",[m,u])}})}A.showSubMenu(D,m,u.removeClass("hide"));m.find('> ul > li:not(".'+o.classnames.li_filter+'")').on("mouseover",function(){if(D.hasClass("active")){D.trigger("hidesubmenu.bjui.datagrid.th",[m,u])}})}else{D.hide()}};c.prototype.initPaging=function(){var l=this,C=l.tools,h=l.options,k=l.paging,t=BJUI.regional.pagination,v=FRAG.gridPaging,g=[],p=k.pageCount,E,z=[],m=BJUI.StrBuilder();E=C.getPageInterval(p,k.pageCurrent,k.showPagenum);for(var x=E.start;x<E.end;x++){g.push(FRAG.gridPageNum.replace("#num#",x).replace("#active#",(k.pageCurrent==x?" active":"")))}v=BJUI.doRegional(v.replaceAll("#pageCurrent#",k.pageCurrent).replaceAll("#count#",k.total+"/"+parseInt((p||0),10)),t);m.add('<div class="paging-content" style="width:'+l.$boxB.width()+'px;">').add('<span></span><div class="paging-pagesize"><button type="button" class="btn-default btn-refresh" title="'+t.refresh+'" data-icon="refresh"></button>').add('<select data-toggle="selectpicker"></select>').add("</div>").add('<div class="paging-box">').add(v.replace("#pageNumFrag#",g.join(""))).add("</div>").add("</div>");l.$boxP.html(m.toString());l.$boxP.initui();var A=l.$boxP.find("div.paging-pagesize > select"),f=l.$boxP.find("ul.pagination"),j=f.find("> li.page-total"),s=j.next(),F=s.next(),B=F.next(),D=B.nextAll(".page-next"),r=D.next();var o=function(){F.addClass("disabled");B.addClass("disabled")
    };var w=function(){F.removeClass("disabled");B.removeClass("disabled")};var q=function(){D.addClass("disabled");r.addClass("disabled")};var y=function(){D.removeClass("disabled");r.removeClass("disabled")};var n=function(){o();y()};var u=function(){w();q()};var e=function(i){A.empty();if(!i){i=l.paging.pageSize}z=k.selectPageSize.split(",");z.push(String(i));d.unique(z).sort(function(I,H){return I-H});var G=[];d.each(z,function(H,I){G.push('<option value="'+I+'"'+(I==k.pageSize&&"selected")+">"+I+"/"+t.page+"</option>")});A.html(G.join("")).selectpicker("refresh")};if(k.pageCurrent==1){n()}if(k.pageCurrent==k.pageCount){u();if(k.pageCurrent==1){o()}}if(!k.total){q()}e();l.$boxP.on("click.datagrid.pagenum","li.page-num",function(G){var i=d(this);if(!i.hasClass("active")){l.jumpPage(i.text())}G.preventDefault()}).on("click.datagrid.refresh","button.btn-refresh",function(){l.refresh()}).on("bjui.datagrid.paging.jump",function(K){var J=l.paging.pageCurrent,G=C.getPageInterval(l.paging.pageCount,J,k.showPagenum),I=[];for(var H=G.start;H<G.end;H++){I.push(FRAG.gridPageNum.replace("#num#",H).replace("#active#",(J==H?" active":"")))}f.find("> li.page-num").remove();B.after(I.join(""));if(J==1){n();if(J==l.paging.pageCount){q()}if(!l.paging.total){q()}}else{if(J==l.paging.pageCount){u()}else{w();y()}}s.find("input").val(J);j.find("> span").html(l.paging.total+"/"+l.paging.pageCount)}).on("bjui.datagrid.paging.pageSize",function(G,i){e(i)}).on("change","div.paging-pagesize > select",function(){var i=d(this).val();l.jumpPage(null,i)});s.find("input").on("keyup",function(G){if(G.which===BJUI.keyCode.ENTER){var i=d(this).val();if(i){l.jumpPage(i)}}});F.on("click",function(){if(l.paging.pageCurrent>1){l.jumpPage(1)}});B.on("click",function(){if(l.paging.pageCurrent>1){l.jumpPage(l.paging.pageCurrent-1)}});D.on("click",function(){if(l.paging.pageCurrent<l.paging.pageCount){l.jumpPage(l.paging.pageCurrent+1)}});r.on("click",function(){if(l.paging.pageCurrent<l.paging.pageCount){l.jumpPage(l.paging.pageCount)}})};c.prototype.jumpPage=function(i,e){var h=this,f=h.paging,g=f.pageCount;if(i&&isNaN(i)){return}if(e&&isNaN(e)){return}if(i){i=parseInt(i,10);if(i<1){i=1}if(i>g){i=g}if(i==f.pageCurrent){return}}if(e){e=parseInt(e,10);if(h.options.local!="remote"){if(f.pageSize>f.total){return}}}h.tools.jumpPage(i,e)};c.prototype.add=function(j,w,v){if(!this.tools.beforeEdit()&&!v){return}if(!this.options.editUrl&&!v){BJUI.debug("BJUI.Datagrid: Edit url is not set!");return}if(!this.options.editMode&&!v){return}if(!this.options.inlineEditMult){this.doCancelEditRow(this.$tbody.find("> tr."+this.classnames.tr_edit))}else{if(!v&&this.options.editMode!="inline"&&this.$tbody.find("> tr."+this.classnames.tr_add).length){return}}if(!w){w={}}else{if(typeof w==="string"){w=w.toObj()}if(typeof w!=="object"){w={}}}var m=this,g=m.options,p=g.keys,u=m.tools,k=m.paging,o,n={},x=[],h,q=(k.pageCurrent-1)*k.pageSize,f;var i=function(){var z=d("<tr></tr>").addClass(m.classnames.tr_add),y=z.clone();if(m.isTemplate){var B=g.tdTemplate,A=m.columnModel.length;if(typeof B==="function"){B=B.apply(m,[{}])}if(m.options.hasChild&&m.options.childOptions){z.append('<td data-title="..." align="center" class="datagrid-child-td"><div>'+BJUI.doRegional(FRAG.gridExpandBtn,m.regional)+"</div></td>");A--}if(m.options.showLinenumber){z.append('<td data-title="No." align="center" class="datagrid-linenumber-td">0</td>');A--}if(m.options.showCheckboxcol){z.append('<td data-title="Checkbox" align="center" class="datagrid-checkbox-td"><div><input type="checkbox" data-toggle="icheck" name="datagrid.checkbox" value="true"></div></td>');A--}z.append('<td class="datagrid-template-td" colspan="'+A+'">'+B+"</td>")}else{d.each(m.columnModel,function(D,F){var C="",E=d("<td></td>");if(F[p.gridChild]){E.addClass(m.classnames.td_child).html("<div>"+BJUI.doRegional(FRAG.gridExpandBtn,m.regional)+"</div>")}else{if(F[p.gridNumber]){E.addClass(m.classnames.td_linenumber).text(0)}else{if(F[p.gridCheckbox]){E.addClass(m.classnames.td_checkbox).html('<div><input type="checkbox" data-toggle="icheck" name="datagrid.checkbox" value="true"></div>')}else{if(F[p.gridEdit]){E.addClass(m.classnames.s_edit).data("isAdd",true).html(BJUI.doRegional(FRAG.gridEditBtn,m.regional))}else{E.text("")}}}}if(F.hidden){E.css("display","none")}if(F.align){E.attr("align",F.align)}if(F.name){n[F.name]=""}if(F.locked){if(F[p.gridCheckbox]){E.clone().hide().appendTo(z);E.show().appendTo(y)}else{E.clone().show().appendTo(y);E.hide().appendTo(z)}}else{E.appendTo(z)}})}n=d.extend({},m.attach,n);if(!m.emptyData){m.emptyData=n}return{tr:z,lockTr:y.find("> td").length?y:null}};if(!j){j=g.addLocation||"first"}if(!m.$lastSelect){if(j==="prev"){j="first"}else{if(j==="next"){j="last"}}}if(d.inArray(j,["first","last","prev","next"])===-1){j="first"}if(g.isTree&&m.$lastSelect){if(!(j==="first"||j==="last")){j="first"}var r=m.data[m.tools.getNoChildDataIndex(m.$lastSelect.index())];if(r){w[g.treeOptions.keys.level]=r[g.treeOptions.keys.level]+1;
        w[g.treeOptions.keys.parentKey]=r[g.treeOptions.keys.key];w[g.keys.treePTr]=m.$lastSelect;w[g.keys.treePData]=r}else{w["level"]=0}}if(j==="first"){f=0;o=i();if(g.isTree&&m.$lastSelect){f=m.tools.getNoChildDataIndex(m.$lastSelect.index())+1;if(m.$lastSelect.next().hasClass(m.classnames.tr_child)){o.tr.insertAfter(m.$lastSelect.next());if(o.lockTr){o.lockTr.insertAfter(m.$lockTbody.find("> tr:eq("+m.$lastSelect.next().index()+")"))}}else{o.tr.insertAfter(m.$lastSelect);if(o.lockTr){o.lockTr.insertAfter(m.$lockTbody.find("> tr:eq("+m.$lastSelect.index()+")"))}}}else{o.tr.prependTo(m.$tbody);if(o.lockTr){o.lockTr.prependTo(m.$lockTbody)}}}else{if(j==="last"){f=m.$tbody.find("> tr").length;o=i();if(g.isTree&&m.$lastSelect){var l=m.$lastSelect.data("child")||0,e=m.$lastSelect.data("level"),s,t=m.$lastSelect.next().hasClass(m.classnames.tr_child);s=m.getChildrens(m.$lastSelect,m.$lastSelect).last();if(t){o.tr.insertAfter(s.next());if(o.lockTr){o.lockTr.insertAfter(m.$lockTbody.find("> tr:eq("+s.next().index()+")"))}}else{o.tr.insertAfter(s);if(o.lockTr){o.lockTr.insertAfter(m.$lockTbody.find("> tr:eq("+s.index()+")"))}}f=m.tools.getNoChildDataIndex(s.index())+1;w[g.treeOptions.keys.order]=l}else{o.tr.appendTo(m.$tbody);if(o.lockTr){o.lockTr.appendTo(m.$lockTbody)}}}else{if(j==="prev"){f=m.tools.getNoChildDataIndex(m.$lastSelect.index());o=i();o.tr.insertBefore(m.$lastSelect);if(o.lockTr){o.lockTr.insertBefore(m.$lockTbody.find("> tr:eq("+m.$lastSelect.index()+")"))}}else{if(j==="next"){f=m.tools.getNoChildDataIndex(m.$lastSelect.index())+1;o=i();if(m.$lastSelect.next().hasClass(m.classnames.tr_child)){o.tr.insertAfter(m.$lastSelect.next());if(o.lockTr){o.lockTr.insertAfter(m.$lockTbody.find("> tr:eq("+m.$lastSelect.next().index()+")"))}}else{o.tr.insertAfter(m.$lastSelect);if(o.lockTr){o.lockTr.insertAfter(m.$lockTbody.find("> tr:eq("+m.$lastSelect.index()+")"))}}}}}}w=d.extend({},m.emptyData,w,{addFlag:true});if(!m.data){m.data=[]}if(!m.allData){m.allData=[]}if(m.allData.length){m.allData.splice(f+q,0,w)}else{m.allData.push(w)}if(m.data.length){m.data.splice(f,0,w)}else{m.data.push(w)}m.tools.updateGridIndex();o.tr.initui();o.lockTr&&o.lockTr.initui();if(w[g.keys.treePTr]){o.tr.data(g.keys.treePTr,w[g.keys.treePTr])}if(g.showNoDataTip){m.$tbody.find("> tr.datagrid-nodata").remove()}if(g.height==="auto"){m.fixedHeight()}setTimeout(function(){m.initEvents(o.tr)},20);if(o.lockTr){m.initLockEvents(o.lockTr)}m.edit(o.tr);if(g.hasChild&&g.childOptions){o.tr.after('<tr class="'+m.classnames.tr_child+'"></tr>')}if(v){m.inlineEditComplete(o.tr,w);if(m.data.length==1){m.needfixedWidth=true}m.tools.afterSave(o.tr,w)}else{if(g.editMode!="dialog"){m.doEditRow(o.tr,"inline",true)}else{m.dialogEdit(o.tr,true)}}};c.prototype.edit=function(g){var k=this,o=k.options,h=k.tools,l=o.editMode,i=k.columnModel,e;k.editInit=false;if(!l){return}if(typeof l==="object"){var n={},j=["dialog","navtab","div"],f=false;k.editOptions=null;for(var m in l){if(d.inArray(m,j)!=-1){n.type=m;n.options=l[m];f=true;break}}if(!f){BJUI.debug("Dialog Plugn: The options 'editModel' set error!");return}if(!d.isEmptyObject(n)){k.editOptions=n}}else{if(k.options.editUrl){k.options.editUrl=k.options.editUrl.replace(/{\/?[^}]*}/g,"")}if(l!="dialog"){l="inline"}}if(!g){g=k.$tbody.find("> tr")}e=g.find("> td."+k.classnames.s_edit);k.editInit=true;e.each(function(){var v=d(this),t=v.find("button.bjui-datagrid-btn"),s=t.first(),r=s.next(),q=r.next(),u=q.next(),p=u.next();s.on("click",function(B,A){var z=d(this),y=z.closest("tr"),w=y.index(),x=v.data("isAdd");w=k.tools.getNoChildDataIndex(w);if(!A){if(k.isDom){A=y.data("initData")||h.setDomData(y)}else{A=k.data[w]}}if(!h.beforeEdit(y,A)){return false}if(k.editOptions){k.externalEdit(y,null,A);return false}if(l!="dialog"){k.inlineEdit(y,x);t.hide();r.show();u.show();if(x){r.hide();q.show()}}else{k.dialogEdit(y,x)}B.stopPropagation()});q.on("click",function(y){var x=d(this),w=x.closest("tr");k.updateEdit(w,x);y.stopPropagation()}).on("bjui.datagrid.update.tr",function(){t.hide();s.show();p.show()});r.on("click",function(y){var x=d(this),w=x.closest("tr");k.updateEdit(w,x);y.stopPropagation()}).on("bjui.datagrid.update.tr",function(){t.hide();s.show();p.show()});u.on("click",function(y){var x=d(this),w=x.closest("tr");k.cancelEdit(w);t.hide();s.show();p.show();y.stopPropagation()});p.on("click",function(y){var x=d(this),w=x.closest("tr");k.delRows(w);y.stopPropagation()})})};c.prototype.externalEdit=function(p,k,f){var j=this,q=j.options,o={},h,g,e,m,i=["dialog","navtab","div"];if(k&&typeof k==="object"){for(var n in k){if(d.inArray(n,i)!=-1){o.type=n;o.options=k[n];break}}}else{o=d.extend({},j.editOptions)}if(p instanceof jQuery){h=p}else{if(!isNaN(p)){h=j.$tbody.find("> tr:not(."+j.classnames.tr_child+")").eq(parseInt(p,10))}else{BJUI.debug("BJUI.Datagrid: Func 'externalEdit', Parameter 'row' is incorrect!");return}}if(typeof o==="undefined"){BJUI.debug("BJUI.Datagrid: Func 'externalEdit', Parameter 'editOptions' is incorrect!");
        return}if(!d.isEmptyObject(o)){if(!f){if(j.isDom){f=h.data("initData")||j.tools.setDomData(h)}else{g=j.tools.getNoChildDataIndex(h.index());f=j.data[g]}}if(!o.options.url||o.options["datagrid.nourl"]){o.options["datagrid.nourl"]=true;o.options.url=q.editUrl}e=o.options.url;if(e&&!e.isFinishedTm()){if(!f||f.addFlag){e=e.replace(/{\/?[^}]*}/g,"")}else{e=j.tools.replacePlh(e,f)}if(!e.isFinishedTm()){BJUI.debug("BJUI.Datagrid: Func 'externalEdit', the property 'url' of options 'editOptions' is incorrect: "+e)}else{e=e}}if(e){o.options.url=e;m=o.type;if(typeof f==="object"&&f){if(o.options.data){d.extend(o.options.data,f)}else{o.options.data=d.extend({},f)}}for(var n in q.keys){delete o.options.data[n]}if(!o.options.id){o.options.id="datagrid-external-edit"+(new Date().getTime())}if(!o.options.type){o.options.type=q.editType}if(typeof q.extOnClose==="undefined"){q.extOnClose=(o.options.onClose&&o.options.onClose.toFunc())||false}o.options.onClose=function(){if(h.hasClass(j.classnames.tr_add)){j.cancelEdit(h)}if(typeof q.extOnClose!=="undefined"){if(q.extOnClose){q.extOnClose.apply(j)}}};var l=function(s){var r=false,t,v=false;if(o.options.data["addFlag"]&&j.data.length==1){j.needfixedWidth=true}if(d.type(s)==="array"){r=true;t=s[0]}else{if(typeof s==="object"){r=true;t=s}}if(r){d.extend(f,typeof t==="object"&&t);if(j.allData&&j.allData[f.gridIndex]){d.extend(j.allData[f.gridIndex],f)}if(j.oldAllData){j.oldAllData=j.allData.concat()}if(f.addFlag){f.addFlag=false}j.dialogEditComplete(h,f);if(m==="dialog"){if(o.options.message){BJUI.alertmsg("ok",o.options.message)}if(typeof o.options.closeCurrent==="undefined"||o.options.closeCurrent){BJUI.dialog("close",o.options.id)}}else{if(m==="navtab"){BJUI.navtab("closeTab",o.options.id)}}j.tools.afterSave(h,f);if(f["refresh.datagrid.child"]){var u=h.data("bjui.datagrid.child");if(u&&u.length){u.datagrid("refresh")}else{j.showChild(h)}}}};o.options.onLoad=function(s){var r=s.find("form.datagrid-edit-form");if(r&&r.length){r=r.first();r.removeAttr("okCallback").data("okCallback",d.proxy(l,j))}};if(m==="dialog"){BJUI.dialog(o.options)}else{if(m==="navtab"){BJUI.navtab(o.options)}else{if(m==="div"){BJUI.ajax("doload",o.options)}}}}}};c.prototype.doEditRow=function(m,j,l){if(!this.editInit){return}var i=this,e,k,g=[];j=j||i.options.editMode;if(typeof m==="object"){e=m}else{if(isNaN(m)){var h=i.$tbody.find("> tr:not(."+i.classnames.tr_child+")"),f,m=m.split(",");m=m.unique();m.sort(function(o,n){return o.trim()-n.trim()});d.each(m,function(o,r){var q=parseInt(r.trim(),10),p;p=h.eq(q);if(p&&p.length){if(!f){f=p}else{f=f.add(p)}}});e=f}else{if(!isNaN(m)){e=i.$tbody.find("> tr:not(."+i.classnames.tr_child+")").eq(m)}}}if(!e.length){return}e.each(function(){var o=d(this),n=o.index(),p;n=i.tools.getNoChildDataIndex(n);if(i.isDom){p=o.data("initData")||tools.setDomData(o)}else{p=i.data[n]}g.push(p)});if(!i.tools.beforeEdit(e,g)){return}if(!i.options.editUrl){BJUI.debug("BJUI.Datagrid: Edit url is not set!");return}if(i.editOptions){i.externalEdit(e.last(),null,g[e.length-1])}else{e.each(function(n){var o=d(this);k=o.find("> td."+i.classnames.s_edit+" button.bjui-datagrid-btn.edit");if(j!="dialog"){if(k.length){k.trigger("click",[g[n]])}else{i.inlineEdit(o,l,g[n])}}else{i.dialogEdit(o,l,g[n]);return false}})}};c.prototype.doCancelEditRow=function(g){var f=this,e;if(d.type(g)==="number"){e=this.$tbody.find("> tr").eq(g)}else{e=g}e.each(function(){var i=d(this),h=i.find("> td."+f.classnames.s_edit+" > button.bjui-datagrid-btn.cancel");if(h.length){h.trigger("click")}else{f.cancelEdit(i)}})};c.prototype.doSaveEditRow=function(h){var g=this,e=g.options,f;if(d.type(h)==="number"){f=this.$tbody.find("> tr").eq(h)}else{if(h){f=h}else{f=g.$tbody.find("> tr."+g.classnames.tr_edit)}}if(!f.length){g.$grid.alertmsg("info",BJUI.getRegional("datagrid.saveMsg"));return}if(f.length==1){if(f.hasClass(g.classnames.tr_edit)){this.updateEdit(f)}}else{if(e.saveAll){g.saveAll(f)}else{f.each(function(){g.updateEdit(d(this))})}}};c.prototype.delRows=function(n){var j=this,o=j.options,m=o.keys,k=o.beforeDelete,h=o.delConfirm,f;if(k){if(typeof k==="string"){k=k.toFunc()}if(typeof k==="function"){if(!k.call(this)){return}}}if(typeof n==="object"){f=n}else{if(isNaN(n)){var i=j.$tbody.find("> tr:not(."+j.classnames.tr_child+")"),l,n=n.split(",");n=n.unique();n.sort(function(q,p){return q.trim()-p.trim()});d.each(n,function(p,r){var q=i.eq(parseInt(r.trim(),10));if(q&&q.length){if(!l){l=q}else{l=l.add(q)}}});f=l}else{if(!isNaN(n)){f=this.$tbody.find("> tr:not(."+j.classnames.tr_child+")").eq(n)}}}if(!f||!f.length){return}var e=function(){f.each(function(){var q=d(this),s=j.options.childUpdate,r=j.$element.data("bjui.datagrid.parent"),p=function(t){t.closest("table").datagrid("updateRow",t)};if(r&&s){if(typeof s==="string"){if(s.indexOf("all")!==-1||s.indexOf("del")!==-1){p(r)}}else{p(r)}}q.trigger("delete.bjui.datagrid.tr")});j.tools.afterDelete();if(o.height==="auto"){j.fixedHeight()}};var g=function(){var s=f.filter("."+j.classnames.tr_add);
        if(s.length){j.cancelEdit(s);if(!f.not(s).length){return}}if(o.delUrl){var p=[],t=o.delCallback;f.not(s).each(function(){var w=d(this),u=w.index(),x,y;if(j.isDom){x=w.data("initData")||j.tools.setDomData(w)}else{x=j.data[j.tools.getNoChildDataIndex(u)]}if(o.delPK){p.push(x[o.delPK])}else{if(o.jsonPrefix){y={};d.each(x,function(z,A){if(!j.tools.isGridData(z)){y[o.jsonPrefix+"."+z]=A}})}else{y=d.extend({},x);for(var v in m){delete y[m[v]]}}p.push(y)}});if(typeof t==="string"){t=t.toFunc()}var q=o.delType,r={url:o.delUrl,data:(o.delPK?[{name:o.delPK,value:p.join(",")}]:JSON.stringify(p)),type:"POST",okCallback:t||function(u){e()}};if(q&&q==="raw"&&!o.delPK){r.contentType="application/json"}else{!o.delPK&&(r.data={json:r.data});q&&q!=="raw"&&(r.type=q)}BJUI.ajax("doajax",r)}else{e()}};if(h){if(typeof h!=="string"){h=f.length==1?BJUI.getRegional("datagrid.delMsg"):BJUI.getRegional("datagrid.delMsgM")}j.$grid.alertmsg("confirm",h,{okCall:function(){g()}})}else{g()}};c.prototype.inlineEdit=function(j,n,g){if(!this.tools.beforeEdit(j,g)){return false}var l=this,o=l.options,i=l.tools,k=l.columnModel,f=j.find("> td"),e=f.length,m=j.index(),h=m;h=i.getNoChildDataIndex(h);if(!g){if(l.isDom){g=j.data("initData")||i.setDomData(j)}else{g=l.data[h]}}if(j.hasClass(l.classnames.tr_edit)){return false}if(!l.inputs||!l.inputs.length){i.initEditInputs()}j.addClass(l.classnames.tr_edit).data(l.datanames.changeData,{});if(j.data("validator")){j.validator("destroy")}if(!o.inlineEditMult){l.doCancelEditRow(j.siblings("."+l.classnames.tr_edit))}l.$lastEditTr=j;f.each(function(t){var p=d(this),v=k[t],r=v&&v.name&&g[v.name],u=p.html(),y=l.inputs[t],x;var w=function(B,F,E){var A=j.data(l.datanames.changeData),C=v.jsontype,G=(typeof v.defaultVal==="undefined")?null:v.defaultVal;switch(v.type){case"date":B.change(function(){F.addClass(l.classnames.td_changed);if(B.val()==E){F.removeClass(l.classnames.td_changed)}A[v.name]=B.val()});break;case"select":B.change(function(){var H=d(this).val();F.addClass(l.classnames.td_changed);if(H==String(E)){F.removeClass(l.classnames.td_changed)}if(B.prop("multiple")){d.isArray(H)&&(H=H.join(","))}else{if(C){if(C==="boolean"){H=Boolean(H)}else{if(C==="number"){if(H.length){!isNaN(Number(H))&&(H=Number(H))}else{H=null}}}}}A[v.name]=H});break;case"boolean":B.on("ifChanged",function(){F.toggleClass(l.classnames.td_changed);var H=d(this).is(":checked");if(H==E){F.removeClass(l.classnames.td_changed)}A[v.name]=H});break;case"findgrid":A[v.name]=B.val();B.change(function(){var H=d(this).val();F.addClass(l.classnames.td_changed);if(H==E){F.removeClass(l.classnames.td_changed)}if(C&&C==="number"){if(H.length){!isNaN(Number(H))&&(H=Number(H))}else{H=null}}A[v.name]=H});F.off("afterchange.bjui.findgrid").on("afterchange.bjui.findgrid",'[data-toggle="findgrid"]',function(J,I){var H=v.attrs&&v.attrs["data-options"]&&v.attrs["data-options"]["include"];if(H){d.each(H.split(","),function(M,O){var N=O.trim().split(":"),K=N[0],L=N.length>1?N[1]:N[0];I["data"]&&(A[K]=I["data"][L])})}});break;case"spinner":B.change(function(){F.addClass(l.classnames.td_changed);if(B.val()==E){F.removeClass(l.classnames.td_changed)}A[v.name]=Number(B.val())});break;default:B.change(function(){var H=d(this).val();F.addClass(l.classnames.td_changed);if(H==E){F.removeClass(l.classnames.td_changed)}if(C&&C==="number"){if(H.length){!isNaN(Number(H))&&(H=Number(H))}else{H=null}}A[v.name]=H});break}if(n){if(v.type==="boolean"){G=Boolean(G);A[v.name]=G;B.prop("checked",G)}else{if(G!=null){if(B.isTag("select")&&B.prop("multiple")){B.val(d.isArray(G)?G:G.split(","))}else{B.val(String(G))}if(C){if(C==="number"){if(G.length){!isNaN(Number(G))&&(G=Number(G))}else{G=null}}else{if(C==="boolean"){G=Boolean(G)}}}A[v.name]=G}else{if((B.isTag("select")&&!B.prop("multiple"))){var D=B.clone().appendTo("body"),E=D.val();A[v.name]=E;D.remove()}}}}else{if(C){B.trigger("change")}}};p.data(l.datanames.td_html,u);if(n){if(!v.add){y=""}}else{if(g.addFlag){g.addFlag=false}if(!v.edit){y=""}}if(y){x=d(y);if(typeof r==="undefined"||r==="null"||r===null){r=""}if(v.type==="boolean"){x.prop("checked",r)}else{if(v.type==="findgrid"){x.data("context",j).val(String(r))}else{x.val(String(r));if(x.isTag("select")&&x.prop("multiple")&&r&&!d.isArray(r)){x.val(r.split(","))}}}if(n){if(v.addAttrs&&typeof v.addAttrs==="object"){d.each(v.addAttrs,function(A,B){x.attr(A,B)})}}else{if(v.editAttrs&&typeof v.editAttrs==="object"){d.each(v.editAttrs,function(A,B){x.attr(A,B)})}}p.empty().append(x).addClass(l.classnames.td_edit);if(l.treeColumn&&l.treeColumn===v){var q=l.tools.createTreePlaceholder(g,"");p.attr("align","left").html(q);x.appendTo(p.find(".datagrid-tree-title"))}w(x,p,r);if(v.locked){var s=l.$lockTbody.find("tr:eq("+m+")");var z=s.find("> td:eq("+v.lockIndex+")");p.clone().html(u).insertAfter(p);p.show().insertAfter(z).initui();z.remove()}}if(!--e){j.initui().validator({msgClass:"n-bottom",theme:"red_bottom_effect_grid"})}})};c.prototype.saveAll=function(g){var o=this,t=o.options,s=t.keys,r=t.editCallback,m,i,l,k=[],p,j,f=[],h=[],n=g&&g.length;
        if(!g||g.length){g=o.$tbody.find("> tr."+o.classnames.tr_edit);n=g.length}if(!n){return}g.each(function(){m=d(this);l=o.tools.getNoChildDataIndex(m.index());i=o.isDom?m.data("initData"):o.data[l];k.push(i);m.isValid(function(u){if(u){p=m.data(o.datanames.changeData);d.extend(i,p);if(t.jsonPrefix){j={};d.each(i,function(v,x){if(!o.tools.isGridData(v)){j[t.jsonPrefix+"."+v]=x}})}else{j=d.extend({},i);for(var w in s){delete j[s[w]]}}n--;f.push(j)}else{f=[];return false}})});if(!n){if(r){r=r.toFunc()}else{r=function(u){if(d.type(u)==="array"){h=u}else{if(typeof u==="object"){h.push(u)}}g.each(function(v){m=d(this);l=m.index();if(o.columnModel[0]===o.childColumn){l=l/2}i=o.isDom?m.data("initData"):o.data[l];d.extend(i,typeof h[v]==="object"&&h[v]);if(o.allData&&o.allData[i.gridIndex]){d.extend(o.allData[i.gridIndex],i)}if(o.oldAllData){o.oldAllData=o.allData.concat()}o.inlineEditComplete(m,i)});o.tools.afterSave(g,f)}}if(o.options.saveLocal){r(f)}else{if(o.tools.beforeSave(g,k)){var q=t.editType,e={url:t.editUrl,data:JSON.stringify(f),type:"POST",okCallback:r};if(q&&q==="raw"){e.contentType="application/json"}else{e.data={json:e.data};q&&(e.type=q)}BJUI.ajax("doajax",e)}}}};c.prototype.updateEdit=function(k,n){var l=this,q=l.options,p=q.keys,o=q.editCallback,g,j=[],m,i,e=[],f,h=k.index();h=l.tools.getNoChildDataIndex(h);if(l.isDom){g=k.data("initData")}else{g=l.data[h]}if(k.hasClass(l.classnames.tr_edit)){k.isValid(function(r){if(r){m=k.data(l.datanames.changeData);d.extend(g,m);if(q.jsonPrefix){i={};d.each(g,function(v,w){if(!l.tools.isGridData(v)){i[q.jsonPrefix+"."+v]=w}})}else{i=d.extend({},g);for(var s in p){delete i[p[s]]}}if(o){o=o.toFunc()}else{o=function(v){if(d.type(v)==="array"){f=v[0]}else{if(typeof v==="object"){f=v}}d.extend(g,typeof f==="object"&&f);if(l.allData&&l.allData[g.gridIndex]){d.extend(l.allData[g.gridIndex],g)}if(l.oldAllData){l.oldAllData=l.allData.concat()}l.inlineEditComplete(k,g,n);l.tools.afterSave(k,g)}}j.push(g);if(l.tools.beforeSave(k,j)){e.push(i);var t=q.editType,u={url:q.editUrl,data:JSON.stringify(e),type:"POST",okCallback:o};if(t&&t==="raw"){u.contentType="application/json"}else{u.data={json:u.data};t&&(u.type=t)}BJUI.ajax("doajax",u)}}})}};c.prototype.cancelEdit=function(e){var g=this,f=g.columnModel;e.each(function(){var j=d(this),i=j.index(),h=i;if(j.hasClass(g.classnames.tr_edit)){j.removeClass(g.classnames.tr_edit).find("> td."+g.classnames.td_edit).each(function(){var p=d(this),o=p.index(),l=f[o],n=p.data(g.datanames.td_html);p.removeClass(g.classnames.td_edit).removeClass(g.classnames.td_changed).html(n);if(l.locked){var k=g.$lockTbody.find("tr:eq("+i+")");var m=k.find("> td:eq("+l.lockIndex+")");n=m.data(g.datanames.td_html);k.removeClass(g.classnames.tr_edit);m.removeClass(g.classnames.td_edit).removeClass(g.classnames.td_changed).html(n)}})}if(j.hasClass(g.classnames.tr_add)){h=g.tools.getNoChildDataIndex(h);if(!g.isDom){g.allData=g.allData.remove(g.data[h].gridIndex);g.data=g.data.remove(h);g.tools.updateGridIndex();g.$element.data("allData",g.allData)}if(j.next().hasClass(g.classnames.tr_child)){j.next().remove();g.$lockTbody&&g.$lockTbody.find("> tr:eq("+i+")").next().remove()}g.$lockTbody&&g.$lockTbody.find("> tr:eq("+i+")").remove();j.remove();g.tools.createNoDataTr();g.tools.afterCancel();if(g.options.height==="auto"){g.fixedHeight()}}})};c.prototype.inlineEditComplete=function(k,h,q){var m=this,l=m.columnModel,p=k.index(),e=k.find("> td"),r=false,g=m.$lockTbody&&m.$lockTbody.find("> tr:eq("+p+")");var j=m.options.tdTemplate,i=d.extend({},h);d.each(l,function(v,y){if(y===m.linenumberColumn){r=true}if(m.tools.isGridModel(y)){return true}var t=y.name?h[y.name]:"",x,w=e.eq(y.index);if(m.isTemplate){w=null}if(typeof t==="undefined"||t==="null"||t===null){t=""}w&&(w.text(t).removeClass(m.classnames.td_edit).removeClass(m.classnames.td_changed));if(y.render&&typeof y.render==="function"){if(y.items){x=y.render.call(m,t,h,y.items,y.itemattr);i[y.name]=x;w&&w.html(x)}else{x=y.render.call(m,t,h);i[y.name]=x;w&&w.html(x)}}else{if(y.items){x=c.renderItem.call(m,t,h,y.items,y.itemattr);i[y.name]=x;w&&w.html(x)}}if(m.options.isTree&&y.hasTree){w&&(w.attr("align","left").addClass("datagrid-tree-td").html(m.tools.createTreePlaceholder(h,(x||t))))}if(y.locked&&g){var u=g.find("> td:eq("+y.lockIndex+")");u.removeClass(m.classnames.td_changed).html(w.html())}});if(m.isTemplate){if(typeof j==="function"){j=j.apply(m,[h])}j=m.tools.replacePlh4Template(j,i);k.find("> td.datagrid-template-td").html(j)}k.removeClass(m.classnames.tr_edit).initui();if(g){g.removeClass(m.classnames.tr_edit).initui()}if(!q){q=e.filter("."+m.classnames.s_edit).find("button.update")}if(q&&q.length){q.trigger("bjui.datagrid.update.tr")}if(k.hasClass(m.classnames.tr_add)){k.removeClass(m.classnames.tr_add);k.find("> td."+m.classnames.s_edit).removeData("isAdd");if(r){m.tools.updateLinenumber()}if(m.options.isTree){var o=h[m.options.keys.treePTr],n=h[m.options.keys.treePData],s=m.options.treeOptions.keys,f;
        if(o&&n){if(!n[s.isParent]){n[s.isParent]=true;f=o.find("> td.datagrid-tree-td");f.html(m.tools.createTreePlaceholder(n,f.find("span.datagrid-tree-title").html()))}if(!n[s.childLen]){n[s.childLen]=1}else{n[s.childLen]++}k.data(m.options.keys.treePTr).data("child",n[s.childLen]).attr("data-child",n[s.childLen])}k.addClass("datagrid-tree-tr datagrid-tree-level-"+h[s.level]).attr("data-child",0).attr("data-level",h[s.level])}k.next("."+m.classnames.tr_child).remove();m.tools.createChildTr(k,h)}};c.prototype.dialogEdit=function(k,s,g){if(!this.tools.beforeEdit(k,g)){return false}var m=this,u=m.options,j=m.tools,l=m.columnModel,p=k.index(),i=p,e,t,h="",r;if(!g){i=j.getNoChildDataIndex(i);if(m.isDom){g=k.data("initData")||j.setDomData(k)}else{g=m.data[i]}}if(!m.inputs||!m.inputs.length){j.initEditInputs()}r=u.gridTitle||"datagrid";if(s){r+=" - "+BJUI.getRegional("datagrid.add")}else{if(g.addFlag){g.addFlag=false}r+=" - "+BJUI.getRegional("datagrid.edit")}e=d('<div><div class="bjui-pageContent"></div><div class="bjui-pageFooter"></div></div>');t=d('<form class="datagrid-dialog-edit-form"></form>');var n=function(x,D,C,w){var B=x.data(m.datanames.changeData),A=w.jsontype,y=(typeof w.defaultVal==="undefined")?null:w.defaultVal;switch(w.type){case"date":C.change(function(){B[w.name]=d(this).val()});break;case"select":C.change(function(){var F=d(this),G=F.val(),E=F.prop("multiple");if(E&&d.isArray(G)){G=G.join(",")}if(!E&&A){if(A==="boolean"){G=Boolean(G)}else{if(A==="number"){if(G.length){!isNaN(Number(G))&&(G=Number(G))}else{G=null}}}}B[w.name]=G});break;case"boolean":C.on("ifChanged",function(){B[w.name]=d(this).is(":checked")});break;case"findgrid":C.change(function(){var E=g.value;if(A&&A==="number"){if(E.length){!isNaN(Number(E))&&(E=Number(E))}else{E=null}}B[w.name]=d(this).val()});D.off("afterchange.bjui.findgrid").on("afterchange.bjui.findgrid",'[data-toggle="findgrid"]',function(G,F){var E=w.attrs&&w.attrs["data-options"]&&w.attrs["data-options"]["include"];if(E){d.each(E.split(","),function(J,L){var K=L.trim().split(":"),H=K[0],I=K.length>1?K[1]:K[0];F["data"]&&(B[H]=F["data"][I])})}});break;case"spinner":C.change(function(){B[w.name]=Number(d(this).val())});break;default:C.change(function(){var E=d(this).val();if(A&&A==="number"){if(E.length){!isNaN(Number(E))&&(E=Number(E))}else{E=null}}B[w.name]=E});break}if(s){if(w.type==="boolean"){y=Boolean(y);B[w.name]=y;C.prop("checked",y)}else{if(y!=null){if(C.isTag("select")&&C.prop("multiple")){C.val(d.isArray(y)?y:y.split(","))}else{C.val(String(y))}if(A){if(A==="number"){!isNaN(Number(y))&&(y=Number(y))}else{if(A==="boolean"){y=Boolean(y)}}}B[w.name]=y}else{if((C.isTag("select")&&!C.prop("multiple"))){var z=C.clone().appendTo("body"),v=z.val();B[w.name]=v;z.remove()}}}}else{if(A){C.trigger("change")}}};var o=function(w){var E=w.find("form.datagrid-dialog-edit-form"),x=w.find("div.bjui-pageFooter button"),v=x.first(),y=x.eq(1),A=x.eq(2),B=x.last(),z,D;var C=function(H,F,G){F.empty();if(!G.data(m.datanames.changeData)){G.data(m.datanames.changeData,{})}if(F.data("validator")){F.validator("destroy")}d.each(l,function(K,O){if(!O.name||m.tools.isGridModel(O)){return true}var I=m.inputs[K],N,J=d("<p></p>"),M="datagrid-dialog-edit-column-"+K,L=H[O.name];if(O.hide){J.addClass("hide")}if(s){if(!O.add){I=""}}else{if(!O.edit){I=""}}if(typeof L==="undefined"||L==="null"||L===null){L=""}if(I){N=d(I).attr("id",M);if(N.isTag("select")){N.attr("data-width","auto")}else{if(!N.isTag("checkbox")){N.attr("size",30)}}if(O.type==="boolean"){N.prop("checked",L)}else{if(O.type==="findgrid"){N.val(String(L)).data("context",F)}else{N.val(String(L))}}if(N.isTag("select")&&N.prop("multiple")&&L&&!d.isArray(L)){N.val(L.split(","))}if(s){if(O.addAttrs&&typeof O.addAttrs==="object"){d.each(O.addAttrs,function(Q,P){N.attr(Q,P)})}}else{if(O.editAttrs&&typeof O.editAttrs==="object"){d.each(O.editAttrs,function(Q,P){N.attr(Q,P)})}}}else{if(!s){if(!O.edit){I=L}}}J.append('<label class="control-label x120" for="'+M+'">'+O.label+"：</label>").append(d('<span class="datagrid-dialog-column-span"></span>').append(N||I)).appendTo(F);if(N){n(G,F,N,O)}});F.initui().validator({msgClass:"n-bottom",theme:"red_bottom_effect_grid"})};if(E.is(":empty")){C(g,E,k)}z=k.index();if(m.columnModel[0]===m.childColumn){z=z*2}if(!z){v.addClass("disabled")}if(z==m.data.length-1){y.addClass("disabled")}v.click(function(){var G=k.prev(),F;if(m.options.hasChild&&m.options.childOptions){G=G.prev()}if(G.length){D=m.tools.getNoChildDataIndex(G.index());if(m.isDom){F=G.data("initData")||j.setDomData(G)}else{F=m.data[D]}k=G;C(F,E,k);y.removeClass("disabled");if(!G.prev().length){v.addClass("disabled")}}else{v.addClass("disabled")}});y.click(function(){var H=k.next(),G,F;if(m.options.hasChild&&m.options.childOptions){H=H.next()}if(H.length){F=H.next();D=m.tools.getNoChildDataIndex(H.index());if(m.options.hasChild&&m.options.childOptions){F=F.length&&F.next()}if(m.isDom){G=H.data("initData")||j.setDomData(H)}else{G=m.data[D]}k=H;C(G,E,k);
        E.initui();v.removeClass("disabled");if(!F||!F.length){y.addClass("disabled")}}else{y.addClass("disabled")}});B.click(function(){var H,J,F=[],G,I,K=u.editCallback;D=m.tools.getNoChildDataIndex(k.index());if(m.isDom){J=k.data("initData")}else{J=m.data[D]}E.isValid(function(L){if(L){H=k.data(m.datanames.changeData);d.extend(J,H);if(u.jsonPrefix){G={};d.each(J,function(P,Q){if(!m.tools.isGridData(P)){G[u.jsonPrefix+"."+P]=Q}})}else{G=d.extend({},J);for(var M in m.options.keys){delete G[m.options.keys[M]]}}if(K){K=K.toFunc()}else{K=function(P){if(d.type(P)==="array"){I=P[0]}else{if(typeof P==="object"){I=P}}d.extend(J,typeof I==="object"&&I);m.dialogEditComplete(k,J);m.$grid.dialog("close","datagrid-dialog-edit");m.tools.afterSave(k,J)}}F.push(J);if(m.tools.beforeSave(k,F)){var N=u.editType,O={url:u.editUrl,data:JSON.stringify(G),type:"POST",okCallback:K};if(N&&N==="raw"){O.contentType="application/json"}else{O.data={json:O.data};N&&(O.type=N)}BJUI.ajax("doajax",O)}}})});A.click(function(){m.$grid.dialog("close","datagrid-dialog-edit")})};var q=function(){var v=false;m.$tbody.find("> tr."+m.classnames.tr_add).each(function(){var w=d(this),y=w.index(),x=y;x=m.tools.getNoChildDataIndex(x);m.data=m.data.remove(x);if(w.next().hasClass(m.classnames.tr_child)){w.next().remove();m.$lockTbody&&m.$lockTbody.find("> tr:eq("+y+")").next().remove()}m.$lockTbody&&m.$lockTbody.find("> tr:eq("+y+")").remove();w.remove();v=true});if(v&&m.options.height==="auto"){m.fixedHeight()}};e.find("> div:first").append(t).next().append(BJUI.doRegional(FRAG.gridDialogEditBtns,m.regional));var f=d.extend({},{id:"datagrid-dialog-edit",fresh:true,target:e[0],width:520,height:400,mask:true,title:r,onLoad:o,onClose:q},(typeof u.editDialogOp==="object"&&u.editDialogOp));m.$grid.dialog(f)};c.prototype.dialogEditComplete=function(v,s){var l=this,r=l.columnModel,u=v.index(),i=v.find("> td"),j=false,t=l.$tbody.find("> tr"),w=l.$lockTbody&&l.$lockTbody.find("> tr:eq("+u+")");var e=l.options.tdTemplate,g=d.extend({},s),h=l.options.treeOptions,p,k,o;d.each(r,function(z,C){if(C===l.linenumberColumn){j=true}if(l.tools.isGridModel(C)){return true}var x=C.name?s[C.name]:"",B,A=i.eq(C.index);if(l.isTemplate){A=null}if(typeof x==="undefined"||x==="null"||x===null){x=""}A&&(A.text(x).removeClass(l.classnames.td_edit).removeClass(l.classnames.td_changed));if(C.render&&typeof C.render==="function"){if(C.items){B=C.render.call(l,x,s,C.items,C.itemattr);g[C.name]=B;A&&A.html(B)}else{B=C.render.call(l,x,s);g[C.name]=B;A&&A.html(B)}}else{if(C.items){B=c.renderItem.call(l,x,s,C.items,C.itemattr);g[C.name]=B;A&&A.html(B)}}if(l.options.isTree&&C.hasTree){A&&(A.attr("align","left").addClass("datagrid-tree-td").html(l.tools.createTreePlaceholder(s,(B||x))))}if(C.locked&&w&&A){var y=w.find("> td:eq("+C.lockIndex+")");y.removeClass(l.classnames.td_edit).removeClass(l.classnames.td_changed).html(A.html())}});if(l.isTemplate){if(typeof e==="function"){e=e.apply(l,[s])}e=l.tools.replacePlh4Template(e,g);v.find("> td.datagrid-template-td").html(e)}v.initui();if(w){w.initui()}if(v.hasClass(l.classnames.tr_add)){v.removeClass(l.classnames.tr_add);if(j){l.tools.updateLinenumber()}if(l.options.isTree){var m=s[l.options.keys.treePTr],q=s[l.options.keys.treePData],n=l.options.treeOptions.keys,f;if(m&&q){if(!q[n.isParent]){q[n.isParent]=true;f=m.find("> td.datagrid-tree-td");f.html(l.tools.createTreePlaceholder(q,f.find("span.datagrid-tree-title").html()))}if(!q[n.childLen]){q[n.childLen]=1}else{q[n.childLen]++}v.data(l.options.keys.treePTr).data("child",q[n.childLen]).attr("data-child",q[n.childLen])}v.addClass("datagrid-tree-tr datagrid-tree-level-"+s[n.level]).attr("data-child",0).attr("data-level",s[n.level])}v.next("."+l.classnames.tr_child).remove();l.tools.createChildTr(v,s)}};c.prototype.resizeGrid=function(){var h=this,e=h.$grid.getPageTarget(),i,f;var g=function(){var k=h.$grid.width(),j=h.$tableH.next(".datagrid-thead-dialog-div"),l=((h.options.tdTemplate&&h.options.templateWidth)&&h.options.templateWidth>k)||h.options.templateWidth===0;if(l!==h.isTemplate){h.isTemplate=l;h.tools.coverTemplate();return}if((h.options.dialogFilterW&&k<h.options.dialogFilterW)||h.options.dialogFilterW===0){h.$tableH.hide();if(!j.length){h.$tableH.after('<div class="datagrid-thead-dialog-div" style="padding:5px;"><button type="button" class="btn btn-orange datagrid-thead-dialog-view">'+BJUI.getRegional("datagrid.fAndS")+'</button><span class="datagrid-thead-dialog-filter-msg"><span class="msg-sort"></span><span class="msg-filter"></span></span></div>')}else{j.show()}if(!h.$headFilterUl){h.filterInThead(true)}h.$grid.off("click.datagrid.thead.view").on("click.datagrid.thead.view",".datagrid-thead-dialog-view",function(m){BJUI.dialog({id:"datagrid-thead-view",html:'<div class="bjui-pageContent"></div><div class="bjui-pageFooter"><ul><li><button type="button" class="btn btn-close">关闭</button></li></ul></div>',width:360,height:300,title:"datagrid - thead - columns",onLoad:function(n){h.$headFilterUl.show().appendTo(n.find(".bjui-pageContent"))
    },beforeClose:function(n){h.$headFilterUl.hide().appendTo(h.$grid);return true}})})}else{h.$grid.removeClass("datagrid-flowlayout");h.$tableH.show();j.hide();if(h.$colgroupB.is(":hidden")){h.$colgroupB.show()}}if(h.initFixedW&&String(h.options.width).endsWith("%")){i=h.$grid.parent().width();h.fixedWidth();if(h.options.hasChild&&h.options.childOptions){h.$tbody.find("> tr."+h.classnames.tr_child+":visible").each(function(){var o=d(this),n=o.prev(),m=n.data("bjui.datagrid.child");if(m&&m.length){m.datagrid("fixedWidth")}})}}if(String(h.options.height).endsWith("%")){h.tools.setBoxbH()}};d('a[data-toggle="tab"]').on("shown.bs.tab",d.proxy(function(m){if(!h.$element.data("bjui.datagrid.init.tab")){var j=d(m.target),l=j.data("target"),k=j.attr("href");if(!l){l=d(k)}if(l&&l.length){if(l.find(h.$element).length){h.$element.data("bjui.datagrid.init.tab",true);h.$element.datagrid("fixedHeight")}}}},h));d(window).on(BJUI.eventType.resizeGrid,d.proxy(g,h))};function b(f){var e=arguments,g=f;return this.each(function(){var j=d(this),h=d.extend(true,{},c.DEFAULTS,typeof f==="object"&&f),i=j.data("bjui.datagrid");if(!i){j.data("bjui.datagrid",(i=new c(this,h)))}if(typeof g==="string"&&d.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}else{i.init()}})}var a=d.fn.datagrid;d.fn.datagrid=b;d.datagrid=c;d.fn.datagrid.noConflict=function(){d.fn.datagrid=a;return this};d(document).on(BJUI.eventType.initUI,function(f){d(f.target).find('table[data-toggle="datagrid"]').each(function(){var g=d(this),e=g.data();if(!g.length){return}if(e.options&&typeof e.options==="string"){e.options=e.options.toObj()}d.extend(e,typeof e.options==="object"&&e.options);b.call(g,e)})})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(d){var c=function(f,e){this.$element=d(f);this.options=e;this.tools=this.TOOLS();this.$spinner=null;this.height=this.$element.addClass("form-control").innerHeight();this.ivalue=Number(this.$element.val())||0};c.DEFAULTS={min:0,max:100,step:1,decimalPlace:0};c.EVENTS={afterChange:"afterchange.bjui.spinner"};c.prototype.TOOLS=function(){var e=this;var f={changeVal:function(k){var m=e.$element;var g=Number(m.val())||Number(e.ivalue);var i=k.data("add")||-1;var j=e.options.min,h=e.options.max,l=e.options.step;if(i==1){if(g<=h-l){g=g+l}}else{if(i==-1){if(g>=(j+l)){g=g-l}}else{if(g>h){g=h}else{if(g<j){g=j}}}}if(e.options.decimalPlace){g=new String(g.toFixed(e.options.decimalPlace))}e.ivalue=g;m.val(g).trigger(c.EVENTS.afterChange,{value:g}).trigger("change")}};return f};c.prototype.init=function(){var g=this;var e=this.$element;var f=this.options;if(isNaN(this.options.min)||isNaN(this.options.max)||isNaN(this.options.step)){BJUI.debug("BJUI.Spinner: Parameter is non-numeric type!");return}this.addBtn()};c.prototype.addBtn=function(){var g=this,e=g.$element,f=e.attr("size")?"":" fluid";if(!this.$lookBtn&&!e.parent().hasClass("wrap_bjui_btn_box")){this.$spinner=d(FRAG.spinnerBtn);e.css({"paddingRight":"13px"}).wrap('<span class="wrap_bjui_btn_box'+f+'"></span>');var h=e.parent();h.css("position","relative");this.$spinner.css({"height":this.height}).appendTo(h);this.$spinner.on("selectstart",function(){return false});var i=null;g.$spinner.find("li").on("click",function(j){g.tools.changeVal(d(this))}).on("mousedown",function(){var j=d(this);i=setInterval(function(){g.tools.changeVal(j)},150)}).on("mouseup",function(){clearTimeout(i)})}};c.prototype.destroy=function(){if(this.$element.parent().hasClass("wrap_bjui_btn_box")){this.$element.parent().find(".bjui-spinner").remove();this.$element.unwrap()}};function b(f){var e=arguments;var g=f;return this.each(function(){var j=d(this);var h=d.extend({},c.DEFAULTS,j.data(),typeof f==="object"&&f);var i=j.data("bjui.spinner");if(!i){j.data("bjui.spinner",(i=new c(this,h)))}if(typeof g==="string"&&d.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}else{i.init()}})}var a=d.fn.spinner;d.fn.spinner=b;d.fn.spinner.Constructor=c;d.fn.spinner.noConflict=function(){d.fn.spinner=a;return this};d(document).on(BJUI.eventType.initUI,function(g){var f=d(g.target).find('input[data-toggle="spinner"]');if(!f.length){return}b.call(f)})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(h){var o,p,f,b,c,d,j,l,k,i,a,g;var n=function(r,q){this.$element=h(r);this.options=q;this.$findBtn=null};n.DEFAULTS={pk:null,oldData:null,group:null,suffix:null,include:null,exclude:null,multiple:false,append:false,empty:true,dialogOptions:{id:null,mask:true,width:600,height:400,title:"FindGrid",maxable:true,resizable:true},gridOptions:{width:"100%",height:"100%",tableWidth:"100%",columnMenu:false},context:null,beforeSelect:null,onSelect:null,afterSelect:null};n.EVENTS={afterChange:"afterchange.bjui.findgrid"};
    n.getField=function(q){return(o?(o+"."):"")+(q)+(p?p:"")};n.empty=function(){if(!b){BJUI.debug("BJUI.FindGrid: No set options 'include' !");return}var w=this,v=b.split(","),u=a.find(":text, :input:hidden, textarea, select"),x={};for(var t=0;t<v.length;t++){var q=v[t].split(":"),s,r;if(q.length==2){r=q[0].trim();s=q[1].trim()}else{r=v[t].trim();s=r}x[w.getField(r)]=true}for(s in x){u.filter('[name="'+s+'"]').val("").trigger(n.EVENTS.afterChange,{value:"",data:""}).trigger("focus").trigger("change")}};n.setSingle=function(s){if(typeof k==="function"){k.call(this,s);return}var q=this;var r=function(w,t,v){var u=q.getField(t);if(u==w.attr("name")){w.val(v).trigger(n.EVENTS.afterChange,{value:v,data:s}).trigger("focus").trigger("change");if(w.isTag("select")&&w.data("toggle")&&w.data("toggle")==="selectpicker"){w.selectpicker("refresh")}}};a.find("input:text, input:hidden, textarea, select").each(function(){var z=h(this),v,u=[];if(b){var y=b.split(",");for(var x=0;x<y.length;x++){var t=y[x].split(":"),w;if(t.length==2){v=t[0].trim();w=t[1].trim()}else{v=y[x].trim();w=v}if(s&&typeof s[w]!=="undefined"){r(z,v,s[w])}}}else{for(var w in s){if(c){h.each(c.split(","),function(A,B){u.push(B.trim())});if(h.inArray(w,u)!=-1){continue}}r(z,w,s[w])}}});if(typeof i==="function"){i.call(q,s);return}};n.setMult=function(B){var G=h("#"+B).data("selectedDatas");if(typeof l==="function"){if(!l.apply(w,[G])){return false}}if(typeof k==="function"){k.call(w,G);return}var w=this,H,A=0,F;var s=function(v){if(v.isTag("select")&&v.data("toggle")&&v.data("toggle")==="selectpicker"){v.selectpicker("refresh")}};if(G&&G.length){var t=a.find("input:text, input:hidden, textarea, select"),u,I={},r={},x=[],y;if(!d&&j){j=[]}if(b){var C=b.split(",");for(var E=0;E<C.length;E++){var q=C[E].split(":"),J,z;if(q.length==2){u=q[0].trim();J=q[1].trim()}else{u=C[E].trim();J=u}I[w.getField(u)]=J}}else{for(var J in G[0]){if(c){h.each(c.split(","),function(v,K){x.push(K.trim())});if(h.inArray(J,x)===-1){I[w.getField(J)]=J}}else{I[w.getField(J)]=J}}}t=h(h.map(t,function(L){var K=h(L),v=K.attr("name");if(!v){return null}if(!I[v]){return null}r[v]=I[v];return L}));for(var D=0;D<G.length;D++){H=G[D];if(j&&h.inArray(H[f],j)!=-1&&!d){continue}t.each(function(v){var M=h(this),K=M.attr("name"),L=M.val();if(!F){F=new Array()}if(!F[v]){F[v]=[]}if(!d){M.val("");s(M)}else{if(L){F[v].push(L);if(M.isTag("select")&&M.prop("multiple")){F[v]=h.type(L)==="array"?L:[]}}}F[v].push(H[r[K]]);if(j&&h.inArray(H[f],j)===-1){j.push(H[f])}})}if(F){t.each(function(v){var K=h(this);y=F[v].join(",");if(K.isTag("select")&&K.prop("multiple")){y=F[v]}K.val(y).trigger(n.EVENTS.afterChange,{value:y,data:G}).trigger("change");g.data("oldData",j);s(K)})}if(typeof i==="function"){i.call(w,H.data);return}BJUI.dialog("closeCurrent")}};n.prototype.init=function(){var r=this,q=this.options,t=q.gridOptions,s=this.tools;o=q.group||null;p=q.suffix||null;g=r.$element;j=q.oldData;f=q.pk||null;b=q.include||null;c=q.exclude||null;a=null;if(q.context){if(q.context instanceof jQuery){a=q.context}else{a=h(q.context)}}if(!a||!a.length){if(r.$element[0]===h("body")[0]){a=h.CurrentDialog||h.CurrentNavtab}else{a=r.$element.closest(".unitBox")}}if(p){p=p.trim()}if(f){if(g.data("oldData")){j=g.data("oldData")}else{if(typeof j!=="undefined"){if(typeof j==="string"){j=j.split(",")}else{if(!h.isArray(j)){j=[]}}}else{j=[]}}}else{j=null}if(t.dataUrl){t.dataUrl=decodeURI(t.dataUrl).replacePlh(a);if(!t.dataUrl.isFinishedTm()){BJUI.alertmsg("error",(q.warn||BJUI.regional.plhmsg));BJUI.debug("Findgrid Plugin: gridOptions -> dataUrl is incorrect: "+t.dataUrl);return}t.dataUrl=encodeURI(t.dataUrl)}this.open(r.$element)};n.prototype.addBtn=function(){var u=this,r=u.$element,s=r.data("bjui.findgrid.options"),t=r.attr("size")?"":" fluid";if(!this.$findBtn&&!r.parent().hasClass("wrap_bjui_btn_box")){this.$findBtn=h(FRAG.findgridBtn);this.$element.css({"paddingRight":"15px"}).wrap('<span class="wrap_bjui_btn_box'+t+'"></span>');var v=this.$element.parent();var q=this.$element.addClass("form-control").innerHeight();v.css({"position":"relative","display":"inline-block"});delete s.toggle;u.$findBtn.data("bjui.findgrid.options",s);this.$findBtn.css({"height":q,"lineHeight":q+"px"}).appendTo(v);this.$findBtn.on("selectstart",function(){return false})}};n.prototype.open=function(v){var s=this,q=this.options,r=q.dialogOptions,u=q.gridOptions,t=(new Date().getTime());if(!r.id){r.id="dialog_findgrid_"+t}if(!q.gridId){q.gridId="datagrid_findgrid_"+t}u.showToolbar=false;if(q.empty){if(!u.toolbarCustom){u.toolbarCustom=""}u.showToolbar=true}if(q.multiple){u.showToolbar=true;if(typeof u.showCheckboxcol==="undefined"){u.showCheckboxcol=true}if(!u.toolbarCustom){u.toolbarCustom=""}u.selectMult=true;u.toolbarCustom+='　<button type="button" class="btn-blue" onclick="$.fn.findgrid.Constructor.setMult(\''+q.gridId+"')\">"+(BJUI.getRegional("findgrid.choose"))+"</button>";u.toolbarCustom+='　<label class="ilabel"><input type="checkbox" data-toggle="icheck" id="checkbox_findgrid_'+t+'" '+(q.append?"checked":"")+">&nbsp;"+(BJUI.getRegional("findgrid.append"))+"</label>";
        d=q.append}if(q.empty){u.toolbarCustom+='　<button type="button" class="btn-orange" onclick="$.fn.findgrid.Constructor.empty(\''+q.gridId+"')\">"+(BJUI.getRegional("findgrid.empty"))+"</button>"}delete r.url;delete r.target;if(q.onSelect){k=q.onSelect;if(typeof k==="string"){k=k.toFunc()}}else{k=null}if(q.beforeSelect){l=q.beforeSelect;if(typeof l==="string"){l=l.toFunc()}}else{l=null}if(q.afterSelect){i=q.afterSelect;if(typeof i==="string"){i=i.toFunc()}}else{i=null}r.html='<div class="bjui-pageContent tableContent"><table id="'+q.gridId+'"></table></div>';r.onLoad=function(y){var x="#"+q.gridId,w=h(x);w.datagrid(u);if(h.isArray(j)&&j.length&&f){h(document).on("afterLoad.bjui.datagrid",x,function(A,z){if(z.datas){h.each(z.datas,function(B,C){if(C[f]){if(h.inArray(C[f],j)!="-1"){w.datagrid("selectedRows",B,true)}}})}})}if(!q.multiple){h(document).on("clicked.bjui.datagrid.tr",x,function(A,z){if(typeof l==="function"){if(!l.apply(s,[z.data])){return false}}if(typeof k==="function"){k.call(s,z.data)}else{n.setSingle(z.data);BJUI.dialog("closeCurrent")}})}h(document).on("ifChanged","#checkbox_findgrid_"+t,function(z){d=h(this).is(":checked")})};BJUI.dialog(r)};function m(r){var q=arguments;var s=r;return this.each(function(){var v=h(this),t={},u;h.extend(true,t,n.DEFAULTS,typeof r==="object"&&r);u=new n(this,t);if(typeof s==="string"&&h.isFunction(u[s])){[].shift.apply(q);if(!q){u[s]()}else{u[s].apply(u,q)}}else{u.init()}})}var e=h.fn.findgrid;h.fn.findgrid=m;h.fn.findgrid.Constructor=n;h.fn.findgrid.noConflict=function(){h.fn.findgrid=e;return this};BJUI.findgrid=function(q){m.apply(h("body"),[q])};h(document).on(BJUI.eventType.initUI,function(q){h(q.target).find('input[data-toggle="findgrid"]').each(function(){var t=h(this),s=t.data(),r=s.options;if(r){if(typeof r==="string"){if(r.trim().startsWith("{")){r=r.toObj()}else{r=r.toFunc()}}if(typeof r==="function"){r=r.apply()}if(typeof r==="object"){delete s.options;h.extend(s,r)}}t.data("bjui.findgrid.options",s);m.call(t,"addBtn")})});h(document).on("click.bjui.findgrid.data-api",'[data-toggle="findgridbtn"]',function(u){var t=h(this),r=t.data("bjui.findgrid.options");if(!r){var s=t.data(),q=s.options;if(q){if(typeof q==="string"){if(q.trim().startsWith("{")){q=q.toObj()}else{q=q.toFunc()}}if(typeof q==="function"){q=q.apply()}if(typeof q==="object"){delete s.options;h.extend(s,q)}}r=s}delete r["bjui.findgrid.options"];m.call(t,r);u.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(e){var h,j,l,b,k,f,a,d;var i=function(n,m){this.$element=e(n);this.options=m;this.$findBtn=null};i.DEFAULTS={keys:null,group:null,suffix:null,include:null,context:null,eventType:"change",autofill:false};i.EVENTS={afterChange:"afterchange.bjui.suggest"};i.getField=function(m){return(h?(h+"."):"")+(m)+(j?j:"")};i.setSingle=function(o){var r=this,q,s=[],n,p=[];var t=function(v,u){return v.replace(/#\/?[^#]*#/g,function(w){var x=w.replace(/[##]+/g,""),y=u[x];if(typeof y==="undefined"){return w}if(typeof y==="undefined"||y==="null"||y===null){y=""}return y})};var m=function(z,x,u){q=[];var w=z.data("suggest.menu"),y,v;if(!w||!w.length){w=e('<ul class="bjui-suggest-menu"></ul>')}e.each(o,function(A,B){y=x;v=u;y=t(y,B);v=t(v,B);if(y||v){q.push('<li data-value="'+y+'">'+v+"</li>")}});if(q.length){w.html(q.join("")).appendTo("body").css({position:"absolute",top:z.offset().top+z.outerHeight(),left:z.offset().left}).on("click.bjui.suggest","li",function(){z.val(e(this).attr("data-value"))}).on("mouseover.bjui.suggest","li",function(){e(this).addClass("menu-highlight")}).on("mouseout.bjui.suggest","li",function(){e(this).removeClass("menu-highlight")});z.addClass("bjui-suggest-input").attr("autocomplete",false).data("suggest.menu",w).off("focus.bjui.suggest").on("focus.bjui.suggest",function(){w.css({top:z.offset().top+z.outerHeight(),left:z.offset().left}).show()}).off("destroy.bjui.suggest").on("destroy.bjui.suggest",function(){w.remove()});s.push(w)}};e.each(l,function(x,w){var z=r.getField(x),C=a.find('input[name="'+z+'"], select[name="'+z+'"], textarea[name="'+z+'"]'),u=w?w.split("/"):["#"+x+"#"],A,B,y;if(C&&C.length){if(u.length>1){B=u[0];y=u[1]}else{B=y=u[0]}if((C.isTag("select")||C.isTag("textarea"))&&k){C.val(o[0]?o[0][x]:"");if(C.isTag("select")){C.selectpicker("refresh")}}else{m(C,B,y);if(k){C.val(o[0]?o[0][x]:"")}}p.push(C);if(!n){n=C.parents()}}});e(document).on("click.bjui.suggest",function(v){var u=e(v.target).data("suggest.menu");if(!u||!u.length){e("body").find("> .bjui-suggest-menu").hide()}else{u.siblings(".bjui-suggest-menu").hide()}});n.on("scroll.bjui.suggest",function(){e.each(p,function(u,w){var v=w.data("suggest.menu");if(v&&v.is(":visible")){v.css({top:w.offset().top+w.outerHeight(),left:w.offset().left})}})});d.data("menus",s)};i.prototype.init=function(){var n=this,m=this.options,o=this.tools;l=m.keys||null;
    h=m.group||null;j=m.suffix||null;k=m.autofill||false;d=n.$element;a=null;if(m.context){if(m.context instanceof jQuery){a=m.context}else{a=e(m.context)}}if(!a||!a.length){a=n.$element.closest(".unitBox")}if(j){j=j.trim()}if(!m.keys){BJUI.debug("BJUI.Suggest: options -> keys is not defined!");return}if(!m.url){BJUI.debug("BJUI.Suggest: options -> url is not defined!");return}else{m.url=decodeURI(m.url).replacePlh(a);if(!m.url.isFinishedTm()){BJUI.alertmsg("error",(m.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.Suggest: options -> url is incorrect: "+m.url);return}m.url=encodeURI(m.url)}n.$element.on(m.eventType||"change",function(){var p=e(this).val();if(p){n.load(p)}})};i.prototype.load=function(p){var o=this,n=this.options,m=n.url;if(m.indexOf("#val#")!=-1){m=m.replaceAll("#val#",p)}BJUI.ajax("doajax",{url:m,data:{value:p},type:n.type,cache:n.cache,okCallback:function(q){i.setSingle(q)}})};i.prototype.destroyMenu=function(){var m=d.data("menus")||[];if(m.length){e.each(m,function(o,p){p.remove()})}};function g(n){var m=arguments;var o=n;return this.each(function(){var r=e(this),p={},q;e.extend(true,p,i.DEFAULTS,typeof n==="object"&&n);q=new i(this,p);if(typeof o==="string"&&e.isFunction(q[o])){[].shift.apply(m);if(!m){q[o]()}else{q[o].apply(q,m)}}else{q.init()}})}var c=e.fn.suggest;e.fn.suggest=g;e.fn.suggest.Constructor=i;e.fn.suggest.noConflict=function(){e.fn.suggest=c;return this};e(document).on(BJUI.eventType.initUI,function(m){e(m.target).find('input[data-toggle="suggest"]').each(function(){var p=e(this),o=p.data(),n=o.options;if(n){if(typeof n==="string"){if(n.trim().startsWith("{")){n=n.toObj()}else{n=n.toFunc()}}if(typeof n==="function"){n=n.apply()}if(typeof n==="object"){delete o.options;e.extend(o,n)}}g.call(p,o)})});e(document).on("click.bjui.suggest.data-api",'[data-toggle="suggestbtn"]',function(q){var p=e(this),n=p.data("bjui.suggest.options");if(!n){var o=p.data(),m=o.options;if(m){if(typeof m==="string"){if(m.trim().startsWith("{")){m=m.toObj()}else{m=m.toFunc()}}if(typeof m==="function"){m=m.apply()}if(typeof m==="object"){delete o.options;e.extend(o,m)}}n=o}delete n["bjui.suggest.options"];g.call(p,n);q.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(d){var a=function(f,e){this.$element=d(f);this.options=e;this.tools=this.TOOLS();this.$box=d("<div></div>");this.timeout=null;this.$tagsArr={};this.tags=[];if(e.istag){this.$element.addClass("tag-input");this.$box.addClass("bjui-tags")}else{this.$box.addClass("bjui-autocomplete");if(!this.$element.attr("size")){this.$box.addClass("fluid")}}this.$element.after(this.$box);this.$element.appendTo(this.$box)};a.DEFAULTS={width:300,url:"",global:false,type:"GET",term:"term",tagname:"tag",max:0,clear:false,lightCls:"tags-highlight",istag:true,data:{},container:"",keys:{value:"value",label:"label"}};a.EVENTS={afterCreated:"aftercreated.bjui.tags"};a.prototype.TOOLS=function(){var f=this,e=this.options;var g={keyDown:function(h){if(h.which==13){return false}},keyUp:function(m){switch(m.which){case BJUI.keyCode.BACKSPACE:if(!d.trim(f.$element.val()).length){f.tools.removeMenu();return false}break;case BJUI.keyCode.ESC:f.tools.removeMenu();break;case BJUI.keyCode.DOWN:if(!f.$menu||!f.$menu.length){return}var h=f.$menu.find("> ."+e.lightCls),k=f.$menu.find("> li:first-child");if(!h.length){k.addClass(e.lightCls)}else{var l=h.removeClass(e.lightCls).next();if(l.length){l.addClass(e.lightCls)}else{k.addClass(e.lightCls)}}return false;break;case BJUI.keyCode.UP:if(!f.$menu||!f.$menu.length){return}var h=f.$menu.find("> ."+e.lightCls),o=f.$menu.find("> li:last-child");if(!h.length){o.addClass(e.lightCls)}else{var j=h.removeClass(e.lightCls).prev();if(j.length){j.addClass(e.lightCls)}else{o.addClass(e.lightCls)}}return false;break;case BJUI.keyCode.ENTER:if(e.max>0&&f.$tagsArr.length>=e.max){return false}var p=false,q=false,r=null;var i=f.$menu&&f.$menu.find("> ."+e.lightCls);if(i&&i.length){p=i.text();r=i.data("item");q=r[e.keys.value]}else{p=d.trim(f.$element.val());if(!p.length){return false}if(e.clear){if(d.inArray(p,f.tags)==-1){e.istag&&(f.$element.val(""));return false}}q=p}if(!p){return}var n=false;f.$tagsArr.length&&f.$tagsArr.each(function(){if(d(this).val()==q){n=true;return}});if(n){e.istag&&(f.$element.val(""));return false}f.tools.createTag(p,q);f.tools.removeMenu();e.istag&&(f.$element.val(""));d.proxy(f.tools.onAfterCreated(r,q),f);return false;break}},query:function(){if(f.timeout){clearTimeout(f.timeout)}f.timeout=setTimeout(f.tools.doQuery,300)},doQuery:function(){var l=f.options;if(l.max>0&&f.$tagsArr.length>=l.max){return}var m=f.$element.val(),n=f.$menu,k=[],j=null;var i=f.$element.closest(".navtab-panel").length?d.CurrentNavtab:d.CurrentDialog;var h={};if(f.$element.closest(".bjui-layout").length){i=f.$element.closest(".bjui-layout")}if(!m.length){return}f.$element.one("ajaxStart",function(){i.trigger("bjui.ajaxStart")
}).one("ajaxStop",function(){i.trigger("bjui.ajaxStop")});h[l.term]=m;d.extend(h,typeof l.data==="object"&&l.data);l.url=decodeURI(l.url).replacePlh(f.$element.closest(".unitBox"));if(!l.url.isFinishedTm()){BJUI.alertmsg("error",(l.warn||BJUI.regional.plhmsg));BJUI.debug("BJUI.Tags: The query tags url is incorrect, url: "+l.url);return}l.url=encodeURI(l.url);d.ajax({url:l.url,global:l.global,type:l.type,data:h,dataType:"json",success:function(p){if(p.length!=0){if(!n||!n.length){n=d('<ul class="bjui-tags-menu"></ul>')}n.empty().hide();if(l.container){n.css("position","absolute").appendTo(l.container)}else{n.appendTo(f.$box)}for(var o=0;o<p.length;o++){var t=p[o];if(typeof t==="string"){t={};t[l.keys.label]=p[o];t[l.keys.value]=p[o]}j=d('<li class="tags-item">'+t[l.keys.label]+"</li>").data("item",t);j.appendTo(n);k.push(t[l.keys.label])}f.tags=k;var q=d(window).height()-f.$element.offset().top-50,s=0,r=0;if(l.container){s=f.$element.offset().top+f.$element.outerHeight();r=f.$element.offset().left}else{s=f.$element.position().top+f.$element.outerHeight();r=f.$element.position().left}n.css({"top":s,"left":r}).fadeIn().find("> li").hover(function(){d(this).addClass(l.lightCls).siblings().removeClass(l.lightCls)},function(){d(this).removeClass(l.lightCls)}).click(function(){var u=d(this).text();var w=d(this).data("item");var x=w[l.keys.value];var v=false;f.$box.find("input:hidden").each(function(){if(d(this).val()==x){v=true;return}});if(v){l.istag&&(f.$element.val(""));n.remove();return}d.proxy(f.tools.createTag(u,x),f);n.remove();l.istag&&(f.$element.val(""));d.proxy(f.tools.onAfterCreated(w,x),f)});if(n.height()>q){n.height(q-10).css("overflow-y","scroll")}f.$menu=n}}})},createTag:function(h,j){if(!f.options.istag){f.$element.val(h);return}var i=d('<span class="label label-tag" data-value="'+j+'" style="margin-left: 1px; margin-top: 1px;"><i class="fa fa-tag"></i> '+h+'&nbsp;&nbsp;<a href="#" class="close">&times;</a></span>');i.insertBefore(f.$element).find("a.close").click(function(){var l=i.data("value");f.$box.find("input:hidden").each(function(){if(d(this).val()==l){d(this).remove()}});i.remove();f.$tagsArr=f.$box.find('input[name="'+f.options.tagname+'"]')});var k=d('<input type="hidden" name="'+f.options.tagname+'">').val(j);k.appendTo(f.$box);f.$tagsArr=f.$box.find('input[name="'+f.options.tagname+'"]')},removeMenu:function(){if(f.$menu){f.$menu.remove()}},onAfterCreated:function(i,j){var h=[];f.$tagsArr.length&&f.$tagsArr.each(function(){h.push(d(this).val())});f.$element.trigger(a.EVENTS.afterCreated,{item:i,value:j,tags:h.join(",")})}};return g};a.prototype.init=function(){var g=this;var e=this.$element;var f=this.options;if(!(f.url)){BJUI.debug("BJUI.Tags: Do query tags, url is undefined!");return}if(isNaN(this.options.max)){BJUI.debug("BJUI.Tags: Parameter 'max' is non-numeric type!");return}g.$box.on("click",function(){e.focus()});if(f.istag){g.$box.css("width",f.width)}e.on("keydown",d.proxy(this.tools.keyDown,this)).on("keyup",d.proxy(this.tools.keyUp,this));if(d.support.leadingWhitespace){e.on("propertychange",d.proxy(this.tools.query,this))}else{e.on("input",d.proxy(this.tools.query,this))}d(document).on("click.bjui.tags",d.proxy(function(h){if(!d(h.target).closest(this.$box).length){this.tools.removeMenu()}},this))};a.prototype.destroy=function(){if(this.$tags){this.$element.upwrap();$tags.remove()}};function c(f){var e=arguments,g=f;return this.each(function(){var j=d(this),h={},i;d.extend(true,h,a.DEFAULTS,typeof f==="object"&&f);i=new a(this,h);if(typeof g==="string"&&d.isFunction(i[g])){[].shift.apply(e);if(!e){i[g]()}else{i[g].apply(i,e)}}else{i.init()}})}var b=d.fn.tags;d.fn.tags=c;d.fn.tags.Constructor=a;d.fn.tags.noConflict=function(){d.fn.tags=b;return this};d(document).on(BJUI.eventType.initUI,function(f){d(f.target).find('input[data-toggle="tags"]').each(function(){var h=d(this),g=h.data(),e=g.options;if(e){if(typeof e==="string"){if(e.trim().startsWith("{")){e=e.toObj()}else{e=e.toFunc()}}if(typeof e==="function"){e=e.apply()}if(typeof e==="object"){delete g.options;d.extend(g,e)}}else{if(g.keys){g.keys=g.keys.toObj()}if(g.data){g.data=g.data.toObj()}}c.call(h,g)})})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(g){var f,d,c;g(function(){var h=function(){f=g("#bjui-link-theme");d=g("#bjui-themes");c=g("#bjui-fonts");if(g.cookie){var j=g.cookie("bjui_theme")||"blue";var l=d.find("a.theme_"+j);l.theme({});var i=g.cookie("bjui_font")||"bjui-font-c";var k=c.find("a."+i);k.theme("setFont",i)}};h()});var b=function(i,h){this.$element=g(i);this.options=h};b.DEFAULTS={theme:"purple"};b.prototype.init=function(){if(!f.length){return}var h=f.attr("href");h=h.substring(0,h.lastIndexOf("/"));h=h.substring(0,h.lastIndexOf("/"));h+="/"+this.options.theme+"/core.css";f.attr("href",h);var j=this.$element.closest("li").filter(".active");
    var i=j.data("theme")||"default";i=i.replace(/(theme[\s][a-z]*)/g,"");j.removeClass().addClass(i).addClass("theme").addClass(this.options.theme);d.find("li").removeClass("active");this.$element.parent().addClass("active");this.cookie()};b.prototype.setTheme=function(h){d.find("a.theme_"+h).trigger("click")};b.prototype.setFont=function(h){g("html").removeClass().addClass(h);this.$element.closest("ul").prev().html(this.$element.html()).removeClass().addClass("dropdown-toggle bjui-fonts-tit "+h);g("body").find("table").each(function(){var i=g(this),j=i.data("bjui.datagrid");if(j){j.needfixedWidth=true;i.datagrid("fixedWidth");j.needfixedWidth=false}});g(window).trigger(BJUI.eventType.resizeGrid);if(g.cookie){g.cookie("bjui_font",h,{path:"/",expires:30})}};b.prototype.cookie=function(){var h=this.options.theme;if(g.cookie){g.cookie("bjui_theme",h,{path:"/",expires:30})}};function e(i){var h=arguments;var j=i;return this.each(function(){var m=g(this);var k=g.extend({},b.DEFAULTS,m.data(),typeof i==="object"&&i);var l=m.data("bjui.theme");if(!l){m.data("bjui.theme",(l=new b(this,k)))}if(typeof j==="string"&&g.isFunction(l[j])){[].shift.apply(h);if(!h){l[j]()}else{l[j].apply(l,h)}}else{l.init()}})}var a=g.fn.theme;g.fn.theme=e;g.fn.theme.Constructor=b;g.fn.theme.noConflict=function(){g.fn.theme=a;return this};g(document).on("click.bjui.theme.data-api",'[data-toggle="theme"]',function(h){e.call(g(this));h.preventDefault()});g(document).on("click.bjui.fonts.data-api",'[data-toggle="fonts"]',function(h){e.call(g(this),"setFont",g(this).attr("class"));h.preventDefault()})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(f){var c=function(h,g){var i=this;this.$element=f(h);this.options=g};c.DEFAULTS={};c.prototype.init=function(){var h=this,g=h.$element;f.when(h.initUI()).done(function(){g.trigger(BJUI.eventType.afterInitUI)})};c.prototype.initUI=function(){var g=this.$element;f.when(g.trigger(BJUI.eventType.beforeInitUI)).done(function(){g.trigger(BJUI.eventType.initUI)})};function d(h){var g=arguments,i=h;return this.each(function(){var l=f(this),j=f.extend({},c.DEFAULTS,l.data(),typeof h==="object"&&h),k=l.data("bjui.initui");if(!k){l.data("bjui.initui",(k=new c(this,j)))}if(typeof i==="string"&&f.isFunction(k[i])){[].shift.apply(g);if(!g){k[i]()}else{k[i].apply(k,g)}}else{k.init()}})}var a=f.fn.initui;f.fn.initui=d;f.fn.initui.Constructor=c;f.fn.initui.noConflict=function(){f.fn.initui=a;return this};f(document).on("click.bjui.initui.data-api",'[data-toggle="initui"]',function(g){d.call($this,$this.data());g.preventDefault()});f(document).on(BJUI.eventType.beforeInitUI,function(h){var g=f(h.target),j=[],i=g.find("[data-noinit], pre");g.find("> .bjui-maskProgress").find(".progress").stop().animate({width:"85%"},"fast");i.each(function(k){var l=f(this),m={};m.$target=l;m.$next=l.next();m.$prev=l.prev();m.$parent=l.parent();m.visible=l.is(":visible")?true:false;j.push(m);l.remove()});g.data("bjui.noinit",j)});f(document).on(BJUI.eventType.initUI,function(h){var g=f(h.target);g.find("> .bjui-maskProgress").find(".progress").stop().animate({width:"95%"},"fast")});f(document).on(BJUI.eventType.afterInitUI,function(i){var h=f(i.target),j=h.data("bjui.noinit"),g=h.find("> .bjui-pageContent").find("form");if(j){f.each(j,function(k,l){if(l.$next.length){l.$next.before(l.$target)}else{if(l.$prev.length){l.$prev.after(l.$target)}else{if(l.$parent.length){l.$parent.append(l.$target)}}}if(l.visible){l.$target.show()}h.removeData("bjui.noinit")})}h.resizePageH();if(g.length){h.find("> .bjui-pageFooter").find(":submit").on("click.bjui.submit",function(k){k.preventDefault();g.submit()})}h.find("> .bjui-pageFooter").find(":submit.btn-submit-header").on("click.bjui.submit",function(l){l.preventDefault();var k=h.find("> .bjui-pageHeader").find("form");k.length&&k.submit()});h.find("> .bjui-maskProgress").find(".progress").stop().animate({width:"100%"},"fast",function(){h.find("> .bjui-ajax-mask").fadeOut("normal",function(){f(this).remove()})})});f(document).one(BJUI.eventType.afterInitUI,function(j){var k=f("#bjui-hnav-navbar"),g=k.find("> li.active"),i=g.find("> a");if(g.length){if(g.find("> .items").length){i.trigger("click")}else{var h=i.attr("href");if(h&&!(h.startsWith("#")||h.startsWith("javascript"))){i.trigger("click")}}}});var b=function(h){var l=h,q=l,j=l.css("position"),n=l.scrollTop()||0,o=(l[0].clientHeight)/2;if(j=="static"){l.css("position","relative").data("bjui.ajax.static",true);q=l.offsetParent()}var m=parseInt(q.css("zIndex"))||0,g=l.find("> .bjui-maskBackground"),k=l.find("> .bjui-maskProgress");if(!g.length){g=f(FRAG.maskBackground);k=f(BJUI.doRegional(FRAG.maskProgress,BJUI.regional));l.prepend(g).prepend(k)}var i=parseInt(g.css("zIndex"))||0,p=parseInt(k.css("zIndex"))||0;g.css("zIndex",m+1).css("top",n);k.css("zIndex",m+2);if(n){k.css("top",n+o)}if(o==0){setTimeout(function(){k.css("top",f(this).scrollTop()+l[0].clientHeight/2)
},50)}l.off("scroll.ajaxmask").on("scroll.ajaxmask",function(){var r=f(this).scrollTop();g.css("top",l.scrollTop());k.css("top",r+this.clientHeight/2)});return{$bg:g,$pr:k}};f(document).on("bjui.ajaxStart",function(i,h,j){var g=b(f(i.target));g.$bg.fadeIn();g.$pr.fadeIn();g.$pr.find(".progress").animate({width:"80%"},h||500);if(j){setTimeout(function(){j.toFunc().call(this)},25)}}).on("bjui.ajaxStop",function(i){var g=f(i.target),h=b(g);h.$pr.find(".progress").animate({width:"100%"},"fast",function(){h.$bg.remove();h.$pr.remove();if(g.data("bjui.ajax.static")){g.css("position","static")}})}).on("bjui.ajaxError",function(i){var g=f(i.target),h=b(g);h.$bg.remove();h.$pr.remove();if(g.data("bjui.ajax.static")){g.css("position","static")}});f(document).on(BJUI.eventType.ajaxStatus,function(i){var g=f(i.target),h=b(g);g.one("ajaxStart",function(){h.$bg.fadeIn();h.$pr.fadeIn();h.$pr.find(".progress").animate({width:"10%"},"fast")}).one("ajaxStop",function(){}).one("ajaxError",function(){h.$bg.remove();h.$pr.remove();if(g.data("bjui.ajax.static")){g.css("position","static")}})});var e=function(g){g.find('select[data-toggle="selectpicker"]').selectpicker("destroyMenu");g.find('[data-toggle="selectztree"]').trigger("destroy.bjui.selectztree");g.find(".bjui-suggest-input").trigger("destroy.bjui.suggest")};f(document).on(BJUI.eventType.beforeLoadDialog,function(g){}).on(BJUI.eventType.beforeAjaxLoad,function(g){e(f(g.target))}).on(BJUI.eventType.beforeCloseNavtab,function(g){e(f(g.target))}).on(BJUI.eventType.beforeCloseDialog,function(g){e(f(g.target))});f(function(){f(document).on("keydown keyup",function(g){if(g.which===BJUI.keyCode.CTRL){BJUI.KeyPressed.ctrl=g.type=="keydown"?true:false}if(g.which===BJUI.keyCode.SHIFT){BJUI.KeyPressed.shift=g.type=="keydown"?true:false}})})}(jQuery);
/*!
 * B-JUI  V1.31 (http://b-jui.com)
 * Git@OSC (http://git.oschina.net/xknaan/B-JUI)
 * Copyright 2014 K'naan.
 * Licensed under Apache (http://www.apache.org/licenses/LICENSE-2.0)
 */
+function(a){a(document).on(BJUI.eventType.initUI,function(j){var i=a(j.target);if(a.fn.iCheck){var c=i.find('input[data-toggle="icheck"]');c.each(function(m){var e=a(this),n=e.attr("id"),l=e.attr("name"),k=e.data("label");if(k){e.after('<label for="'+n+'" class="ilabel">'+k+"</label>")}e.on("ifCreated",function(q){var p=a(this).closest("div"),o=p.next('[for="'+n+'"]');p.attr("data-icheck",l);o.attr("data-icheck",l)}).iCheck({checkboxClass:"icheckbox_minimal-purple",radioClass:"iradio_minimal-purple",increaseArea:"20%"}).on("ifChanged",function(){a.fn.validator&&a(this).trigger("validate")});if(e.prop("disabled")){e.iCheck("disable")}});c.filter(".checkboxCtrl").on("ifChanged",function(m){var k=m.target.checked==true?"check":"uncheck";var l=a(this).data("group");i.find(':checkbox[name="'+l+'"]').iCheck(k)})}i.find("button").each(function(){var e=a(this),k=e.data("icon");e.addClass("btn");if(k&&!e.find("> i").length){k="fa-"+k.replace("fa-","");if(!e.data("bjui.icon")){e.html('<i class="fa '+k+'"></i> '+e.html()).data("bjui.icon",true)}}});i.find("input:text, input:password").each(function(){var e=a(this).addClass("form-control"),k=e.attr("size")||0,l=k*10;l&&e.css("width",l)});i.find("textarea").each(function(){var k=a(this).addClass("form-control"),m=k.attr("cols")||0,l=m*10,e=k.attr("data-toggle");l&&k.css("width",l);if(e&&e=="autoheight"&&a.fn.autosize){k.addClass("autosize").autosize()}});i.find("a.btn").each(function(){var e=a(this),k=e.data("icon");if(k&&!e.find("> i").length){k="fa-"+k.replace("fa-","");if(!e.data("bjui.icon")){e.html('<i class="fa '+k+'"></i> '+e.html()).data("bjui.icon",true)}}});if(a.fn.validator){i.find('form[data-toggle="validate"]').each(function(){var e=a(this);a(this).validator({valid:function(k){a(k).bjuiajax("_ajaxform",a(k),a(k).data())},validClass:"ok",msgClass:"n-bottom",theme:"red_bottom_effect_grid"}).on("invalid.form",function(l,k,m){if(a(k).data("alertmsg")){a(k).alertmsg("error",BJUI.regional.validatemsg.replaceMsg(m.length))}})})}i.find('[data-toggle="moresearch"]').each(function(){var k=a(this),m=k.closest(".bjui-pageHeader"),e=m&&m.find(".bjui-moreSearch"),l=k.data("name");if(!k.attr("title")){k.attr("title","更多查询条件")}k.click(function(n){if(!e.length){BJUI.debug("Not created 'moresearch' box[class=\"bjui-moreSearch\"]!");return}e.css("top",m.outerHeight()-1);if(e.is(":visible")){k.html('<i class="fa fa-angle-double-down"></i>');if(l){a("body").data("moresearch."+l,false)}}else{k.html('<i class="fa fa-angle-double-up"></i>');if(l){a("body").data("moresearch."+l,true)}}e.fadeToggle("slow","linear");n.preventDefault()});if(l&&a("body").data("moresearch."+l)){e.css("top",m.outerHeight()-1).fadeIn();k.html('<i class="fa fa-angle-double-up"></i>')}});if(a.fn.selectpicker){var d=i.find('select[data-toggle="selectpicker"]');var h=function(p,e){if(!e||!e.length){return}var k=p.data("refurl");var o=function(q){var s=a(q.data("nextselect"));if(s&&s.length){var r=s.data("emptytxt")||"&nbsp;";s.html("<option>"+r+"</option>").selectpicker("refresh");
    o(s)}};if((e&&e.length)&&k){var n=p.data("val"),l=e.data("val"),m=p.data("keys");if(m&&typeof m==="string"){m=m.toObj()}if(!m){m={}}if(typeof n==="undefined"){n=p.val()}a.ajax({type:"POST",dataType:"json",url:k.replace("{value}",encodeURIComponent(n)),cache:false,data:{},success:function(r){if(!r){return}var q="",s="";a.each(r,function(u){var v,t;if(r[u]&&r[u].length){v=r[u][0];t=r[u][1]}else{v=r[u][m.value||"value"];t=r[u][m.label||"label"]}if(typeof l!=="undefined"){s=v==l?" selected":""}q+='<option value="'+v+'"'+s+">"+t+"</option>"});p.removeAttr("data-val").removeData("val");e.removeAttr("data-val").removeData("val");if(!q){q=e.data("emptytxt")||"&nbsp;";q="<option>"+q+"</option>"}e.html(q).selectpicker("refresh");o(e)},error:BJUI.ajaxError})}};d.each(function(){var k=a(this);var l=k.data();var e=a(l.nextselect);k.addClass("show-tick");if(!l.style){k.data("style","btn-default")}if(!l.width){k.data("width","auto")}if(!l.container){k.data("container","body")}else{if(l.container==true){k.attr("data-container","false").data("container",false)}}k.selectpicker();if(e&&e.length&&(typeof e.data("val")!="undefined")){h(k,e)}});d.change(function(){var e=a(this);var k=a(e.data("nextselect"));h(e,k);if(e.attr("aria-required")){a.fn.validator&&e.trigger("validate")}})}if(a.fn.zTree){i.find('[data-toggle="ztree"]').each(function(){var p=a(this),l=p.data(),w=l.options,e;if(w&&typeof w==="string"){w=w.toObj()}if(w){a.extend(l,typeof w==="object"&&w)}e=l.setting;if(!l.nodes){l.nodes=[];p.find("> li").each(function(){var y=a(this);var x=y.data();if(x.pid){x.pId=x.pid}x.name=y.html();l.nodes.push(x)});p.empty()}else{if(typeof l.nodes==="string"){if(l.nodes.trim().startsWith("[")||l.nodes.trim().startsWith("{")){l.nodes=l.nodes.toObj()}else{l.nodes=l.nodes.toFunc()}}if(typeof l.nodes==="function"){l.nodes=l.nodes.call(this)}p.removeAttr("data-nodes")}if(!l.showRemoveBtn){l.showRemoveBtn=false}if(!l.showRenameBtn){l.showRenameBtn=false}if(l.addHoverDom&&typeof l.addHoverDom!=="function"){l.addHoverDom=(l.addHoverDom==="edit")?m:l.addHoverDom.toFunc()}if(l.removeHoverDom&&typeof l.removeHoverDom!=="function"){l.removeHoverDom=(l.removeHoverDom==="edit")?r:l.removeHoverDom.toFunc()}if(!l.maxAddLevel){l.maxAddLevel=2}var v={view:{addHoverDom:l.addHoverDom||null,removeHoverDom:l.removeHoverDom||null,addDiyDom:l.addDiyDom?l.addDiyDom.toFunc():null},edit:{enable:l.editEnable,showRemoveBtn:l.showRemoveBtn,showRenameBtn:l.showRenameBtn},check:{enable:l.checkEnable,chkStyle:l.chkStyle,radioType:l.radioType},callback:{onClick:l.onClick?l.onClick.toFunc():null,beforeDrag:l.beforeDrag?l.beforeDrag.toFunc():u,beforeDrop:l.beforeDrop?l.beforeDrop.toFunc():o,onDrop:l.onDrop?l.onDrop.toFunc():null,onCheck:l.onCheck?l.onCheck.toFunc():null,beforeRemove:l.beforeRemove?l.beforeRemove.toFunc():null,onRemove:l.onRemove?l.onRemove.toFunc():null,onNodeCreated:k,onCollapse:t,onExpand:s},data:{simpleData:{enable:l.simpleData||true},key:{title:l.title||""}}};if(e&&typeof e==="string"){e=e.toObj()}if(e){a.extend(true,v,typeof e==="object"&&e)}a.fn.zTree.init(p,v,l.nodes);var n="_a";var q=a.fn.zTree.getZTreeObj(p.attr("id"));if(l.expandAll){q.expandAll(true)}function k(x,A,z){if(z.faicon){var y=a("#"+z.tId+"_a");if(!y.data("faicon")){y.data("faicon",true).addClass("faicon").find("> span.button").append('<i class="fa fa-'+z.faicon+'"></i>')}}if(l.onNodeCreated){l.onNodeCreated.toFunc().call(this,x,A,z)}}function t(x,z,y){if(y.faiconClose){a("#"+y.tId+"_ico").find("> i").attr("class","fa fa-"+y.faiconClose)}if(l.onCollapse){l.onCollapse.toFunc().call(this,x,z,y)}}function s(x,z,y){if(y.faicon&&y.faiconClose){a("#"+y.tId+"_ico").find("> i").attr("class","fa fa-"+y.faicon)}if(l.onExpand){l.onExpand.toFunc().call(this,x,z,y)}}function m(z,y){var C=y.level;var B=a("#"+y.tId+n);var A=a("#diyBtn_add_"+y.id);var x=a("#diyBtn_del_"+y.id);if(!A.length){if(C<l.maxAddLevel){A=a('<span class="tree_add" id="diyBtn_add_'+y.id+'" title="添加"></span>');A.appendTo(B);A.on("click",function(){q.addNodes(y,{name:"新增Item"})})}}if(!x.length){var x=a('<span class="tree_del" id="diyBtn_del_'+y.id+'" title="删除"></span>');x.appendTo(B).on("click",function(G){var E=function(){x.alertmsg("confirm","确认要删除 "+y.name+" 吗？",{okCall:function(){q.removeNode(y);if(l.onRemove){var H=l.onRemove.toFunc();if(H){H.call(this,G,z,y)}}},cancelCall:function(){return}})};if(l.beforeRemove){var F=l.beforeRemove.toFunc();if(F){var D=F.call(F,z,y);if(D&&D==true){E()}}}else{E()}})}}function r(z,y){var A=a("#diyBtn_add_"+y.id);var x=a("#diyBtn_del_"+y.id);if(A&&A.length){A.off("click").remove()}if(x&&x.length){x.off("click").remove()}}function u(z,y){for(var x=0;x<y.length;x++){if(y[x].drag===false){return false}}return true}function o(z,y,A,x){return A?A.drop!==false:true}});var b=i.find('[data-toggle="selectztree"]');b.each(function(){var n=a(this);var r=n.data(),q=a(r.tree),p=parseFloat(n.css("width")),m=n.outerHeight();r.width=r.width||n.outerWidth();r.height=r.height||"auto";if(!q||!q.length){return
}var l=q.attr("id");var e=a("#"+l+"_select_box");var o=function(x){var w=n.offset().top,v=n.offset().left,u=q.clone().appendTo(a("body")),y=u.outerHeight();u.remove();var t=a(window).height()-y-w-m,s=a(window).height()-w-m;if(r.height=="auto"&&t<0){s=s+t}x.css({top:(w+m),left:v,"max-height":s})};n.click(function(){if(e&&e.length){o(e);e.show();return}var t=2;var s=a.CurrentDialog;if(s&&s.length){t=s.css("zIndex")+1}e=a('<div id="'+l+'_select_box" class="tree-box"></div>').css({position:"absolute","zIndex":t,"min-width":r.width,height:r.height,overflow:"auto",background:"#FAFAFA",border:"1px #EEE solid"}).hide().appendTo(a("body"));q.appendTo(e).css("width","100%").data("fromObj",n).removeClass("hide").show();o(e);e.show()});a("body").on("mousedown",function(t){var s=a(t.target);if(!(n[0]==t.target||(e&&e.length>0&&s.closest(".tree-box").length>0))){e.hide()}});var k=n.closest(".bjui-pageContent");if(k&&k.length){k.scroll(function(){if(e&&e.length){o(e)}})}n.on("destroy.bjui.selectztree",function(){e.remove()})})}if(a.fn.colorpicker){i.find('[data-toggle="colorpicker"]').each(function(){var k=a(this);var e=k.data("bgcolor");k.colorpicker();if(e){k.on("changeColor",function(l){k.css("background-color",l.color.toHex())})}});i.find('[data-toggle="clearcolor"]').each(function(){var k=a(this);var e=k.data("target")?a(k.data("target")):null;if(e&&e.length){k.click(function(){e.val("");if(e.data("bgcolor")){e.css("background-color","")}})}})}i.find('[data-toggle="tooltip"]').each(function(){a(this).tooltip()});i.find('[data-toggle="popover"]').each(function(){var e=a(this),k=e.data("target");if(k&&a(k).length){e.attr("data-content",a(k).html())}e.popover()});i.find('[data-toggle="dropdown"]').parent().on("show.bs.dropdown",function(o){var n=a(this),l=n.outerWidth(),k=n.find("> .dropdown-menu"),m=k.outerWidth();if(l>m){k.css("min-width",l)}});var g=i.find('[data-toggle="highcharts"]');g.each(function(){var e=a(this);var k=e.data();a.get(k.url,function(l){e.highcharts(l)},"json")});var f=i.find('[data-toggle="echarts"]');f.each(function(){var e=a(this);var l=e.data();var m=l.theme?l.theme:"default";var k=l.type.split(",");require.config({paths:{echarts:BJUI.PLUGINPATH+"echarts"}});require(["echarts","echarts/theme/"+m,"echarts/chart/"+k[0],k[1]?"echarts/chart/"+k[1]:"echarts"],function(o,p){var n=o.init(e[0],p);a.get(l.url,function(q){n.setOption(q)},"json")})})})}(jQuery);